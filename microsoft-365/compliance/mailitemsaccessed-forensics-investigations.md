---
title: Usare Audit avanzato per le indagini sugli account compromessi
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: ''
description: Usare l'azione di controllo delle cassette postali MailItemsAccessed per eseguire indagini forensi sugli account utente compromessi.
ms.openlocfilehash: cd76a49e1f7b6e52d2a21e74162781771a8552a1
ms.sourcegitcommit: f6840dfcfdbcadc53cda591fd6cf9ddcb749d303
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 05/20/2020
ms.locfileid: "44327650"
---
# <a name="use-advanced-audit-to-investigate-compromised-accounts"></a><span data-ttu-id="a90ec-103">Usare Audit avanzato per le indagini sugli account compromessi</span><span class="sxs-lookup"><span data-stu-id="a90ec-103">Use Advanced Audit to investigate compromised accounts</span></span>

<span data-ttu-id="a90ec-104">La compromissione di un account utente, detta anche *takeover*, è un tipo di attacco in cui un utente malintenzionato acquisisce la proprietà di un account e agisce come se fosse il vero proprietario.</span><span class="sxs-lookup"><span data-stu-id="a90ec-104">A compromised user account (also called an *account takeover*) is a type of attack when an attacker gains access to a user account and operates as the user.</span></span> <span data-ttu-id="a90ec-105">A volte questi tipi di attacchi causano più danni di quanto previsto dall'utente malintenzionato.</span><span class="sxs-lookup"><span data-stu-id="a90ec-105">These types of attacks sometimes cause more damage than the attacker may have intended.</span></span> <span data-ttu-id="a90ec-106">Quando si analizzano gli account di posta elettronica compromessi, è necessario presumere che i dati di posta elettronica compromessi siano di più rispetto a quanto indicato tracciando la presenza effettiva dell'autore dell'attacco.</span><span class="sxs-lookup"><span data-stu-id="a90ec-106">When investigating compromised email accounts, you have to assume that more mail data was compromised than may be indicated by tracing the attacker's actual presence.</span></span> <span data-ttu-id="a90ec-107">A seconda del tipo di dati contenuti nei messaggi di posta elettronica, è necessario presumere che siano state compromesse informazioni riservate o esporsi a sanzioni, a meno che non sia possibile dimostrare che non sono state esposte informazioni sensibili.</span><span class="sxs-lookup"><span data-stu-id="a90ec-107">Depending on the type of data in email messages, you have to assume that sensitive information was compromised or face regulatory fines unless you can prove that sensitive information wasn't exposed.</span></span> <span data-ttu-id="a90ec-108">Ad esempio, le organizzazioni che devono essere conformi all'HIPAA sono soggette a sanzioni elevate se vengono esposte le informazioni sanitarie dei pazienti (PHI).</span><span class="sxs-lookup"><span data-stu-id="a90ec-108">For example, HIPAA-regulated organizations face significant fines if there is evidence that patient health information (PHI) was exposed.</span></span> <span data-ttu-id="a90ec-109">In questi casi, è improbabile che i pirati informatici siano interessati ai dati PHI, ma le organizzazioni devono comunque segnalare una violazione dei dati, a meno che non possano dimostrare il contrario.</span><span class="sxs-lookup"><span data-stu-id="a90ec-109">In these cases, attackers are unlikely to be interested in PHI, but organizations still must report data breaches unless they can prove otherwise.</span></span>

<span data-ttu-id="a90ec-110">Per semplificare le indagini sugli account di posta elettronica compromessi, ora controlliamo l'accesso ai dati di posta elettronica in base ai protocolli di posta elettronica e ai client con l'azione di controllo delle cassette postali *MailItemsAccessed*.</span><span class="sxs-lookup"><span data-stu-id="a90ec-110">To help you with investigating compromise email accounts, we're now auditing accesses of mail data by mail protocols and clients with the *MailItemsAccessed* mailbox auditing action.</span></span> <span data-ttu-id="a90ec-111">Questa nuova azione sottoposta a controllo aiuterà gli investigatori a comprendere meglio le violazioni dei dati di posta elettronica e a restringere l'ambito a specifici messaggi che potrebbero essere stati compromessi.</span><span class="sxs-lookup"><span data-stu-id="a90ec-111">This new audited action will help investigators better understand email data breaches and help you identify the scope of compromises to specific mail items that may been compromised.</span></span> <span data-ttu-id="a90ec-112">L'uso di questa nuova azione di controllo è la difesa forense, per poter attestare che un determinato elemento di dati di posta non è stato compromesso.</span><span class="sxs-lookup"><span data-stu-id="a90ec-112">The goal of using this new auditing action is forensics defensibility to help assert that a specific piece of mail data was not compromised.</span></span> <span data-ttu-id="a90ec-113">Se un utente malintenzionato ha ottenuto l'accesso a un determinato messaggio di posta elettronica, Exchange Online controlla l'evento anche se non c'è alcuna indicazione che l'elemento di posta elettronica sia stato effettivamente letto.</span><span class="sxs-lookup"><span data-stu-id="a90ec-113">If an attacker gained access to a specific piece of mail, Exchange Online audits the event even though there is no indication that the mail item was actually read.</span></span>

## <a name="the-mailitemsaccessed-mailbox-auditing-action"></a><span data-ttu-id="a90ec-114">Azione di controllo delle cassette postali MailItemsAccessed</span><span class="sxs-lookup"><span data-stu-id="a90ec-114">The MailItemsAccessed mailbox auditing action</span></span>

<span data-ttu-id="a90ec-115">La nuova azione MailItemsAccessed fa parte della nuova funzionalità [Audit avanzato](advanced-audit.md).</span><span class="sxs-lookup"><span data-stu-id="a90ec-115">The new MailItemsAccessed action is part of the new [Advanced Audit](advanced-audit.md) functionality.</span></span> <span data-ttu-id="a90ec-116">È parte del [controllo delle cassette postali di Exchange](https://docs.microsoft.com/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) ed è abilitata per impostazione predefinita per gli utenti a cui è assegnata una licenza di Office 365 o Microsoft 365 E5 o per le organizzazioni con un abbonamento al componente aggiuntivo Microsoft 365 E5 Compliance.</span><span class="sxs-lookup"><span data-stu-id="a90ec-116">It's part of [Exchange mailbox auditing](https://docs.microsoft.com/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) and is enabled by default for users that are assigned an Office 365 or Microsoft 365 E5 license or for organizations with a Microsoft 365 E5 Compliance add-on subscription.</span></span>

<span data-ttu-id="a90ec-117">L'azione di controllo delle cassette postali MailItemsAccessed copre tutti i protocolli di posta elettronica: POP, IMAP, MAPI, EWS, Exchange ActiveSync e REST.</span><span class="sxs-lookup"><span data-stu-id="a90ec-117">The MailItemsAccessed mailbox auditing action covers all mail protocols: POP, IMAP, MAPI, EWS, Exchange ActiveSync, and REST.</span></span> <span data-ttu-id="a90ec-118">Copre anche entrambi i tipi di accesso alla posta elettronica: *sync* e *bind*.</span><span class="sxs-lookup"><span data-stu-id="a90ec-118">It also covers both types of accessing mail: *sync* and *bind*.</span></span>

### <a name="auditing-sync-access"></a><span data-ttu-id="a90ec-119">Controllo dell'accesso per sincronizzazione</span><span class="sxs-lookup"><span data-stu-id="a90ec-119">Auditing sync access</span></span>

<span data-ttu-id="a90ec-120">Le operazioni Sync vengono registrate solo quando si accede a una cassetta postale da una versione desktop del client Outlook per Windows o Mac.</span><span class="sxs-lookup"><span data-stu-id="a90ec-120">Sync operations are only recorded when a mailbox is accessed by a desktop version of the Outlook client for Windows or Mac.</span></span> <span data-ttu-id="a90ec-121">Durante l'operazione Sync, in genere questi client scaricano un set di elementi di posta di grandi dimensioni dal cloud a un computer locale.</span><span class="sxs-lookup"><span data-stu-id="a90ec-121">During the sync operation, these clients typically download a large set of mail items from the cloud to a local computer.</span></span> <span data-ttu-id="a90ec-122">Il volume di controllo per le operazioni Sync è enorme.</span><span class="sxs-lookup"><span data-stu-id="a90ec-122">The audit volume for sync operations is huge.</span></span> <span data-ttu-id="a90ec-123">Per questo motivo, invece di generare un record di controllo per ogni elemento di posta elettronica sincronizzato, viene generato solo un evento di controllo per la cartella di posta contenente gli elementi che sono stati sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="a90ec-123">So, instead of generating an audit record for each mail item that's synched, we just generate an audit event for the mail folder containing items that were synched.</span></span> <span data-ttu-id="a90ec-124">Questo presuppone che *tutti* gli elementi di posta nella cartella sincronizzata siano stati compromessi.</span><span class="sxs-lookup"><span data-stu-id="a90ec-124">This makes the assumption that *all* mail items in the synched folder have been compromised.</span></span> <span data-ttu-id="a90ec-125">Il tipo di accesso viene registrato nel campo OperationProperties del record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-125">The access type is recorded in the OperationProperties field of the audit record.</span></span> 

<span data-ttu-id="a90ec-126">Vedere il passaggio 2 nella sezione [Usare i record di controllo MailItemsAccessed per le indagini forensi](#use-mailitemsaccessed-audit-records-for-forensic-investigations) per un esempio di visualizzazione del tipo di accesso Sync in un record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-126">See step 2 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the sync access type in an audit record.</span></span>

### <a name="auditing-bind-access"></a><span data-ttu-id="a90ec-127">Controllo dell'accesso per binding</span><span class="sxs-lookup"><span data-stu-id="a90ec-127">Auditing bind access</span></span>

<span data-ttu-id="a90ec-128">Un'operazione Bind è un singolo accesso a un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="a90ec-128">A bind operation is an individual access to an email message.</span></span> <span data-ttu-id="a90ec-129">Per l'accesso per binding, l'InternetMessageId dei singoli messaggi verrà registrato nel record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-129">For bind access, the InternetMessageId of individual messages will be recorded in the audit record.</span></span> <span data-ttu-id="a90ec-130">L'azione di controllo MailItemsAccessed registra le operazioni Bind e le aggrega in un singolo record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-130">The MailItemsAccessed audit action records bind operations and then aggregates into a single audit record.</span></span> <span data-ttu-id="a90ec-131">Tutte le operazioni Bind che si verificano in un intervallo di due minuti vengono aggregate in un singolo record di controllo nel campo delle cartelle all'interno della proprietà AuditData.</span><span class="sxs-lookup"><span data-stu-id="a90ec-131">All bind operations that occur within a 2-minute interval are aggregated in a single audit record in the Folders field within the AuditData property.</span></span> <span data-ttu-id="a90ec-132">Ogni messaggio a cui è stato eseguito l'accesso è identificato dal relativo InternetMessageId.</span><span class="sxs-lookup"><span data-stu-id="a90ec-132">Each message that was accessed is identified by its InternetMessageId.</span></span> <span data-ttu-id="a90ec-133">Il numero di operazioni di binding aggregate nel record viene visualizzato nel campo OperationCount della proprietà AuditData.</span><span class="sxs-lookup"><span data-stu-id="a90ec-133">The number of bind operations that were aggregated in the record is displayed in the OperationCount field in the AuditData property.</span></span>

<span data-ttu-id="a90ec-134">Vedere il passaggio 4 nella sezione [Usare i record di controllo MailItemsAccessed per le indagini forensi](#use-mailitemsaccessed-audit-records-for-forensic-investigations) per un esempio di visualizzazione del tipo di accesso Bind in un record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-134">See step 4 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the bind access type in an audit record.</span></span>

### <a name="throttling-of-mailitemsaccessed-audit-records"></a><span data-ttu-id="a90ec-135">Limitazione dei record di controllo MailItemsAccessed</span><span class="sxs-lookup"><span data-stu-id="a90ec-135">Throttling of MailItemsAccessed audit records</span></span>

<span data-ttu-id="a90ec-136">Se in meno di 24 ore vengono generati più di 1.000 record di controllo MailItemsAccessed, Exchange Online smetterà di generare i record di controllo per l'attività MailItemsAccessed.</span><span class="sxs-lookup"><span data-stu-id="a90ec-136">If more than 1,000 MailItemsAccessed audit records are generated in less than 24 hours, Exchange Online will stop generating auditing records for MailItemsAccessed activity.</span></span> <span data-ttu-id="a90ec-137">Quando una cassetta postale viene limitata, l'attività MailItemsAccessed non viene registrata per le 24 ore successive.</span><span class="sxs-lookup"><span data-stu-id="a90ec-137">When a mailbox is throttled, MailItemsAccessed activity will not be logged for 24 hours after the mailbox was throttled.</span></span> <span data-ttu-id="a90ec-138">Se questo avviene, è possibile che durante questo periodo la cassetta postale sia stata compromessa.</span><span class="sxs-lookup"><span data-stu-id="a90ec-138">If this occurs, there's a potential that mailbox could have been compromised during this period.</span></span> <span data-ttu-id="a90ec-139">La registrazione dell'attività MailItemsAccessed verrà ripresa dopo un periodo di 24 ore.</span><span class="sxs-lookup"><span data-stu-id="a90ec-139">The recording of MailItemsAccessed activity will be resumed following a 24-hour period.</span></span>  

<span data-ttu-id="a90ec-140">Ecco alcuni aspetti da tenere presenti sulla limitazione:</span><span class="sxs-lookup"><span data-stu-id="a90ec-140">Here's a few things to keep in mind about throttling:</span></span>

- <span data-ttu-id="a90ec-141">Meno dell'1% di tutte le cassette postali in Exchange Online è sottoposto a limitazione</span><span class="sxs-lookup"><span data-stu-id="a90ec-141">Less than 1% of all mailboxes in Exchange Online are throttled</span></span>

- <span data-ttu-id="a90ec-142">Quando una cassetta postale è limitata, solo i record di controllo per l'attività MailItemsAccessed non vengono controllati.</span><span class="sxs-lookup"><span data-stu-id="a90ec-142">When a mailbox is throttling, only audit records for MailItemsAccessed activity are not audited.</span></span> <span data-ttu-id="a90ec-143">Le altre azioni di controllo delle cassette postali non sono interessate.</span><span class="sxs-lookup"><span data-stu-id="a90ec-143">Other mailbox auditing actions aren't affected.</span></span>

- <span data-ttu-id="a90ec-144">Le cassette postali vengono limitate solo per le operazioni Bind.</span><span class="sxs-lookup"><span data-stu-id="a90ec-144">Mailboxes are throttled only for Bind operations.</span></span> <span data-ttu-id="a90ec-145">I record di controllo delle operazioni Sync non vengono limitati.</span><span class="sxs-lookup"><span data-stu-id="a90ec-145">Audit records for sync operations are not throttled.</span></span>

- <span data-ttu-id="a90ec-146">Se una cassetta postale viene limitata, si può presupporre che ci siano attività MailItemsAccessed che non sono state registrate nei log di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-146">If a mailbox is throttled, you can probably assume there was MailItemsAccessed activity that wasn't recorded in the audit logs.</span></span>

<span data-ttu-id="a90ec-147">Vedere il passaggio 1 nella sezione [Usare i record di controllo MailItemsAccessed per le indagini forensi](#use-mailitemsaccessed-audit-records-for-forensic-investigations) per un esempio di visualizzazione della proprietà IsThrottled in un record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-147">See step 1 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the IsThrottled property in an audit record.</span></span>

## <a name="use-mailitemsaccessed-audit-records-for-forensic-investigations"></a><span data-ttu-id="a90ec-148">Usare i record di controllo MailItemsAccessed per le indagini forensi</span><span class="sxs-lookup"><span data-stu-id="a90ec-148">Use MailItemsAccessed audit records for forensic investigations</span></span>

<span data-ttu-id="a90ec-149">Il controllo delle cassette postali genera record di controllo per l'accesso ai messaggi di posta elettronica, per offrire la certezza che i messaggi di posta elettronica non siano stati compromessi.</span><span class="sxs-lookup"><span data-stu-id="a90ec-149">Mailbox auditing generates audit records for access to email messages so that you can be confident that email messages haven't been compromised.</span></span> <span data-ttu-id="a90ec-150">Per questo motivo, nei casi in cui non siamo certi che sia stato eseguito l'accesso a determinati dati, presupponiamo che sia avvenuto, registrando tutte le attività di accesso alla posta.</span><span class="sxs-lookup"><span data-stu-id="a90ec-150">For this reason, in circumstances where we're not certain that some data has been accessed, we assume that it has by recording all mail access activity.</span></span>

<span data-ttu-id="a90ec-151">In genere i record di controllo MailItemsAccessed vengono usati a scopi forensi dopo la risoluzione di una violazione dei dati e l'espulsione dell'autore dell'attacco.</span><span class="sxs-lookup"><span data-stu-id="a90ec-151">Using MailItemsAccessed audit records for forensics purposes is typically performed after a data breach has been resolved and the attacker has been evicted.</span></span> <span data-ttu-id="a90ec-152">Per avviare l'indagine, è necessario identificare il set di cassette postali che sono state compromesse e determinare il periodo di tempo in cui l'utente malintenzionato ha avuto accesso alle cassette postali dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="a90ec-152">To begin your investigation, you should identify the set of mailboxes that they have been compromised and determine the time frame when attacker had access to mailboxes in your organization.</span></span> <span data-ttu-id="a90ec-153">Quindi, è possibile usare i cmdlet **UnifiedAuditLog** o **Search-MailboxAuditLog** in [PowerShell di Exchange Online](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell) per cercare i record di controllo che corrispondono alla violazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="a90ec-153">Then, you can use the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets in [Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell) to search audit records that correspond to the data breach.</span></span> 

<span data-ttu-id="a90ec-154">È possibile eseguire uno dei comandi seguenti per cercare i record di controllo MailItemsAccessed:</span><span class="sxs-lookup"><span data-stu-id="a90ec-154">You can run one of the following commands to search for MailItemsAccessed audit records:</span></span>

<span data-ttu-id="a90ec-155">**Log di controllo unificato**</span><span class="sxs-lookup"><span data-stu-id="a90ec-155">**Unified audit log**</span></span>

```powershell
Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000
```

<span data-ttu-id="a90ec-156">**Log di controllo cassetta postale**</span><span class="sxs-lookup"><span data-stu-id="a90ec-156">**Mailbox audit log**</span></span>

```powershell
Search-MailboxAuditLog -Identity <user> -StartDate 01/06/2020 -EndDate 01/20/2020 -Operations MailItemsAccessed -ResultSize 1000 -ShowDetails
```

> [!TIP]
> <span data-ttu-id="a90ec-157">Una delle principali differenze tra i due cmdlet è che è possibile usare **Search-UnifiedAuditLog** per cercare i record di controllo per le attività eseguite da uno o più utenti.</span><span class="sxs-lookup"><span data-stu-id="a90ec-157">One primary difference between these two cmdlets in that you can use the **Search-UnifiedAuditLog** cmdlet to search for audit records for activity performed by one or more users.</span></span> <span data-ttu-id="a90ec-158">Il motivo è che *UserId* è un parametro multivalore.</span><span class="sxs-lookup"><span data-stu-id="a90ec-158">That's because *UserIds* is a multi-value parameter.</span></span> <span data-ttu-id="a90ec-159">Il cmdlet **Search-MailboxAuditLog** cerca nel log di controllo della cassetta postale un singolo utente.</span><span class="sxs-lookup"><span data-stu-id="a90ec-159">The **Search-MailboxAuditLog** cmdlet searches the mailbox audit log for a single user.</span></span>

<span data-ttu-id="a90ec-160">Di seguito sono illustrati i passaggi per usare i record di controllo MailItemsAccessed per analizzare un attacco con compromissione di un account utente.</span><span class="sxs-lookup"><span data-stu-id="a90ec-160">Here are the steps for using MailItemsAccessed audit records to investigate a compromised user attack.</span></span> <span data-ttu-id="a90ec-161">Ogni passaggio mostra la sintassi dei comandi per i cmdlet **Search-UnifiedAuditLog** o **Search-MailboxAuditLog**.</span><span class="sxs-lookup"><span data-stu-id="a90ec-161">Each step shows the command syntax for the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets.</span></span>

1. <span data-ttu-id="a90ec-162">Controllare se la cassetta postale è stata limitata.</span><span class="sxs-lookup"><span data-stu-id="a90ec-162">Check whether the mailbox has been throttled.</span></span> <span data-ttu-id="a90ec-163">In tal caso, alcuni record di controllo delle cassette postali non sono stati registrati.</span><span class="sxs-lookup"><span data-stu-id="a90ec-163">If so, this would mean that some mailbox auditing records would not have been logged.</span></span> <span data-ttu-id="a90ec-164">Se alcuni record di controllo hanno il valore "IsThrottled" uguale a "True", bisogna presupporre che, per le 24 ore successive alla generazione del record, l'accesso alla cassetta postale non è stato controllato e che tutti i dati di posta sono stati compromessi.</span><span class="sxs-lookup"><span data-stu-id="a90ec-164">In the case that any audit records have the "IsThrottled" is "True," you should assume that for a 24-hour period afterwards that record was generated, that any access to the mailbox was not audited and that all mail data has been compromised.</span></span>

   <span data-ttu-id="a90ec-165">Per cercare i record MailItemsAccessed in cui la cassetta postale era limitata, eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="a90ec-165">To search for MailItemsAccessed records where the mailbox was throttled, run the following command:</span></span>

   <span data-ttu-id="a90ec-166">**Log di controllo unificato**</span><span class="sxs-lookup"><span data-stu-id="a90ec-166">**Unified audit log**</span></span>
 
   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"IsThrottled","Value":"True"*'} | FL
   ```

   <span data-ttu-id="a90ec-167">**Log di controllo cassetta postale**</span><span class="sxs-lookup"><span data-stu-id="a90ec-167">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*IsThrottled:True*"} | FL
   ```

2. <span data-ttu-id="a90ec-168">Controllare le attività di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="a90ec-168">Check for sync activities.</span></span> <span data-ttu-id="a90ec-169">Se un utente malintenzionato usa un client di posta elettronica per scaricare i messaggi in una cassetta postale, può disconnettere il computer da Internet e accedere ai messaggi in locale senza interagire con il server.</span><span class="sxs-lookup"><span data-stu-id="a90ec-169">If an attacker uses an email client to downloaded messages in a mailbox, they can disconnect the computer from the Internet and access the messages locally without interacting with the server.</span></span> <span data-ttu-id="a90ec-170">Questo significa che il controllo delle cassette postali non è in grado di controllare queste attività.</span><span class="sxs-lookup"><span data-stu-id="a90ec-170">This means that mailbox auditing would not be able to audit these activities.</span></span>

   <span data-ttu-id="a90ec-171">Per cercare i record MailItemsAccessed in cui l'accesso agli elementi di posta è avvenuto tramite un'operazione Sync, eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="a90ec-171">To search for MailItemsAccessed records where the mail items were accessed by a sync operation, run the following command:</span></span>

   <span data-ttu-id="a90ec-172">**Log di controllo unificato**</span><span class="sxs-lookup"><span data-stu-id="a90ec-172">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 02/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Sync"*'} | FL
   ```

   <span data-ttu-id="a90ec-173">**Log di controllo cassetta postale**</span><span class="sxs-lookup"><span data-stu-id="a90ec-173">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Sync*"} | FL
   ```

3. <span data-ttu-id="a90ec-174">Controllare le attività di sincronizzazione per determinare se qualcuna di esse è avvenuta nel contesto di quella usata dall'autore dell'attacco per accedere alla cassetta postale.</span><span class="sxs-lookup"><span data-stu-id="a90ec-174">Check sync activities to determine in any of them have occurred in the same context as the one used by the attacker access the mailbox.</span></span> <span data-ttu-id="a90ec-175">Il contesto è identificato e differenziato dall'indirizzo IP del computer client usato per accedere alla cassetta postale e dal protocollo di posta.</span><span class="sxs-lookup"><span data-stu-id="a90ec-175">Context is identified and differentiated by the IP address of the client computer used to access the mailbox and the mail protocol.</span></span> <span data-ttu-id="a90ec-176">Per altre informazioni, vedere la sezione [Identificazione dei contesti di accesso di record di controllo diversi](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="a90ec-176">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>

   <span data-ttu-id="a90ec-177">Usare le proprietà elencate di seguito per le indagini.</span><span class="sxs-lookup"><span data-stu-id="a90ec-177">Use the properties listed below to investigate.</span></span> <span data-ttu-id="a90ec-178">Queste proprietà si trovano nella proprietà AuditData o OperationProperties.</span><span class="sxs-lookup"><span data-stu-id="a90ec-178">These properties are located in the AuditData or OperationProperties property.</span></span> <span data-ttu-id="a90ec-179">Se una delle sincronizzazioni si verifica nello stesso contesto dell'attività dell'utente malintenzionato, presupporre che quest'ultimo abbia sincronizzato tutti gli elementi di posta elettronica con il suo client, il che significa che l'intera cassetta postale è stata probabilmente compromessa.</span><span class="sxs-lookup"><span data-stu-id="a90ec-179">If any of the syncs occur in the same context as the attacker activity, assume the attacker has synced all mail items to their client, which means the entire mailbox has probably been compromised.</span></span>

   |<span data-ttu-id="a90ec-180">Proprietà</span><span class="sxs-lookup"><span data-stu-id="a90ec-180">Property</span></span>         | <span data-ttu-id="a90ec-181">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a90ec-181">Description</span></span> |
   |:---------------- | :----------|
   |<span data-ttu-id="a90ec-182">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="a90ec-182">ClientInfoString</span></span> | <span data-ttu-id="a90ec-183">Descrive il protocollo, client (include la versione)</span><span class="sxs-lookup"><span data-stu-id="a90ec-183">Describes protocol, client (includes version)</span></span>|
   |<span data-ttu-id="a90ec-184">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="a90ec-184">ClientIPAddress</span></span>  | <span data-ttu-id="a90ec-185">Indirizzo IP del computer client.</span><span class="sxs-lookup"><span data-stu-id="a90ec-185">IP address of the client machine.</span></span>|
   |<span data-ttu-id="a90ec-186">SessionId</span><span class="sxs-lookup"><span data-stu-id="a90ec-186">SessionId</span></span>        | <span data-ttu-id="a90ec-187">L'ID sessione consente di distinguere le azioni dell'autore dell'attacco dalle normali attività dell'utente nello stesso account (nel caso di un account compromesso)</span><span class="sxs-lookup"><span data-stu-id="a90ec-187">Session ID helps to differentiate attacker actions vs day-to-day user activities on the same account (in the case of a compromised account)</span></span>|
   |<span data-ttu-id="a90ec-188">UserId</span><span class="sxs-lookup"><span data-stu-id="a90ec-188">UserId</span></span>           | <span data-ttu-id="a90ec-189">UPN dell'utente che legge il messaggio.</span><span class="sxs-lookup"><span data-stu-id="a90ec-189">UPN of the user reading the message.</span></span>|
   |||

4. <span data-ttu-id="a90ec-190">Controllare le attività di binding.</span><span class="sxs-lookup"><span data-stu-id="a90ec-190">Check for bind activities.</span></span> <span data-ttu-id="a90ec-191">Dopo avere eseguito i passaggi 2 e 3, si può essere certi che tutti gli altri accessi ai messaggi di posta elettronica dell'autore dell'attacco saranno acquisiti nei record di controllo MailItemsAccessed che hanno una proprietà MailAccessType con il valore "Bind".</span><span class="sxs-lookup"><span data-stu-id="a90ec-191">After performing steps 2 and step 3, you can be confident that all other access to email messages by the attacker will be captured in the MailItemsAccessed audit records that have a MailAccessType property with a value of "Bind".</span></span>

   <span data-ttu-id="a90ec-192">Per cercare i record MailItemsAccessed in cui l'accesso agli elementi di posta è avvenuto tramite un'operazione Bind, eseguire il comando seguente.</span><span class="sxs-lookup"><span data-stu-id="a90ec-192">To search for MailItemsAccessed records where the mail items were accessed by a Bind operation, run the following command.</span></span>

   <span data-ttu-id="a90ec-193">**Log di controllo unificato**</span><span class="sxs-lookup"><span data-stu-id="a90ec-193">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Bind"*'} | FL
   ```
 
   <span data-ttu-id="a90ec-194">**Log di controllo cassetta postale**</span><span class="sxs-lookup"><span data-stu-id="a90ec-194">**Mailbox audit log**</span></span>
   
   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Bind*"} | FL
   ```

   <span data-ttu-id="a90ec-195">I messaggi di posta elettronica a cui è stato eseguito l'accesso sono identificati dal relativo valore InternetMessageId. Si può anche controllare se siano presenti record di controllo con lo stesso contesto di quelli di altre attività dell'utente malintenzionato.</span><span class="sxs-lookup"><span data-stu-id="a90ec-195">Email messages that were accessed are identified by their internet message Id. You can also check to see if any audit records have the same context as the ones for other attacker activity.</span></span> <span data-ttu-id="a90ec-196">Per altre informazioni, vedere la sezione [Identificazione dei contesti di accesso di record di controllo diversi](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="a90ec-196">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>
 
   <span data-ttu-id="a90ec-197">È possibile usare i dati di controllo per le operazioni di binding in due modi diversi:</span><span class="sxs-lookup"><span data-stu-id="a90ec-197">You can use the audit data for bind operations in two different ways:</span></span>

     - <span data-ttu-id="a90ec-198">Accedere o raccogliere tutti i messaggi di posta elettronica a cui ha eseguito l'accesso l'utente malintenzionato usando l'InternetMessageId per trovarli, poi verificare se uno di questi messaggi contiene informazioni riservate.</span><span class="sxs-lookup"><span data-stu-id="a90ec-198">Access or collect all email messages the attacker accessed by using the InternetMessageId to find them and then checking to see if any of those messages contains sensitive information.</span></span>

     - <span data-ttu-id="a90ec-199">Usare l'InternetMessageId per cercare i record di controllo relativi a un set di messaggi di posta elettronica potenzialmente sensibili.</span><span class="sxs-lookup"><span data-stu-id="a90ec-199">Use the InternetMessageId to search audit records related to a set of potentially sensitive email messages.</span></span> <span data-ttu-id="a90ec-200">Questa opzione è utile se si è preoccupati solo per un numero limitato di messaggi.</span><span class="sxs-lookup"><span data-stu-id="a90ec-200">This is useful if you're concerned only about a small number of messages.</span></span>

## <a name="filtering-of-duplicate-audit-records"></a><span data-ttu-id="a90ec-201">Filtro dei record di controllo duplicati</span><span class="sxs-lookup"><span data-stu-id="a90ec-201">Filtering of duplicate audit records</span></span>

<span data-ttu-id="a90ec-202">I record di controllo duplicati per le stesse operazioni di binding che si verificano entro un'ora l'una dall'altra vengono esclusi per rimuovere i dati non significativi.</span><span class="sxs-lookup"><span data-stu-id="a90ec-202">Duplicate audit records for the same bind operations that occur within an hour of each other are filtered out to remove auditing noise.</span></span> <span data-ttu-id="a90ec-203">Anche le operazioni di sincronizzazione sono filtrate a intervalli di un'ora.</span><span class="sxs-lookup"><span data-stu-id="a90ec-203">Sync operations are also filtered out at one-hour intervals.</span></span> <span data-ttu-id="a90ec-204">Un'eccezione a questo processo di deduplicazione si verifica se, per lo stesso InternetMessageId, le proprietà descritte nella tabella seguente sono diverse.</span><span class="sxs-lookup"><span data-stu-id="a90ec-204">The exception to this de-duplication process occurs if, for the same InternetMessageId, any of the properties described in the following table are different.</span></span> <span data-ttu-id="a90ec-205">Se una di queste proprietà è diversa in un'operazione duplicata, viene generato un nuovo record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-205">If one of these properties is different in a duplicate operation, a new audit record is generated.</span></span> <span data-ttu-id="a90ec-206">Questo processo è descritto in modo più dettagliato nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="a90ec-206">This process is described in more detail in the next section.</span></span>

| <span data-ttu-id="a90ec-207">Proprietà</span><span class="sxs-lookup"><span data-stu-id="a90ec-207">Property</span></span>| <span data-ttu-id="a90ec-208">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a90ec-208">Description</span></span>|
|:--------|:---------|
|<span data-ttu-id="a90ec-209">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="a90ec-209">ClientIPAddress</span></span> | <span data-ttu-id="a90ec-210">Indirizzo IP del computer client.</span><span class="sxs-lookup"><span data-stu-id="a90ec-210">IP address of the client computer.</span></span>|
|<span data-ttu-id="a90ec-211">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="a90ec-211">ClientInfoString</span></span>| <span data-ttu-id="a90ec-212">Protocollo client, client usato per accedere alla cassetta postale.</span><span class="sxs-lookup"><span data-stu-id="a90ec-212">The client protocol, client used to access the mailbox.</span></span>| 
|<span data-ttu-id="a90ec-213">ParentFolder</span><span class="sxs-lookup"><span data-stu-id="a90ec-213">ParentFolder</span></span>    | <span data-ttu-id="a90ec-214">Percorso completo della cartella dell'elemento di posta a cui è stato eseguito l'accesso.</span><span class="sxs-lookup"><span data-stu-id="a90ec-214">The full folder path of the mail item that was accessed.</span></span> |
|<span data-ttu-id="a90ec-215">Logon_type</span><span class="sxs-lookup"><span data-stu-id="a90ec-215">Logon_type</span></span>      | <span data-ttu-id="a90ec-216">Tipo di accesso dell'utente che ha eseguito l'azione.</span><span class="sxs-lookup"><span data-stu-id="a90ec-216">The logon type of the user who performed the action.</span></span> <span data-ttu-id="a90ec-217">I tipi di accesso e il valore di enumerazione corrispondente sono Owner (0), Admin (1) o Delegate (2).</span><span class="sxs-lookup"><span data-stu-id="a90ec-217">The logon types (and their corresponding Enum value) are Owner (0), Admin (1), or Delegate (2).</span></span>|
|<span data-ttu-id="a90ec-218">MailAccessType</span><span class="sxs-lookup"><span data-stu-id="a90ec-218">MailAccessType</span></span>  | <span data-ttu-id="a90ec-219">Indica se l'accesso è un'operazione Bind o Sync.</span><span class="sxs-lookup"><span data-stu-id="a90ec-219">Whether the access is a bind or a sync operation.</span></span>|
|<span data-ttu-id="a90ec-220">MailboxUPN</span><span class="sxs-lookup"><span data-stu-id="a90ec-220">MailboxUPN</span></span>      | <span data-ttu-id="a90ec-221">UPN della cassetta postale in cui si trova il messaggio letto.</span><span class="sxs-lookup"><span data-stu-id="a90ec-221">The UPN of the mailbox where the message being read is located.</span></span>|
|<span data-ttu-id="a90ec-222">User</span><span class="sxs-lookup"><span data-stu-id="a90ec-222">User</span></span>            | <span data-ttu-id="a90ec-223">UPN dell'utente che legge il messaggio.</span><span class="sxs-lookup"><span data-stu-id="a90ec-223">The UPN of the user reading the message.</span></span>|
|<span data-ttu-id="a90ec-224">SessionId</span><span class="sxs-lookup"><span data-stu-id="a90ec-224">SessionId</span></span>       | <span data-ttu-id="a90ec-225">L'ID sessione consente di distinguere le azioni dell'autore dell'attacco dalle normali attività dell'utente nella stessa cassetta postale, in caso di compromissione dell'account. Per altre informazioni sulle sessioni, vedere [Contextualizing attacker activity within sessions in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801) (Contestualizzare le attività di un utente malintenzionato all'interno delle sessioni in Exchange Online).</span><span class="sxs-lookup"><span data-stu-id="a90ec-225">The Session Id helps to differentiate attacker actions and day-to-day user activities in the same mailbox (in the case of account compromise) For more information about sessions, see [Contextualizing attacker activity within sessions in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span></span>|
||||

## <a name="identifying-the-access-contexts-of-different-audit-records"></a><span data-ttu-id="a90ec-226">Identificazione dei contesti di accesso di record di controllo diversi</span><span class="sxs-lookup"><span data-stu-id="a90ec-226">Identifying the access contexts of different audit records</span></span>

<span data-ttu-id="a90ec-227">È comune che l'autore di un attacco possa accedere a una cassetta postale nello stesso momento in cui vi accede il proprietario della cassetta postale.</span><span class="sxs-lookup"><span data-stu-id="a90ec-227">It's common that an attacker may access a mailbox at the same time the mailbox owner is accessing it.</span></span> <span data-ttu-id="a90ec-228">Per distinguere l'accesso del malintenzionato da quello del proprietario della cassetta postale, esistono delle proprietà del record di controllo che definiscono il contesto dell'accesso.</span><span class="sxs-lookup"><span data-stu-id="a90ec-228">To differentiate between access by the attacker and the mailbox owner, there are audit record properties that define the context of the access.</span></span> <span data-ttu-id="a90ec-229">Come descritto in precedenza, quando i valori di queste proprietà sono diversi, anche se l'attività si verifica entro l'intervallo di aggregazione, vengono generati record di controllo distinti.</span><span class="sxs-lookup"><span data-stu-id="a90ec-229">As previously explained, when the values for these properties are different, even when the activity occurs within the aggregation interval, separate audit records are generated.</span></span> <span data-ttu-id="a90ec-230">Nell'esempio seguente ci sono tre diversi record di controllo.</span><span class="sxs-lookup"><span data-stu-id="a90ec-230">In the following example, there are three different audit records.</span></span> <span data-ttu-id="a90ec-231">Ognuno di essi è differenziato dalle proprietà SessionId e ClientIPAddress.</span><span class="sxs-lookup"><span data-stu-id="a90ec-231">Each one is differentiated by the Session Id and ClientIPAddress properties.</span></span> <span data-ttu-id="a90ec-232">Sono anche identificati i messaggi a cui è stato eseguito l'accesso.</span><span class="sxs-lookup"><span data-stu-id="a90ec-232">The messages that were accessed are also identified.</span></span>

|<span data-ttu-id="a90ec-233">Record di controllo 1</span><span class="sxs-lookup"><span data-stu-id="a90ec-233">Audit record 1</span></span>  |<span data-ttu-id="a90ec-234">Record di controllo 2</span><span class="sxs-lookup"><span data-stu-id="a90ec-234">Audit record 2</span></span>  |<span data-ttu-id="a90ec-235">Record di controllo 3</span><span class="sxs-lookup"><span data-stu-id="a90ec-235">Audit record 3</span></span>|
|---------|---------|---------|
|<span data-ttu-id="a90ec-236">ClientIPAddress**1**</span><span class="sxs-lookup"><span data-stu-id="a90ec-236">ClientIPAddress**1**</span></span><br/><span data-ttu-id="a90ec-237">SessionId**2**</span><span class="sxs-lookup"><span data-stu-id="a90ec-237">SessionId**2**</span></span>|<span data-ttu-id="a90ec-238">ClientIPAddress**2**</span><span class="sxs-lookup"><span data-stu-id="a90ec-238">ClientIPAddress**2**</span></span><br/><span data-ttu-id="a90ec-239">SessionId**2**</span><span class="sxs-lookup"><span data-stu-id="a90ec-239">SessionId**2**</span></span>|<span data-ttu-id="a90ec-240">ClientIPAddress**1**</span><span class="sxs-lookup"><span data-stu-id="a90ec-240">ClientIPAddress**1**</span></span><br/><span data-ttu-id="a90ec-241">SessionId**3**</span><span class="sxs-lookup"><span data-stu-id="a90ec-241">SessionId**3**</span></span>|
|<span data-ttu-id="a90ec-242">InternetMessageId**A**</span><span class="sxs-lookup"><span data-stu-id="a90ec-242">InternetMessageId**A**</span></span><br/><span data-ttu-id="a90ec-243">InternetMessageId**D**</span><span class="sxs-lookup"><span data-stu-id="a90ec-243">InternetMessageId**D**</span></span><br/><span data-ttu-id="a90ec-244">InternetMessageId**E**</span><span class="sxs-lookup"><span data-stu-id="a90ec-244">InternetMessageId**E**</span></span><br/><span data-ttu-id="a90ec-245">InternetMessageId**F**</span><span class="sxs-lookup"><span data-stu-id="a90ec-245">InternetMessageId**F**</span></span><br/>|<span data-ttu-id="a90ec-246">InternetMessageId**A**</span><span class="sxs-lookup"><span data-stu-id="a90ec-246">InternetMessageId**A**</span></span><br/><span data-ttu-id="a90ec-247">InternetMessageId**C**</span><span class="sxs-lookup"><span data-stu-id="a90ec-247">InternetMessageId**C**</span></span>|<span data-ttu-id="a90ec-248">InternetMessageId**B**</span><span class="sxs-lookup"><span data-stu-id="a90ec-248">InternetMessageId**B**</span></span> |
||||

<span data-ttu-id="a90ec-249">Se una o più delle proprietà elencate nella tabella della [sezione precedente](#filtering-of-duplicate-audit-records) è diversa, viene generato un record di controllo separato per tenere traccia del nuovo contesto.</span><span class="sxs-lookup"><span data-stu-id="a90ec-249">If any of the properties listed in the table in the [previous section](#filtering-of-duplicate-audit-records) are different, a separate audit record is generated to track the new context.</span></span> <span data-ttu-id="a90ec-250">Gli accessi verranno ordinati nei record di controllo separati in base al contesto in cui si è verificata l'attività.</span><span class="sxs-lookup"><span data-stu-id="a90ec-250">Accesses will be sorted into the separate audit records depending on the context in which the activity took place.</span></span>

<span data-ttu-id="a90ec-251">Ad esempio, nei record di controllo visualizzati nello screenshot seguente, anche se accediamo alla posta elettronica da EWSEditor e OWA contemporaneamente, l'attività di accesso viene raccolta in record di controllo diversi in base al contesto in cui si è verificato l'accesso.</span><span class="sxs-lookup"><span data-stu-id="a90ec-251">For example, in audit records shown in the following screenshot, though we are accessing mail from EWSEditor and OWA simultaneously, the access activity is collated in different audit records depending on the context in which the access took place.</span></span> <span data-ttu-id="a90ec-252">In questo caso, il contesto è definito da valori diversi per la proprietà ClientInfoString.</span><span class="sxs-lookup"><span data-stu-id="a90ec-252">In this case, the context is defined by different values for the ClientInfoString property.</span></span>

![Record di controllo diversi in base al contesto](../media/MailItemsAccessed4.png)
