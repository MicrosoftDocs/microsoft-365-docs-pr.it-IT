---
title: Implementare o distribuire una Customer Key o una chiave di disponibilità
ms.author: krowley
author: kccross
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: Scopri come eseguire il roll-to-roll delle chiavi radice dei clienti archiviate in Azure Key Vault usate con la chiave del cliente. I servizi includono Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business e Teams file.
ms.openlocfilehash: 892d77959bec1fb33b0ea6bcfaa8c530dd9b8911
ms.sourcegitcommit: 94e64afaf12f3d8813099d8ffa46baba65772763
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/12/2021
ms.locfileid: "52345119"
---
# <a name="roll-or-rotate-a-customer-key-or-an-availability-key"></a><span data-ttu-id="ae634-104">Implementare o distribuire una Customer Key o una chiave di disponibilità</span><span class="sxs-lookup"><span data-stu-id="ae634-104">Roll or rotate a Customer Key or an availability key</span></span>

> [!CAUTION]
> <span data-ttu-id="ae634-105">Implementare solo una chiave di crittografia che si usa con customer key quando i requisiti di sicurezza o conformità determinano che è necessario implementare la chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-105">Only roll an encryption key that you use with Customer Key when your security or compliance requirements dictate that you must roll the key.</span></span> <span data-ttu-id="ae634-106">Inoltre, non eliminare le chiavi associate o associate ai criteri.</span><span class="sxs-lookup"><span data-stu-id="ae634-106">In addition, do not delete any keys that are or were associated with policies.</span></span> <span data-ttu-id="ae634-107">Quando si esembono le chiavi, il contenuto verrà crittografato con le chiavi precedenti.</span><span class="sxs-lookup"><span data-stu-id="ae634-107">When you roll your keys, there will be content encrypted with the previous keys.</span></span> <span data-ttu-id="ae634-108">Ad esempio, mentre le cassette postali attive verranno crittografate di frequente, le cassette postali inattive, disconnesse e disabilitate potrebbero comunque essere crittografate con le chiavi precedenti.</span><span class="sxs-lookup"><span data-stu-id="ae634-108">For example, while active mailboxes will be re-encrypted frequently, inactive, disconnected, and disabled mailboxes may still be encrypted with the previous keys.</span></span> <span data-ttu-id="ae634-109">SharePoint Online esegue il backup del contenuto per scopi di ripristino e ripristino, quindi potrebbe essere ancora presente contenuto archiviato con chiavi precedenti.</span><span class="sxs-lookup"><span data-stu-id="ae634-109">SharePoint Online performs backup of content for restore and recovery purposes, so there may still be archived content using older keys.</span></span>

## <a name="about-rolling-the-availability-key"></a><span data-ttu-id="ae634-110">Informazioni sull'implementazione della chiave di disponibilità</span><span class="sxs-lookup"><span data-stu-id="ae634-110">About rolling the availability key</span></span>

<span data-ttu-id="ae634-111">Microsoft non espone ai clienti il controllo diretto della chiave di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="ae634-111">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="ae634-112">Ad esempio, è possibile ruotare solo le chiavi di cui si è proprietari in Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ae634-112">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="ae634-113">Microsoft 365 le chiavi di disponibilità vengono rollie in base a una pianificazione definita internamente.</span><span class="sxs-lookup"><span data-stu-id="ae634-113">Microsoft 365 rolls the availability keys on an internally-defined schedule.</span></span> <span data-ttu-id="ae634-114">Non esiste un contratto di servizio (SLA) rivolto ai clienti per questi rotoli chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-114">There is no customer-facing, service-level agreement (SLA) for these key rolls.</span></span> <span data-ttu-id="ae634-115">Microsoft 365 ruota la chiave di disponibilità usando Microsoft 365 di servizio in un processo automatizzato e non manuale.</span><span class="sxs-lookup"><span data-stu-id="ae634-115">Microsoft 365 rotates the availability key using Microsoft 365 service code in an automated, non-manual process.</span></span> <span data-ttu-id="ae634-116">Gli amministratori Microsoft possono avviare il processo di roll.</span><span class="sxs-lookup"><span data-stu-id="ae634-116">Microsoft administrators may initiate the roll process.</span></span> <span data-ttu-id="ae634-117">La chiave viene rollata utilizzando meccanismi automatizzati senza accesso diretto all'archivio chiavi.</span><span class="sxs-lookup"><span data-stu-id="ae634-117">The key is rolled using automated mechanisms without direct access to the key store.</span></span> <span data-ttu-id="ae634-118">L'accesso all'archivio segreto chiave di disponibilità non viene effettuato agli amministratori Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ae634-118">Access to the availability key secret store is not provisioned to Microsoft administrators.</span></span> <span data-ttu-id="ae634-119">L'implementazione della chiave di disponibilità sfrutta lo stesso meccanismo usato per generare inizialmente la chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-119">Availability key rolling leverages the same mechanism used to initially generate the key.</span></span> <span data-ttu-id="ae634-120">Per ulteriori informazioni sulla chiave di disponibilità, vedere [Informazioni sulla chiave di disponibilità.](customer-key-availability-key-understand.md)</span><span class="sxs-lookup"><span data-stu-id="ae634-120">For more information about the availability key, see [Understand the availability key](customer-key-availability-key-understand.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ae634-121">Exchange Online e Skype for Business di disponibilità possono essere effettivamente rollate dai clienti che creano una nuova protezione esecuzione programmi, poiché viene generata una chiave di disponibilità univoca per ogni protezione esecuzione programmi creata.</span><span class="sxs-lookup"><span data-stu-id="ae634-121">Exchange Online and Skype for Business availability keys can be effectively rolled by customers creating a new DEP, since a unique availability key is generated for each DEP you create.</span></span> <span data-ttu-id="ae634-122">Le chiavi di disponibilità per i file di SharePoint Online, OneDrive for Business e Teams sono presenti a livello di foresta e sono condivise tra i dep e i clienti, il che significa che il roll-on viene eseguito solo in base a una pianificazione definita internamente da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ae634-122">Availability keys for SharePoint Online, OneDrive for Business, and Teams files exist at the forest level and are shared across DEPs and customers, which means rolling only occurs at a Microsoft internally defined schedule.</span></span> <span data-ttu-id="ae634-123">Per ridurre il rischio di non implementare la chiave di disponibilità ogni volta che viene creata una nuova protezione esecuzione programmi, SharePoint, OneDrive e Teams rotolano la chiave intermedia del tenant (TIK), la chiave racchiusa dalle chiavi radice del cliente e dalla chiave di disponibilità, ogni volta che viene creata una nuova protezione esecuzione programmi.</span><span class="sxs-lookup"><span data-stu-id="ae634-123">To mitigate the risk of not rolling the availability key each time a new DEP is created, SharePoint, OneDrive, and Teams roll the tenant intermediate key (TIK), the key wrapped by the customer root keys and availability key, each time a new DEP is created.</span></span>

## <a name="request-a-new-version-of-each-existing-root-key-you-want-to-roll"></a><span data-ttu-id="ae634-124">Richiedere una nuova versione di ogni chiave radice esistente che si desidera implementare</span><span class="sxs-lookup"><span data-stu-id="ae634-124">Request a new version of each existing root key you want to roll</span></span>

<span data-ttu-id="ae634-125">Quando si esegue il roll-to-roll di una chiave, si richiede una nuova versione di una chiave esistente.</span><span class="sxs-lookup"><span data-stu-id="ae634-125">When you roll a key, you request a new version of an existing key.</span></span> <span data-ttu-id="ae634-126">Per richiedere una nuova versione di una chiave esistente, utilizzare lo stesso [cmdlet, Add-AzKeyVaultKey](/powershell/module/az.keyvault/add-azkeyvaultkey), con la stessa sintassi utilizzata per creare la chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-126">To request a new version of an existing key, you use the same cmdlet, [Add-AzKeyVaultKey](/powershell/module/az.keyvault/add-azkeyvaultkey), with the same syntax that you used to create the key in the first place.</span></span> <span data-ttu-id="ae634-127">Dopo aver completato l'esecuzione di qualsiasi chiave associata a un criterio di crittografia dei dati, eseguire un altro cmdlet per assicurarsi che Customer Key inizi a utilizzare la nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-127">After you've finished rolling any key associated with a Data Encryption Policy (DEP), you run another cmdlet to ensure that Customer Key begins using the new key.</span></span> <span data-ttu-id="ae634-128">Eseguire questo passaggio in ogni Azure Key Vault (AKV).</span><span class="sxs-lookup"><span data-stu-id="ae634-128">Do this step in each Azure Key Vault (AKV).</span></span>

<span data-ttu-id="ae634-129">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="ae634-129">For example:</span></span>

1. <span data-ttu-id="ae634-130">Accedi alla sottoscrizione di Azure con Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ae634-130">Sign in to your Azure subscription with Azure PowerShell.</span></span> <span data-ttu-id="ae634-131">Per istruzioni, vedere [Sign in with Azure PowerShell](/powershell/azure/authenticate-azureps).</span><span class="sxs-lookup"><span data-stu-id="ae634-131">For instructions, see [Sign in with Azure PowerShell](/powershell/azure/authenticate-azureps).</span></span>

2. <span data-ttu-id="ae634-132">Eseguire il cmdlet Add-AzKeyVaultKey come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="ae634-132">Run the Add-AzKeyVaultKey cmdlet as shown in the following example:</span></span>

   ```powershell
   Add-AzKeyVaultKey -VaultName Contoso-CK-EX-NA-VaultA1 -Name Contoso-CK-EX-NA-VaultA1-Key001 -Destination HSM -KeyOps @('wrapKey','unwrapKey') -NotBefore (Get-Date -Date "12/27/2016 12:01 AM")
   ```

   <span data-ttu-id="ae634-133">In questo esempio, poiché una chiave denominata **Contoso-CK-EX-NA-VaultA1-Key001** è presente nell'insieme di credenziali **Contoso-CK-EX-NA-VaultA1,** il cmdlet crea una nuova versione della chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-133">In this example, since a key named **Contoso-CK-EX-NA-VaultA1-Key001** exists in the **Contoso-CK-EX-NA-VaultA1** vault, the cmdlet creates a new version of the key.</span></span> <span data-ttu-id="ae634-134">Questa operazione mantiene le versioni chiave precedenti nella cronologia delle versioni per la chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-134">This operation preserves the previous key versions in the version history for the key.</span></span> <span data-ttu-id="ae634-135">È necessaria la versione precedente della chiave per decrittografare i dati ancora crittografati.</span><span class="sxs-lookup"><span data-stu-id="ae634-135">You need the previous key version to decrypt the data that it still encrypts.</span></span> <span data-ttu-id="ae634-136">Dopo aver completato il rollover di una chiave associata a protezione esecuzione programmi, eseguire un cmdlet aggiuntivo per assicurarsi che customer key inizi a usare la nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-136">Once you complete rolling any key associated with a DEP,  run an extra cmdlet to ensure that Customer Key begins using the new key.</span></span> <span data-ttu-id="ae634-137">Le sezioni seguenti descrivono i cmdlet in modo più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="ae634-137">The following sections describe the cmdlets in more detail.</span></span>
  
## <a name="update-the-keys-for-multi-workload-deps"></a><span data-ttu-id="ae634-138">Aggiornare le chiavi per i DEP multi-carico di lavoro</span><span class="sxs-lookup"><span data-stu-id="ae634-138">Update the keys for multi-workload DEPs</span></span>

<span data-ttu-id="ae634-139">Quando si esegue il rollover di una delle chiavi di Azure Key Vault associate a una protezione esecuzione programmi usata con più carichi di lavoro, è necessario aggiornare protezione esecuzione programmi in modo che punti alla nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-139">When you roll either of the Azure Key Vault keys associated with a DEP used with multiple workloads, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="ae634-140">Questo processo non ruota la chiave di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="ae634-140">This process does not rotate the availability key.</span></span>

<span data-ttu-id="ae634-141">Per indicare a Customer Key di usare la nuova chiave per crittografare più carichi di lavoro, completare questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="ae634-141">To instruct Customer Key to use the new key to encrypt multiple workloads, complete these steps:</span></span>

1. <span data-ttu-id="ae634-142">Nel computer locale, utilizzando un account aziendale o dell'istituto di istruzione con autorizzazioni di amministratore globale o amministratore di conformità nell'organizzazione, connettersi a [Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) in una finestra Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ae634-142">On your local computer, using a work or school account that has global administrator or compliance admin permissions in your organization, [connect to Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) in a Windows PowerShell window.</span></span>

2. <span data-ttu-id="ae634-143">Eseguire il cmdlet Set-M365DataAtRestEncryptionPolicy.</span><span class="sxs-lookup"><span data-stu-id="ae634-143">Run the Set-M365DataAtRestEncryptionPolicy cmdlet.</span></span>
  
   ```powershell
   Set-M365DataAtRestEncryptionPolicy -[Identity] "PolicyName" -Refresh
   ```

<span data-ttu-id="ae634-144">Dove *PolicyName* è il nome o l'ID univoco del criterio.</span><span class="sxs-lookup"><span data-stu-id="ae634-144">Where *PolicyName* is the name or unique ID of the policy.</span></span> <span data-ttu-id="ae634-145">Ad esempio, Contoso_Global.</span><span class="sxs-lookup"><span data-stu-id="ae634-145">For example, Contoso_Global.</span></span>

<span data-ttu-id="ae634-146">Esempio:</span><span class="sxs-lookup"><span data-stu-id="ae634-146">Example:</span></span>

```powershell
Set-M365DataAtRestEncryptionPolicy -Identity "Contoso_Global" -Refresh
```

## <a name="update-the-keys-for-exchange-online-deps"></a><span data-ttu-id="ae634-147">Aggiornare le chiavi per Exchange Online DEP</span><span class="sxs-lookup"><span data-stu-id="ae634-147">Update the keys for Exchange Online DEPs</span></span>

<span data-ttu-id="ae634-148">Quando si esegue il rollover di una delle chiavi di Azure Key Vault associate a una protezione esecuzione programmi usata con Exchange Online e Skype for Business, è necessario aggiornare protezione esecuzione programmi in modo che punti alla nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-148">When you roll either of the Azure Key Vault keys associated with a DEP used with Exchange Online and Skype for Business, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="ae634-149">In questo modo non viene ruotata la chiave di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="ae634-149">This does not rotate the availability key.</span></span>

<span data-ttu-id="ae634-150">Per indicare a Customer Key di utilizzare la nuova chiave per crittografare le cassette postali, eseguire il cmdlet Set-DataEncryptionPolicy seguente:</span><span class="sxs-lookup"><span data-stu-id="ae634-150">To instruct Customer Key to use the new key to encrypt mailboxes, run the Set-DataEncryptionPolicy cmdlet as follows:</span></span>

1. <span data-ttu-id="ae634-151">Eseguire il cmdlet Set-DataEncryptionPolicy in Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="ae634-151">Run the Set-DataEncryptionPolicy cmdlet in Azure PowerShell:</span></span>
  
   ```powershell
   Set-DataEncryptionPolicy -Identity <DataEncryptionPolicyID> -Refresh
   ```

2. <span data-ttu-id="ae634-152">Per controllare il valore della proprietà DataEncryptionPolicyID per la cassetta postale, utilizzare la procedura descritta in [Determine the DEP assigned to a mailbox](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox).</span><span class="sxs-lookup"><span data-stu-id="ae634-152">To check the value for the DataEncryptionPolicyID property for the mailbox, use the steps in [Determine the DEP assigned to a mailbox](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox).</span></span> <span data-ttu-id="ae634-153">Il valore di questa proprietà cambia dopo che il servizio ha applicato la chiave aggiornata.</span><span class="sxs-lookup"><span data-stu-id="ae634-153">The value for this property changes once the service applies the updated key.</span></span>
  
## <a name="update-the-keys-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="ae634-154">Aggiornare le chiavi per SharePoint online, OneDrive for Business e Teams file</span><span class="sxs-lookup"><span data-stu-id="ae634-154">Update the keys for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="ae634-155">SharePoint Online consente solo di eseguire il roll-time di una chiave alla volta.</span><span class="sxs-lookup"><span data-stu-id="ae634-155">SharePoint Online only allows you to roll one key at a time.</span></span> <span data-ttu-id="ae634-156">Se si desidera eseguire il roll-to-roll di entrambe le chiavi in un insieme di credenziali delle chiavi, attendere il completamento della prima operazione.</span><span class="sxs-lookup"><span data-stu-id="ae634-156">If you want to roll both keys in a key vault, wait for the first operation to complete.</span></span> <span data-ttu-id="ae634-157">Microsoft consiglia di scaglionare le operazioni per evitare questo problema.</span><span class="sxs-lookup"><span data-stu-id="ae634-157">Microsoft recommends that you stagger your operations to avoid this issue.</span></span> <span data-ttu-id="ae634-158">Quando si esegue il rollover di una delle chiavi di Azure Key Vault associate a una protezione esecuzione programmi usata con SharePoint Online e OneDrive for Business, è necessario aggiornare protezione esecuzione programmi in modo che punti alla nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="ae634-158">When you roll either of the Azure Key Vault keys associated with a DEP used with SharePoint Online and OneDrive for Business, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="ae634-159">In questo modo non viene ruotata la chiave di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="ae634-159">This does not rotate the availability key.</span></span>

1. <span data-ttu-id="ae634-160">Eseguire il cmdlet Update-SPODataEncryptionPolicy seguente:</span><span class="sxs-lookup"><span data-stu-id="ae634-160">Run the Update-SPODataEncryptionPolicy cmdlet as follows:</span></span>
  
   ```powershell
   Update-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl> -KeyVaultName <ReplacementKeyVaultName> -KeyName <ReplacementKeyName> -KeyVersion <ReplacementKeyVersion> -KeyType <Primary | Secondary>
   ```

   <span data-ttu-id="ae634-161">Mentre questo cmdlet avvia l'operazione di rollio delle chiavi per SharePoint Online e OneDrive for Business, l'azione non viene completata immediatamente.</span><span class="sxs-lookup"><span data-stu-id="ae634-161">While this cmdlet starts the key roll operation for SharePoint Online and OneDrive for Business, the action doesn't complete immediately.</span></span>

2. <span data-ttu-id="ae634-162">Per visualizzare lo stato dell'operazione di roll-to-key, eseguire il cmdlet Get-SPODataEncryptionPolicy seguente:</span><span class="sxs-lookup"><span data-stu-id="ae634-162">To see the progress of the key roll operation, run the Get-SPODataEncryptionPolicy cmdlet as follows:</span></span>

   ```powershell
   Get-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl>
   ```

## <a name="related-articles"></a><span data-ttu-id="ae634-163">Articoli correlati</span><span class="sxs-lookup"><span data-stu-id="ae634-163">Related articles</span></span>

- [<span data-ttu-id="ae634-164">Crittografia del servizio con chiave cliente per Office 365</span><span class="sxs-lookup"><span data-stu-id="ae634-164">Service encryption with Customer Key for Office 365</span></span>](customer-key-overview.md)

- [<span data-ttu-id="ae634-165">Configurare Customer Key per Office 365</span><span class="sxs-lookup"><span data-stu-id="ae634-165">Set up Customer Key for Office 365</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="ae634-166">Gestire Customer Key per Office 365</span><span class="sxs-lookup"><span data-stu-id="ae634-166">Manage Customer Key for Office 365</span></span>](customer-key-manage.md)

- [<span data-ttu-id="ae634-167">Informazioni sulla chiave di disponibilità</span><span class="sxs-lookup"><span data-stu-id="ae634-167">Learn about the availability key</span></span>](customer-key-availability-key-understand.md)