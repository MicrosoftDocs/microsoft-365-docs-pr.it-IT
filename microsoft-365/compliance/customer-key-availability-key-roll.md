---
title: Eseguire il rollforward o la rotazione di una chiave del cliente o di una chiave di disponibilità
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: Informazioni su come eseguire il rollback delle chiavi principali del cliente archiviate in Azure Key Vault che vengono utilizzate con la chiave del cliente di Office 365. I servizi includono Exchange Online, Skype for business, SharePoint Online, OneDrive for business e i file dei team.
ms.openlocfilehash: 9699960666eaa9aa62bb027d3a4549cb50cd52e3
ms.sourcegitcommit: 5ff1dc62e8855be155cb2de45cf4ee5a02c321fd
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/06/2020
ms.locfileid: "41804812"
---
# <a name="roll-or-rotate-a-customer-key-or-an-availability-key"></a><span data-ttu-id="b21dd-104">Eseguire il rollforward o la rotazione di una chiave del cliente o di una chiave di disponibilità</span><span class="sxs-lookup"><span data-stu-id="b21dd-104">Roll or rotate a Customer Key or an availability key</span></span>

> [!CAUTION]
> <span data-ttu-id="b21dd-105">Eseguire il rollforward di una chiave di crittografia da utilizzare con il codice "Customer Key" quando i requisiti di sicurezza o conformità prevedono che è necessario ripristinare la chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-105">Only roll an encryption key that you use with Customer Key when your security or compliance requirements dictate that you must roll the key.</span></span> <span data-ttu-id="b21dd-106">Inoltre, non eliminare le chiavi che sono o sono state associate ai criteri.</span><span class="sxs-lookup"><span data-stu-id="b21dd-106">In addition, do not delete any keys that are or were associated with policies.</span></span> <span data-ttu-id="b21dd-107">Quando si esegue il rollback delle chiavi, verranno crittografati i contenuti con le chiavi precedenti.</span><span class="sxs-lookup"><span data-stu-id="b21dd-107">When you roll your keys, there will be content encrypted with the previous keys.</span></span> <span data-ttu-id="b21dd-108">Ad esempio, mentre le cassette postali attive verranno crittografate di frequente, le cassette postali inattive, disconnesse e disabilitate potrebbero essere ancora crittografate con le chiavi precedenti.</span><span class="sxs-lookup"><span data-stu-id="b21dd-108">For example, while active mailboxes will be re-encrypted frequently, inactive, disconnected, and disabled mailboxes may still be encrypted with the previous keys.</span></span> <span data-ttu-id="b21dd-109">SharePoint Online esegue il backup del contenuto per scopi di ripristino e ripristino, per cui è possibile che il contenuto archiviato sia ancora utilizzato con i tasti precedenti.</span><span class="sxs-lookup"><span data-stu-id="b21dd-109">SharePoint Online performs backup of content for restore and recovery purposes, so there may still be archived content using older keys.</span></span>

## <a name="about-rolling-the-availability-key"></a><span data-ttu-id="b21dd-110">Informazioni su Rolling The availability Key</span><span class="sxs-lookup"><span data-stu-id="b21dd-110">About rolling the availability key</span></span>

<span data-ttu-id="b21dd-111">Microsoft non espone il controllo diretto della chiave di disponibilità ai clienti.</span><span class="sxs-lookup"><span data-stu-id="b21dd-111">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="b21dd-112">Ad esempio, è possibile eseguire il rollback solo delle chiavi di cui si dispone in Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="b21dd-112">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="b21dd-113">Office 365 esegue il rollback delle chiavi di disponibilità in base a una pianificazione definita internamente.</span><span class="sxs-lookup"><span data-stu-id="b21dd-113">Office 365 rolls the availability keys on an internally-defined schedule.</span></span> <span data-ttu-id="b21dd-114">Non è previsto alcun contratto di servizio per questi rotoli di chiavi.</span><span class="sxs-lookup"><span data-stu-id="b21dd-114">There is no customer-facing, service-level agreement (SLA) for these key rolls.</span></span> <span data-ttu-id="b21dd-115">Office 365 ruota la chiave di disponibilità utilizzando il codice del servizio di Office 365 in un processo automatizzato e non manuale.</span><span class="sxs-lookup"><span data-stu-id="b21dd-115">Office 365 rotates the availability key using Office 365 service code in an automated, non-manual process.</span></span> <span data-ttu-id="b21dd-116">Gli amministratori di Microsoft possono avviare il processo di rollforward.</span><span class="sxs-lookup"><span data-stu-id="b21dd-116">Microsoft administrators may initiate the roll process.</span></span> <span data-ttu-id="b21dd-117">La chiave viene rotolata utilizzando meccanismi automatici senza accesso diretto all'archivio delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="b21dd-117">The key is rolled using automated mechanisms without direct access to the key store.</span></span> <span data-ttu-id="b21dd-118">L'accesso all'archivio segreto della chiave di disponibilità non viene eseguito a Microsoft Administrators.</span><span class="sxs-lookup"><span data-stu-id="b21dd-118">Access to the availability key secret store is not provisioned to Microsoft administrators.</span></span> <span data-ttu-id="b21dd-119">Chiave di disponibilità la rotazione utilizza lo stesso meccanismo utilizzato per generare inizialmente la chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-119">Availability key rolling leverages the same mechanism used to initially generate the key.</span></span> <span data-ttu-id="b21dd-120">Per ulteriori informazioni sulla chiave di disponibilità, vedere [understand the availability Key](customer-key-availability-key-understand.md).</span><span class="sxs-lookup"><span data-stu-id="b21dd-120">For more information about the availability key, see [Understand the availability key](customer-key-availability-key-understand.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b21dd-121">Le chiavi di disponibilità di Exchange Online e Skype for business possono essere effettivamente arrotolate dai clienti che creano una nuova funzionalità di protezione esecuzione programmi, poiché viene generata una chiave di disponibilità univoca per ogni DEP creato.</span><span class="sxs-lookup"><span data-stu-id="b21dd-121">Exchange Online and Skype for Business availability keys can be effectively rolled by customers creating a new DEP, since a unique availability key is generated for each DEP you create.</span></span> <span data-ttu-id="b21dd-122">Le chiavi di disponibilità per SharePoint Online, OneDrive for business e i file di teams esistono a livello di foresta e sono condivise tra DEPs e Customers, il che significa che il rollforward si verifica solo in base a una pianificazione definita internamente da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b21dd-122">Availability keys for SharePoint Online, OneDrive for Business, and Teams files exist at the forest level and are shared across DEPs and customers, which means rolling only occurs at a Microsoft internally defined schedule.</span></span> <span data-ttu-id="b21dd-123">Per ridurre il rischio di non rotolare la chiave di disponibilità ogni volta che viene creata una nuova protezione esecuzione programmi, SharePoint, OneDrive e teams eseguono il rollforward del tasto di intermediazione del tenant, la chiave racchiusa tra le chiavi principali del cliente e la chiave di disponibilità, ogni volta che viene creata una nuova protezione esecuzione programmi.</span><span class="sxs-lookup"><span data-stu-id="b21dd-123">To mitigate the risk of not rolling the availability key each time a new DEP is created, SharePoint, OneDrive, and Teams roll the tenant intermediate key (TIK), the key wrapped by the customer root keys and availability key, each time a new DEP is created.</span></span>

## <a name="request-a-new-version-of-each-existing-root-key-you-want-to-roll"></a><span data-ttu-id="b21dd-124">Richiedere una nuova versione di ogni chiave radice esistente che si desidera eseguire il rollback</span><span class="sxs-lookup"><span data-stu-id="b21dd-124">Request a new version of each existing root key you want to roll</span></span>

<span data-ttu-id="b21dd-125">Quando si esegue il rollback di una chiave, viene richiesta una nuova versione di una chiave esistente.</span><span class="sxs-lookup"><span data-stu-id="b21dd-125">When you roll a key, you request a new version of an existing key.</span></span> <span data-ttu-id="b21dd-126">Per richiedere una nuova versione di una chiave esistente, è necessario utilizzare lo stesso cmdlet [Add-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/add-azkeyvaultkey), con la stessa sintassi utilizzata per creare la chiave in primo luogo.</span><span class="sxs-lookup"><span data-stu-id="b21dd-126">To request a new version of an existing key, you use the same cmdlet, [Add-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/add-azkeyvaultkey), with the same syntax that you used to create the key in the first place.</span></span> <span data-ttu-id="b21dd-127">Dopo aver completato il rollforward di qualsiasi tasto associato a un criterio di crittografia dei dati, è possibile eseguire un altro cmdlet per assicurarsi che la chiave del cliente inizi a utilizzare la nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-127">After you’ve finished rolling any key associated with a Data Encryption Policy (DEP), you run another cmdlet to ensure that Customer Key begins using the new key.</span></span> <span data-ttu-id="b21dd-128">Eseguire questo passaggio in ogni Vault Key di Azure (AKV).</span><span class="sxs-lookup"><span data-stu-id="b21dd-128">Do this step in each Azure Key Vault (AKV).</span></span>

<span data-ttu-id="b21dd-129">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="b21dd-129">For example:</span></span>

1. <span data-ttu-id="b21dd-130">Accedere alla sottoscrizione di Azure con Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b21dd-130">Sign in to your Azure subscription with Azure PowerShell.</span></span> <span data-ttu-id="b21dd-131">Per istruzioni, vedere [accedere con Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span><span class="sxs-lookup"><span data-stu-id="b21dd-131">For instructions, see [Sign in with Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span></span>

2. <span data-ttu-id="b21dd-132">Eseguire il cmdlet Add-AzKeyVaultKey come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="b21dd-132">Run the Add-AzKeyVaultKey cmdlet as shown in the following example:</span></span>

   ```powershell
   Add-AzKeyVaultKey -VaultName Contoso-O365EX-NA-VaultA1 -Name Contoso-O365EX-NA-VaultA1-Key001 -Destination HSM -KeyOps @('wrapKey','unwrapKey') -NotBefore (Get-Date -Date "12/27/2016 12:01 AM")
   ```

   <span data-ttu-id="b21dd-133">In questo esempio, poiché una chiave denominata **Contoso-O365EX-na-VaultA1-Key001** esiste nel Vault **Contoso-O365EX-na-VaultA1** , il cmdlet crea una nuova versione della chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-133">In this example, since a key named **Contoso-O365EX-NA-VaultA1-Key001** exists in the **Contoso-O365EX-NA-VaultA1** vault, the cmdlet creates a new version of the key.</span></span> <span data-ttu-id="b21dd-134">Questa operazione consente di conservare le versioni principali precedenti nella cronologia delle versioni per la chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-134">This operation preserves the previous key versions in the version history for the key.</span></span> <span data-ttu-id="b21dd-135">È necessaria la versione precedente della chiave per decrittografare i dati che vengono ancora crittografati.</span><span class="sxs-lookup"><span data-stu-id="b21dd-135">You need the previous key version to decrypt the data that it still encrypts.</span></span> <span data-ttu-id="b21dd-136">Dopo aver completato il rollforward di qualsiasi tasto associato a una funzionalità di protezione esecuzione programmi, eseguire un cmdlet aggiuntivo per assicurarsi che la chiave del cliente inizi a utilizzare la nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-136">Once you complete rolling any key associated with a DEP,  run an extra cmdlet to ensure that Customer Key begins using the new key.</span></span> <span data-ttu-id="b21dd-137">Nelle sezioni seguenti vengono descritti i cmdlet in modo più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="b21dd-137">The following sections describe the cmdlets in more detail.</span></span>
  
## <a name="update-the-customer-key-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="b21dd-138">Aggiornare la chiave del cliente per Exchange Online e Skype for business</span><span class="sxs-lookup"><span data-stu-id="b21dd-138">Update the Customer Key for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="b21dd-139">Quando si esegue il rollback delle chiavi del Vault Key di Azure associate a una DEP utilizzata con Exchange Online e Skype for business, è necessario aggiornare la funzionalità DEP in modo che punti alla nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-139">When you roll either of the Azure Key Vault keys associated with a DEP used with Exchange Online and Skype for Business, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="b21dd-140">La chiave di disponibilità non viene ruotata.</span><span class="sxs-lookup"><span data-stu-id="b21dd-140">This does not rotate the availability key.</span></span>

<span data-ttu-id="b21dd-141">Per indicare alla chiave del cliente di utilizzare la nuova chiave per crittografare le cassette postali in Office 365, eseguire il cmdlet Set-DataEncryptionPolicy come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="b21dd-141">To instruct Customer Key to use the new key to encrypt mailboxes in Office 365 run the Set-DataEncryptionPolicy cmdlet as follows:</span></span>

1. <span data-ttu-id="b21dd-142">Eseguire il cmdlet Set-DataEncryptionPolicy in Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="b21dd-142">Run the Set-DataEncryptionPolicy cmdlet in Azure PowerShell:</span></span>
  
   ```powershell
   Set-DataEncryptionPolicy -Identity <DataEncryptionPolicyID> -Refresh
   ```

   <span data-ttu-id="b21dd-143">Entro 72 ore, le cassette postali attive associate a questo DEP diventano crittografate con la nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-143">Within 72 hours, the active mailboxes associated with this DEP become encrypted with the new key.</span></span>

2. <span data-ttu-id="b21dd-144">Per controllare il valore della proprietà DataEncryptionPolicyID per la cassetta postale, attenersi alla procedura descritta in [determinare la funzionalità DEP assegnata a una cassetta postale](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox).</span><span class="sxs-lookup"><span data-stu-id="b21dd-144">To check the value for the DataEncryptionPolicyID property for the mailbox, use the steps in [Determine the DEP assigned to a mailbox](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox).</span></span> <span data-ttu-id="b21dd-145">Il valore di questa proprietà viene modificato dopo che il servizio ha applicato la chiave aggiornata.</span><span class="sxs-lookup"><span data-stu-id="b21dd-145">The value for this property changes once the service applies the updated key.</span></span>
  
## <a name="update-the-customer-key-for-sharepointonlineonedriveforbusinessandteamsfiles"></a><span data-ttu-id="b21dd-146">Aggiornare la chiave del cliente per i file di SharePoint Online, OneDrive for business e teams</span><span class="sxs-lookup"><span data-stu-id="b21dd-146">Update the Customer Key for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="b21dd-147">SharePoint Online consente solo di eseguire il rollforward di una chiave alla volta.</span><span class="sxs-lookup"><span data-stu-id="b21dd-147">SharePoint Online only allows you to roll one key at a time.</span></span> <span data-ttu-id="b21dd-148">Se si desidera eseguire il rollforward di entrambe le chiavi in un Vault chiave, attendere che venga completata la prima operazione.</span><span class="sxs-lookup"><span data-stu-id="b21dd-148">If you want to roll both keys in a key vault, wait for the first operation to complete.</span></span> <span data-ttu-id="b21dd-149">Microsoft consiglia di scaglionare le operazioni per evitare questo problema.</span><span class="sxs-lookup"><span data-stu-id="b21dd-149">Microsoft recommends that you stagger your operations to avoid this issue.</span></span> <span data-ttu-id="b21dd-150">Quando si esegue il rollback delle chiavi del Vault Key di Azure associate a una DEP utilizzata con SharePoint Online e OneDrive for business, è necessario aggiornare la funzionalità DEP in modo che punti alla nuova chiave.</span><span class="sxs-lookup"><span data-stu-id="b21dd-150">When you roll either of the Azure Key Vault keys associated with a DEP used with SharePoint Online and OneDrive for Business, you must update the DEP to point to the new key.</span></span> <span data-ttu-id="b21dd-151">La chiave di disponibilità non viene ruotata.</span><span class="sxs-lookup"><span data-stu-id="b21dd-151">This does not rotate the availability key.</span></span>

1. <span data-ttu-id="b21dd-152">Eseguire il cmdlet Update-SPODataEncryptionPolicy come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="b21dd-152">Run the Update-SPODataEncryptionPolicy cmdlet as follows:</span></span>
  
   ```powershell
   Update-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl> -KeyVaultName <ReplacementKeyVaultName> -KeyName <ReplacementKeyName> -KeyVersion <ReplacementKeyVersion> -KeyType <Primary | Secondary>
   ```

   <span data-ttu-id="b21dd-153">Anche se questo cmdlet avvia l'operazione di rollforward delle chiavi per SharePoint Online e OneDrive for business, l'azione non viene completata immediatamente.</span><span class="sxs-lookup"><span data-stu-id="b21dd-153">While this cmdlet starts the key roll operation for SharePoint Online and OneDrive for Business, the action doesn't complete immediately.</span></span>

2. <span data-ttu-id="b21dd-154">Per visualizzare lo stato dell'operazione di rollforward delle chiavi, eseguire il cmdlet Get-SPODataEncryptionPolicy nel modo riportato di seguito:</span><span class="sxs-lookup"><span data-stu-id="b21dd-154">To see the progress of the key roll operation, run the Get-SPODataEncryptionPolicy cmdlet as follows:</span></span>

   ```powershell
   Get-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl>
   ```

## <a name="related-articles"></a><span data-ttu-id="b21dd-155">Articoli correlati</span><span class="sxs-lookup"><span data-stu-id="b21dd-155">Related articles</span></span>

- [<span data-ttu-id="b21dd-156">Crittografia del servizio con la chiave del cliente per Office 365</span><span class="sxs-lookup"><span data-stu-id="b21dd-156">Service encryption with Customer Key for Office 365</span></span>](customer-key-overview.md)

- [<span data-ttu-id="b21dd-157">Configurare la chiave cliente per Office 365</span><span class="sxs-lookup"><span data-stu-id="b21dd-157">Set up Customer Key for Office 365</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="b21dd-158">Gestire la chiave del cliente per Office 365</span><span class="sxs-lookup"><span data-stu-id="b21dd-158">Manage Customer Key for Office 365</span></span>](customer-key-manage.md)

- [<span data-ttu-id="b21dd-159">Informazioni sulla chiave di disponibilità</span><span class="sxs-lookup"><span data-stu-id="b21dd-159">Learn about the availability key</span></span>](customer-key-availability-key-understand.md)
