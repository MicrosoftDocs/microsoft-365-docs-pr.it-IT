---
title: Implementazione di ExpressRoute per Office 365
ms.author: kvice
author: kelleyvice-msft
manager: laurawi
ms.date: 12/5/2017
audience: ITPro
ms.topic: conceptual
ms.service: o365-administration
localization_priority: Normal
ms.collection: Ent_O365
f1.keywords:
- CSH
ms.custom:
- Adm_O365
- seo-marvel-apr2020
search.appverid:
- MET150
- MOE150
- BCS160
ms.assetid: 77735c9d-8b80-4d2f-890e-a8598547dea6
description: Informazioni su come implementare ExpressRoute per Office 365, che fornisce un percorso di routing alternativo a molti servizi di Office 365 Internet.
ms.openlocfilehash: 3ad6102193a12325de0e4bb2ff16087738688587
ms.sourcegitcommit: be929f79751c0c52dfa6bd98a854432a0c63faf0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/14/2021
ms.locfileid: "52924940"
---
# <a name="implementing-expressroute-for-office-365"></a><span data-ttu-id="2f11c-103">Implementazione di ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-103">Implementing ExpressRoute for Office 365</span></span>

<span data-ttu-id="2f11c-104">*Questo articolo si applica sia a Microsoft 365 Enterprise che a Office 365 Enterprise*.</span><span class="sxs-lookup"><span data-stu-id="2f11c-104">*This article applies to both Microsoft 365 Enterprise and Office 365 Enterprise.*</span></span>

<span data-ttu-id="2f11c-105">ExpressRoute per Office 365 fornisce un percorso di routing alternativo a molti servizi Office 365 Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-105">ExpressRoute for Office 365 provides an alternate routing path to many internet facing Office 365 services.</span></span> <span data-ttu-id="2f11c-106">L'architettura di ExpressRoute per Office 365 si basa sulla pubblicità di prefissi IP pubblici di servizi Office 365 già accessibili tramite Internet nei circuiti ExpressRoute di cui è stato effettuato il provisioning per la successiva ridistribuzione di tali prefissi IP nella rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-106">The architecture of ExpressRoute for Office 365 is based on advertising public IP prefixes of Office 365 services that are already accessible over the Internet into your provisioned ExpressRoute circuits for subsequent redistribution of those IP prefixes into your network.</span></span> <span data-ttu-id="2f11c-107">Con ExpressRoute è possibile abilitare in modo efficace diversi percorsi di routing, tramite Internet e tramite ExpressRoute, per molti Office 365 servizi.</span><span class="sxs-lookup"><span data-stu-id="2f11c-107">With ExpressRoute you effectively enable several different routing paths, through the internet and through ExpressRoute, for many Office 365 services.</span></span> <span data-ttu-id="2f11c-108">Questo stato di routing nella rete può rappresentare una modifica significativa alla modalità di progettazione della topologia di rete interna.</span><span class="sxs-lookup"><span data-stu-id="2f11c-108">This state of routing on your network may represent a significant change to how your internal network topology is designed.</span></span>
  
 <span data-ttu-id="2f11c-109">**Stato:** Guida completa v2</span><span class="sxs-lookup"><span data-stu-id="2f11c-109">**Status:** Complete Guide v2</span></span>
  
<span data-ttu-id="2f11c-110">È necessario pianificare con attenzione ExpressRoute per l'implementazione di Office 365 per soddisfare le complessità di rete di disponibilità del routing tramite un circuito dedicato con route iniettate nella rete principale e in Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-110">You must carefully plan your ExpressRoute for Office 365 implementation to accommodate for the network complexities of having routing available via both a dedicated circuit with routes injected into your core network and the internet.</span></span> <span data-ttu-id="2f11c-111">Se l'utente e il team non eseguono la pianificazione e i test dettagliati in questa guida, esiste un rischio elevato che si verifichi intermittente o una perdita totale di connettività ai servizi Office 365 quando il circuito ExpressRoute è abilitato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-111">If you and your team don't perform the detailed planning and testing in this guide, there is a high risk you'll experience intermittent or a total loss of connectivity to Office 365 services when the ExpressRoute circuit is enabled.</span></span>
  
<span data-ttu-id="2f11c-112">Per ottenere un'implementazione corretta, è necessario analizzare i requisiti dell'infrastruttura, esaminare la valutazione e la progettazione dettagliate della rete, pianificare attentamente l'implementazione in modo a fasi e controllato e creare un piano di convalida e test dettagliato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-112">To have a successful implementation, you will need to analyze your infrastructure requirements, go through detailed network assessment and design, carefully plan the rollout in a staged and controlled manner, and build a detailed validation and testing plan.</span></span> <span data-ttu-id="2f11c-113">Per un ambiente distribuito di grandi dimensioni non è raro vedere le implementazioni che si estendono per diversi mesi.</span><span class="sxs-lookup"><span data-stu-id="2f11c-113">For a large, distributed environment it's not uncommon to see implementations span several months.</span></span> <span data-ttu-id="2f11c-114">Questa guida è progettata per aiutarti a pianificare in anticipo.</span><span class="sxs-lookup"><span data-stu-id="2f11c-114">This guide is designed to help you plan ahead.</span></span>
  
<span data-ttu-id="2f11c-115">Le distribuzioni con successo di grandi dimensioni possono richiedere sei mesi di pianificazione e spesso includono membri del team provenienti da molte aree dell'organizzazione, tra cui amministratori di rete, firewall e server proxy, amministratori di Office 365, sicurezza, supporto degli utenti finali, gestione dei progetti e sponsorizzazione esecutiva.</span><span class="sxs-lookup"><span data-stu-id="2f11c-115">Large successful deployments may take six months in planning and often include team members from many areas in the organization including networking, Firewall and Proxy server administrators, Office 365 administrators, security, end-user support, project management, and executive sponsorship.</span></span> <span data-ttu-id="2f11c-116">L'investimento nel processo di pianificazione ridurrà la probabilità che si verifichino errori di distribuzione con conseguenti tempi di inattività o una risoluzione dei problemi complessa e costosa.</span><span class="sxs-lookup"><span data-stu-id="2f11c-116">Your investment in the planning process will reduce the likelihood that you'll experience deployment failures resulting in downtime or complex and expensive troubleshooting.</span></span>
  
<span data-ttu-id="2f11c-117">Prima di iniziare questa guida all'implementazione, è previsto che siano completati i prerequisiti seguenti.</span><span class="sxs-lookup"><span data-stu-id="2f11c-117">We expect the following pre-requisites to be completed before this implementation guide is started.</span></span>
  
1. <span data-ttu-id="2f11c-118">È stata completata una valutazione della rete per determinare se ExpressRoute è consigliato e approvato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-118">You've completed a network assessment to determine if ExpressRoute is recommended and approved.</span></span>

2. <span data-ttu-id="2f11c-119">È stato selezionato un provider di servizi di rete ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-119">You've selected an ExpressRoute network service provider.</span></span> <span data-ttu-id="2f11c-120">Informazioni dettagliate sui [partner ExpressRoute e sulle posizioni di peering.](/azure/expressroute/expressroute-locations)</span><span class="sxs-lookup"><span data-stu-id="2f11c-120">Find details about the [ExpressRoute partners and peering locations](/azure/expressroute/expressroute-locations).</span></span>

3. <span data-ttu-id="2f11c-121">Hai già letto e compreso la documentazione [di ExpressRoute](https://azure.microsoft.com/documentation/services/expressroute/) e la rete interna è in grado di soddisfare i prerequisiti di ExpressRoute end-to-end.</span><span class="sxs-lookup"><span data-stu-id="2f11c-121">You've already read and understand the [ExpressRoute documentation](https://azure.microsoft.com/documentation/services/expressroute/) and your internal network is able to meet ExpressRoute pre-requisites end to end.</span></span>

4. <span data-ttu-id="2f11c-122">Il team ha letto tutte le indicazioni e la documentazione pubblica all'indirizzo , e ha seguito la serie Di formazione di [https://aka.ms/expressrouteoffice365](./azure-expressroute.md) [https://aka.ms/ert](https://aka.ms/ert) Azure [ExpressRoute per Office 365 su](https://channel9.msdn.com/series/aer) Channel 9 per acquisire una conoscenza dei dettagli tecnici critici, tra cui:</span><span class="sxs-lookup"><span data-stu-id="2f11c-122">Your team has read all of the public guidance and documentation at [https://aka.ms/expressrouteoffice365](./azure-expressroute.md), [https://aka.ms/ert](https://aka.ms/ert), and watched the [Azure ExpressRoute for Office 365 Training](https://channel9.msdn.com/series/aer) series on Channel 9 to gain an understanding of critical technical details including:</span></span>

      - <span data-ttu-id="2f11c-123">Dipendenze Internet dei servizi SaaS.</span><span class="sxs-lookup"><span data-stu-id="2f11c-123">The internet dependencies of SaaS services.</span></span>

      - <span data-ttu-id="2f11c-124">Come evitare le route asimmetriche e gestire il routing complesso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-124">How to avoid asymmetric routes and handle complex routing.</span></span>

      - <span data-ttu-id="2f11c-125">Come incorporare i controlli di sicurezza, disponibilità e a livello di applicazione perimetrali.</span><span class="sxs-lookup"><span data-stu-id="2f11c-125">How to incorporate perimeter security, availability, and application level controls.</span></span>

## <a name="begin-by-gathering-requirements"></a><span data-ttu-id="2f11c-126">Iniziare raccogliendo i requisiti</span><span class="sxs-lookup"><span data-stu-id="2f11c-126">Begin by gathering requirements</span></span>
<span data-ttu-id="2f11c-127"><a name="requirements"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-127"><a name="requirements"> </a></span></span>

<span data-ttu-id="2f11c-128">Iniziare determinando quali funzionalità e servizi si prevede di adottare all'interno dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-128">Start by determining which features and services you plan to adopt within your organization.</span></span> <span data-ttu-id="2f11c-129">È necessario determinare quali funzionalità dei diversi servizi Office 365 verranno utilizzati e quali posizioni della rete ospiteranno gli utenti che utilizzano tali funzionalità.</span><span class="sxs-lookup"><span data-stu-id="2f11c-129">You need to determine which features of the different Office 365 services will be used and which locations on your network will host people using those features.</span></span> <span data-ttu-id="2f11c-130">Con il catalogo di scenari, è necessario aggiungere gli attributi di rete richiesti da ognuno di questi scenari. ad esempio i flussi di traffico di rete in ingresso e in uscita e se gli endpoint Office 365 sono disponibili tramite ExpressRoute o meno.</span><span class="sxs-lookup"><span data-stu-id="2f11c-130">With the catalog of scenarios, you need to add the network attributes that each of those scenarios require; such as inbound and outbound network traffic flows and if the Office 365 endpoints are available over ExpressRoute or not.</span></span>
  
<span data-ttu-id="2f11c-131">Per raccogliere i requisiti dell'organizzazione:</span><span class="sxs-lookup"><span data-stu-id="2f11c-131">To gather your organization's requirements:</span></span>
  
- <span data-ttu-id="2f11c-132">Catalogare il traffico di rete in ingresso e in uscita per Office 365 servizi di rete che l'organizzazione sta utilizzando.</span><span class="sxs-lookup"><span data-stu-id="2f11c-132">Catalog the inbound and outbound network traffic for the Office 365 services your organization is using.</span></span> <span data-ttu-id="2f11c-133">Consultare Office 365 url e intervalli di indirizzi IP per la descrizione dei flussi richiesti Office 365 diversi scenari.</span><span class="sxs-lookup"><span data-stu-id="2f11c-133">Consult Office 365 URLs and IP address ranges page for the description of flows that different Office 365 scenarios require.</span></span>

- <span data-ttu-id="2f11c-134">Raccogliere la documentazione della topologia di rete esistente che mostra i dettagli della backbone e della topologia WAN interna, la connettività dei siti satellite, la connettività utente dell'ultimo chilometro, il routing ai punti di uscita del perimetro della rete e i servizi proxy.</span><span class="sxs-lookup"><span data-stu-id="2f11c-134">Gather documentation of existing network topology showing details of your internal WAN backbone and topology, connectivity of satellite sites, last mile user connectivity, routing to network perimeter egress points, and proxy services.</span></span>

  - <span data-ttu-id="2f11c-135">Identificare gli endpoint del servizio in ingresso nei diagrammi di rete a cui Office 365 e altri servizi Microsoft si connetteranno, mostrando sia i percorsi di connessione a Internet che i percorsi di connessione ExpressRoute proposti.</span><span class="sxs-lookup"><span data-stu-id="2f11c-135">Identify inbound service endpoints on the network diagrams that Office 365 and other Microsoft services will connect to, showing both internet and proposed ExpressRoute connection paths.</span></span>

  - <span data-ttu-id="2f11c-136">Identificare tutte le posizioni geografiche degli utenti e la connettività WAN tra le posizioni insieme a quali posizioni attualmente hanno un'uscita verso Internet e quali posizioni sono proposte per l'uscita a una posizione di peering ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-136">Identify all geographic user locations and WAN connectivity between locations along with which locations currently have an egress to the internet and which locations are proposed to have an egress to an ExpressRoute peering location.</span></span>

  - <span data-ttu-id="2f11c-137">Identificare tutti i dispositivi perimetrali, ad esempio proxy, firewall e così via, e catalogare la relazione con i flussi che passano su Internet ed ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-137">Identify all edge devices, such as proxies, firewalls, and so on and catalog their relationship to flows going over the Internet and ExpressRoute.</span></span>

  - <span data-ttu-id="2f11c-138">Documentare se gli utenti finali accederanno Office 365 servizi tramite routing diretto o proxy di applicazione indiretto per i flussi Internet ed ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-138">Document whether end users will access Office 365 services via direct routing or indirect application proxy for both Internet and ExpressRoute flows.</span></span>

- <span data-ttu-id="2f11c-139">Aggiungere il percorso del tenant e dei percorsi meet-me al diagramma di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-139">Add the location of your tenant and meet-me locations to your network diagram.</span></span>

- <span data-ttu-id="2f11c-140">Stimare le prestazioni di rete previste e osservate e le caratteristiche di latenza dalle posizioni principali degli utenti a Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-140">Estimate the expected and observed network performance and latency characteristics from major user locations to Office 365.</span></span> <span data-ttu-id="2f11c-141">Tieni presente che Office 365 è un set globale e distribuito di servizi e gli utenti si connetteranno a posizioni che potrebbero essere diverse dalla posizione del tenant.</span><span class="sxs-lookup"><span data-stu-id="2f11c-141">Keep in mind that Office 365 is a global and distributed set of services and users will be connecting to locations that may be different from the location of their tenant.</span></span> <span data-ttu-id="2f11c-142">Per questo motivo, è consigliabile misurare e ottimizzare la latenza tra l'utente e il margine più vicino della rete globale Microsoft su ExpressRoute e connessioni Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-142">For this reason, it is recommended to measure and optimize for latency between the user and the closest edge of Microsoft global network over ExpressRoute and Internet connections.</span></span> <span data-ttu-id="2f11c-143">Puoi usare i risultati della valutazione della rete per facilitare questa attività.</span><span class="sxs-lookup"><span data-stu-id="2f11c-143">You can use your findings from the network assessment to aid with this task.</span></span>

- <span data-ttu-id="2f11c-144">Elencare i requisiti di sicurezza della rete aziendale e disponibilità elevata che devono essere soddisfatti con la nuova connessione ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-144">List company network security and high availability requirements that need to be met with the new ExpressRoute connection.</span></span> <span data-ttu-id="2f11c-145">Ad esempio, in che modo gli utenti continuano ad accedere a Office 365 in caso di uscita da Internet o errore del circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-145">For example, how do users continue to get access to Office 365 in the event of the Internet egress or ExpressRoute circuit failure.</span></span>

- <span data-ttu-id="2f11c-146">Documentare quali flussi di rete Office 365 in ingresso e in uscita utilizzeranno il percorso Internet e che utilizzeranno ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-146">Document which inbound and outbound Office 365 network flows will use the Internet path and which will use ExpressRoute.</span></span> <span data-ttu-id="2f11c-147">Le specifiche delle posizioni geografiche degli utenti e i dettagli della topologia di rete locale potrebbero richiedere che il piano sia diverso da una posizione utente a un'altra.</span><span class="sxs-lookup"><span data-stu-id="2f11c-147">The specifics of geographical locations of your users and details of your on-premises network topology may require the plan to be different from one user location to another.</span></span>

### <a name="catalog-your-outbound-and-inbound-network-traffic"></a><span data-ttu-id="2f11c-148">Catalogare il traffico di rete in ingresso e in uscita</span><span class="sxs-lookup"><span data-stu-id="2f11c-148">Catalog your outbound and inbound network traffic</span></span>
<span data-ttu-id="2f11c-149"><a name="trafficCatalog"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-149"><a name="trafficCatalog"> </a></span></span>

<span data-ttu-id="2f11c-150">Per ridurre al minimo il routing e altre complessità di rete, è consigliabile usare ExpressRoute solo per Office 365 per i flussi di traffico di rete necessari per passare attraverso una connessione dedicata a causa di requisiti normativi o come risultato della valutazione della rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-150">To minimize routing and other network complexities, we recommend that you only use ExpressRoute for Office 365 for the network traffic flows that are required to go over a dedicated connection due to regulatory requirements or as the result of the network assessment.</span></span> <span data-ttu-id="2f11c-151">Inoltre, è consigliabile impostare in fasi l'ambito del routing ExpressRoute e l'approccio ai flussi di traffico di rete in ingresso e in uscita come fasi diverse e distinte del progetto di implementazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-151">Additionally, we recommend that you stage the scope of ExpressRoute routing and approach outbound and inbound network traffic flows as different and distinct stages of the implementation project.</span></span> <span data-ttu-id="2f11c-152">Distribuire ExpressRoute per Office 365 solo per i flussi di traffico di rete in uscita avviati dall'utente e lasciare i flussi di traffico di rete in ingresso su Internet può aiutare a controllare l'aumento della complessità topologica e dei rischi derivanti dall'introduzione di ulteriori possibilità di routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-152">Deploy ExpressRoute for Office 365 for just user initiated outbound network traffic flows and leave inbound network traffic flows across the Internet can help to control the increase in topological complexity and risks of introducing additional asymmetric routing possibilities.</span></span>
  
<span data-ttu-id="2f11c-153">Il catalogo del traffico di rete deve contenere elenchi di tutte le connessioni di rete in ingresso e in uscita tra la rete locale e Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2f11c-153">Your network traffic catalog should contain listings of all the inbound and outbound network connections that you'll have between your on-premises network and Microsoft.</span></span>
  
- <span data-ttu-id="2f11c-154">I flussi di traffico di rete in uscita sono scenari in cui viene avviata una connessione dall'ambiente locale, ad esempio da client o server interni, con una destinazione del servizi Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2f11c-154">Outbound network traffic flows are any scenarios where a connection is initiated from your on-premises environment, such as from internal clients or servers, with a destination of the Microsoft services.</span></span> <span data-ttu-id="2f11c-155">Queste connessioni possono essere dirette Office 365 o indirette, ad esempio quando la connessione passa attraverso server proxy, firewall o altri dispositivi di rete nel percorso di Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-155">These connections may be direct to Office 365 or indirect, such as when the connection goes through proxy servers, firewalls, or other networking devices on the path to Office 365.</span></span>

- <span data-ttu-id="2f11c-156">I flussi di traffico di rete in ingresso sono tutti gli scenari in cui viene avviata una connessione dal cloud Microsoft a un host locale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-156">Inbound network traffic flows are any scenarios where a connection is initiated from the Microsoft cloud to an on-premises host.</span></span> <span data-ttu-id="2f11c-157">Queste connessioni in genere devono passare attraverso il firewall e altre infrastrutture di sicurezza richieste dal criterio di sicurezza dei clienti per i flussi originati esternamente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-157">These connections typically need to go through firewall and other security infrastructure that customer security policy requires for externally originated flows.</span></span>

<span data-ttu-id="2f11c-158">Leggere  la sezione Verifica della simmetria della route dell'articolo [Routing con ExpressRoute](https://support.office.com/article/Routing-with-ExpressRoute-for-Office-365-e1da26c6-2d39-4379-af6f-4da213218408) per Office 365 per determinare quali servizi invieranno il traffico in ingresso e cercare la colonna **contrassegnata come ExpressRoute per Office 365** nell'articolo di riferimento sugli endpoint [di Office 365](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2) per determinare il resto delle informazioni sulla connettività.</span><span class="sxs-lookup"><span data-stu-id="2f11c-158">Read the **Ensuring route symmetry** section of the article [Routing with ExpressRoute for Office 365](https://support.office.com/article/Routing-with-ExpressRoute-for-Office-365-e1da26c6-2d39-4379-af6f-4da213218408) to determine which services will send inbound traffic and look for the column marked **ExpressRoute for Office 365** in the [Office 365 endpoints](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2) reference article to determine the rest of the connectivity information.</span></span>
  
<span data-ttu-id="2f11c-159">Per ogni servizio che richiede una connessione in uscita, è necessario descrivere la connettività pianificata per il servizio, inclusi il routing di rete, la configurazione proxy, l'ispezione dei pacchetti e le esigenze di larghezza di banda.</span><span class="sxs-lookup"><span data-stu-id="2f11c-159">For each service that requires an outbound connection, you'll want to describe the planned connectivity for the service including network routing, proxy configuration, packet inspection, and bandwidth needs.</span></span>
  
<span data-ttu-id="2f11c-160">Per ogni servizio che richiede una connessione in ingresso, sono necessarie alcune informazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="2f11c-160">For each service that requires an inbound connection, you'll need some additional information.</span></span> <span data-ttu-id="2f11c-161">I server nel cloud Microsoft stabiliranno connessioni alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-161">Servers in the Microsoft cloud will establish connections to your on-premises network.</span></span> <span data-ttu-id="2f11c-162">per assicurarsi che le connessioni vengano effettuate correttamente, è necessario descrivere tutti gli aspetti di questa connettività, tra cui; le voci DNS pubbliche per i servizi che accetteranno queste connessioni in ingresso, gli indirizzi IP IPv4 formattati ciDR, le apparecchiature ISP coinvolte e la modalità di gestione del NAT in ingresso o nat di origine per queste connessioni.</span><span class="sxs-lookup"><span data-stu-id="2f11c-162">to ensure the connections are made correctly, you'll want to describe all aspects of this connectivity, including; the public DNS entries for the services that will accept these inbound connections, the CIDR formatted IPv4 IP addresses, which ISP equipment is involved, and how inbound NAT or source NAT is handled for these connections.</span></span>
  
<span data-ttu-id="2f11c-163">Le connessioni in ingresso devono essere esaminate indipendentemente dal fatto che si connettono tramite Internet o ExpressRoute per garantire che il routing asimmetrico non sia stato introdotto.</span><span class="sxs-lookup"><span data-stu-id="2f11c-163">Inbound connections should be reviewed regardless of whether they're connecting over the internet or ExpressRoute to ensure asymmetric routing hasn't been introduced.</span></span> <span data-ttu-id="2f11c-164">In alcuni casi, gli endpoint locali a cui i servizi Office 365 avviano connessioni in ingresso potrebbero dover essere accessibili anche da altri utenti Microsoft e non servizi Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2f11c-164">In some cases, on-premises endpoints that Office 365 services initiate inbound connections to may also need to be accessed by other Microsoft and non-Microsoft services.</span></span> <span data-ttu-id="2f11c-165">È fondamentale che l'abilitazione del routing ExpressRoute a questi servizi Office 365 non interrompa altri scenari.</span><span class="sxs-lookup"><span data-stu-id="2f11c-165">It is paramount that enabling ExpressRoute routing to these services for Office 365 purposes doesn't break other scenarios.</span></span> <span data-ttu-id="2f11c-166">In molti casi, i clienti potrebbero dover implementare modifiche specifiche alla propria rete interna, ad esempio NAT basato sull'origine, per garantire che i flussi in ingresso da Microsoft rimangano simmetrici dopo l'attivazione di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-166">In many cases, customers may need to implement specific changes to their internal network, such as source based NAT, to ensure that inbound flows from Microsoft remain symmetric after ExpressRoute is enabled.</span></span>
  
<span data-ttu-id="2f11c-167">Ecco un esempio del livello di dettaglio necessario.</span><span class="sxs-lookup"><span data-stu-id="2f11c-167">Here's a sample of the level of detail required.</span></span> <span data-ttu-id="2f11c-168">In questo caso Exchange ibrido instraderebbe al sistema locale tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-168">In this case Exchange Hybrid would route to the on-premises system over ExpressRoute.</span></span> 

|<span data-ttu-id="2f11c-169">Connection, proprietà</span><span class="sxs-lookup"><span data-stu-id="2f11c-169">Connection property</span></span>   |<span data-ttu-id="2f11c-170">Valore</span><span class="sxs-lookup"><span data-stu-id="2f11c-170">Value</span></span>  |
|----------|-----------|
|<span data-ttu-id="2f11c-171">**Direzione del traffico di rete**</span><span class="sxs-lookup"><span data-stu-id="2f11c-171">**Network traffic direction**</span></span> <br/> |<span data-ttu-id="2f11c-172">In ingresso</span><span class="sxs-lookup"><span data-stu-id="2f11c-172">Inbound</span></span>  <br/> |
|<span data-ttu-id="2f11c-173">**Servizio**</span><span class="sxs-lookup"><span data-stu-id="2f11c-173">**Service**</span></span> <br/> |<span data-ttu-id="2f11c-174">Ambiente Exchange ibrido</span><span class="sxs-lookup"><span data-stu-id="2f11c-174">Exchange Hybrid</span></span>  <br/> |
|<span data-ttu-id="2f11c-175">**Endpoint Office 365 pubblico (origine)**</span><span class="sxs-lookup"><span data-stu-id="2f11c-175">**Public Office 365 endpoint (source)**</span></span> <br/> |<span data-ttu-id="2f11c-176">Exchange Online (indirizzi IP)</span><span class="sxs-lookup"><span data-stu-id="2f11c-176">Exchange Online (IP addresses)</span></span>  <br/> |
|<span data-ttu-id="2f11c-177">**Endpoint locale pubblico (destinazione)**</span><span class="sxs-lookup"><span data-stu-id="2f11c-177">**Public On-Premises Endpoint (destination)**</span></span> <br/> |<span data-ttu-id="2f11c-178">5.5.5.5</span><span class="sxs-lookup"><span data-stu-id="2f11c-178">5.5.5.5</span></span>  <br/> |
|<span data-ttu-id="2f11c-179">**Voce DNS pubblica (Internet)**</span><span class="sxs-lookup"><span data-stu-id="2f11c-179">**Public (Internet) DNS entry**</span></span> <br/> |<span data-ttu-id="2f11c-180">Autodiscover.contoso.com</span><span class="sxs-lookup"><span data-stu-id="2f11c-180">Autodiscover.contoso.com</span></span>  <br/> |
|<span data-ttu-id="2f11c-181">**Questo endpoint locale verrà usato da altri utenti (non Office 365) servizi Microsoft**</span><span class="sxs-lookup"><span data-stu-id="2f11c-181">**Will this on-premises endpoint be used for by other (non-Office 365) Microsoft services**</span></span> <br/> |<span data-ttu-id="2f11c-182">No</span><span class="sxs-lookup"><span data-stu-id="2f11c-182">No</span></span>  <br/> |
|<span data-ttu-id="2f11c-183">**Questo endpoint locale verrà utilizzato da utenti/sistemi su Internet**</span><span class="sxs-lookup"><span data-stu-id="2f11c-183">**Will this on-premises endpoint be used by users/systems on the Internet**</span></span> <br/> |<span data-ttu-id="2f11c-184">Sì</span><span class="sxs-lookup"><span data-stu-id="2f11c-184">Yes</span></span>  <br/> |
|<span data-ttu-id="2f11c-185">**Sistemi interni pubblicati tramite endpoint pubblici**</span><span class="sxs-lookup"><span data-stu-id="2f11c-185">**Internal systems published through public endpoints**</span></span> <br/> |<span data-ttu-id="2f11c-186">Exchange Server ruolo accesso client (locale) 192.168.101, 192.168.102, 192.168.103</span><span class="sxs-lookup"><span data-stu-id="2f11c-186">Exchange Server client access role (on-premises) 192.168.101, 192.168.102, 192.168.103</span></span>  <br/> |
|<span data-ttu-id="2f11c-187">**Annuncio IP dell'endpoint pubblico**</span><span class="sxs-lookup"><span data-stu-id="2f11c-187">**IP advertisement of the public endpoint**</span></span> <br/> |<span data-ttu-id="2f11c-188">**To Internet**: 5.5.0.0/16 **To ExpressRoute**: 5.5.5.0/24</span><span class="sxs-lookup"><span data-stu-id="2f11c-188">**To Internet**: 5.5.0.0/16 **To ExpressRoute**: 5.5.5.0/24</span></span>  <br/> |
|<span data-ttu-id="2f11c-189">**Controlli di sicurezza/perimetro**</span><span class="sxs-lookup"><span data-stu-id="2f11c-189">**Security/Perimeter Controls**</span></span> <br/> |<span data-ttu-id="2f11c-190">**Percorso Internet**: DeviceID_002  **ExpressRoute :** DeviceID_003</span><span class="sxs-lookup"><span data-stu-id="2f11c-190">**Internet path**: DeviceID_002  **ExpressRoute path**: DeviceID_003</span></span>  <br/> |
|<span data-ttu-id="2f11c-191">**Disponibilità elevata**</span><span class="sxs-lookup"><span data-stu-id="2f11c-191">**High Availability**</span></span> <br/> |<span data-ttu-id="2f11c-192">Active/Active su 2 circuiti ExpressRoute/con ridondanza geografica - Chicago e Dallas</span><span class="sxs-lookup"><span data-stu-id="2f11c-192">Active/Active across 2 geo-redundant / ExpressRoute circuits - Chicago and Dallas</span></span>  <br/> |
|<span data-ttu-id="2f11c-193">**Controllo della simmetria del percorso**</span><span class="sxs-lookup"><span data-stu-id="2f11c-193">**Path symmetry control**</span></span> <br/> |<span data-ttu-id="2f11c-194">**Metodo**: Percorso **Internet** NAT di origine : Connessioni NAT di origine in ingresso a 192.168.5.5 **Percorso ExpressRoute**: Connessioni NAT di origine a 192.168.1.0 (Chicago) e 192.168.2.0 (Dallas)</span><span class="sxs-lookup"><span data-stu-id="2f11c-194">**Method**: Source NAT **Internet path**: Source NAT inbound connections to 192.168.5.5 **ExpressRoute path**: Source NAT connections to 192.168.1.0 (Chicago) and 192.168.2.0 (Dallas)</span></span>  <br/> |

<span data-ttu-id="2f11c-195">Ecco un esempio di servizio solo in uscita:</span><span class="sxs-lookup"><span data-stu-id="2f11c-195">Here's a sample of a service that is outbound only:</span></span>

|<span data-ttu-id="2f11c-196">**Connection, proprietà**</span><span class="sxs-lookup"><span data-stu-id="2f11c-196">**Connection property**</span></span>|<span data-ttu-id="2f11c-197">**Valore**</span><span class="sxs-lookup"><span data-stu-id="2f11c-197">**Value**</span></span>|
|----------|-----------|
|<span data-ttu-id="2f11c-198">**Direzione del traffico di rete**</span><span class="sxs-lookup"><span data-stu-id="2f11c-198">**Network traffic direction**</span></span> <br/> |<span data-ttu-id="2f11c-199">In uscita</span><span class="sxs-lookup"><span data-stu-id="2f11c-199">Outbound</span></span>  <br/> |
|<span data-ttu-id="2f11c-200">**Servizio**</span><span class="sxs-lookup"><span data-stu-id="2f11c-200">**Service**</span></span> <br/> |<span data-ttu-id="2f11c-201">SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="2f11c-201">SharePoint Online</span></span>  <br/> |
|<span data-ttu-id="2f11c-202">**Endpoint locale (origine)**</span><span class="sxs-lookup"><span data-stu-id="2f11c-202">**On-premises endpoint (source)**</span></span> <br/> |<span data-ttu-id="2f11c-203">Workstation utente</span><span class="sxs-lookup"><span data-stu-id="2f11c-203">User workstation</span></span>  <br/> |
|<span data-ttu-id="2f11c-204">**Endpoint Office 365 pubblico (destinazione)**</span><span class="sxs-lookup"><span data-stu-id="2f11c-204">**Public Office 365 endpoint (destination)**</span></span> <br/> |<span data-ttu-id="2f11c-205">SharePoint Online (indirizzi IP)</span><span class="sxs-lookup"><span data-stu-id="2f11c-205">SharePoint Online (IP addresses)</span></span>  <br/> |
|<span data-ttu-id="2f11c-206">**Voce DNS pubblica (Internet)**</span><span class="sxs-lookup"><span data-stu-id="2f11c-206">**Public (Internet) DNS entry**</span></span> <br/> |<span data-ttu-id="2f11c-207">\*.sharepoint.com (e FQDN aggiuntivi)</span><span class="sxs-lookup"><span data-stu-id="2f11c-207">\*.sharepoint.com (and additional FQDNs)</span></span>  <br/> |
|<span data-ttu-id="2f11c-208">**rete CDN Riferimenti**</span><span class="sxs-lookup"><span data-stu-id="2f11c-208">**CDN Referrals**</span></span> <br/> |<span data-ttu-id="2f11c-209">cdn.sharepointonline.com (e FQDN aggiuntivi) - Indirizzi IP gestiti da rete CDN provider)</span><span class="sxs-lookup"><span data-stu-id="2f11c-209">cdn.sharepointonline.com (and additional FQDNs) - IP addresses maintained by CDN providers)</span></span>  <br/> |
|<span data-ttu-id="2f11c-210">**Annuncio IP e NAT in uso**</span><span class="sxs-lookup"><span data-stu-id="2f11c-210">**IP advertisement and NAT in use**</span></span> <br/> |<span data-ttu-id="2f11c-211">**Percorso Internet/NAT di origine**: 1.1.1.0/24</span><span class="sxs-lookup"><span data-stu-id="2f11c-211">**Internet path/Source NAT**: 1.1.1.0/24</span></span>  <br/> <span data-ttu-id="2f11c-212">**Percorso ExpressRoute/NAT** di origine : 1.1.2.0/24 (Chicago) e 1.1.3.0/24 (Dallas)</span><span class="sxs-lookup"><span data-stu-id="2f11c-212">**ExpressRoute path/Source NAT**: 1.1.2.0/24 (Chicago) and 1.1.3.0/24 (Dallas)</span></span>  <br/> |
|<span data-ttu-id="2f11c-213">**Connectivity, metodo**</span><span class="sxs-lookup"><span data-stu-id="2f11c-213">**Connectivity method**</span></span> <br/> |<span data-ttu-id="2f11c-214">**Internet**: tramite proxy di livello 7 (file PAC)</span><span class="sxs-lookup"><span data-stu-id="2f11c-214">**Internet**: via layer 7 proxy (.pac file)</span></span>  <br/> <span data-ttu-id="2f11c-215">**ExpressRoute**: instradamento diretto (senza proxy)</span><span class="sxs-lookup"><span data-stu-id="2f11c-215">**ExpressRoute**: direct routing (no proxy)</span></span>  <br/> |
|<span data-ttu-id="2f11c-216">**Controlli di sicurezza/perimetro**</span><span class="sxs-lookup"><span data-stu-id="2f11c-216">**Security/Perimeter Controls**</span></span> <br/> |<span data-ttu-id="2f11c-217">**Percorso Internet**: DeviceID_002</span><span class="sxs-lookup"><span data-stu-id="2f11c-217">**Internet path**: DeviceID_002</span></span>  <br/> <span data-ttu-id="2f11c-218">**Percorso ExpressRoute**: DeviceID_003</span><span class="sxs-lookup"><span data-stu-id="2f11c-218">**ExpressRoute path**: DeviceID_003</span></span>  <br/> |
|<span data-ttu-id="2f11c-219">**Disponibilità elevata**</span><span class="sxs-lookup"><span data-stu-id="2f11c-219">**High Availability**</span></span> <br/> |<span data-ttu-id="2f11c-220">**Percorso Internet**: uscita Internet ridondante</span><span class="sxs-lookup"><span data-stu-id="2f11c-220">**Internet path**: Redundant internet egress</span></span>  <br/> <span data-ttu-id="2f11c-221">**Percorso ExpressRoute**: routing attivo/attivo di "patata calda" tra 2 circuiti ExpressRoute con ridondanza geografica - Chicago e Dallas</span><span class="sxs-lookup"><span data-stu-id="2f11c-221">**ExpressRoute path**: Active/Active 'hot potato' routing across 2 geo-redundant ExpressRoute circuits - Chicago and Dallas</span></span>  <br/> |
|<span data-ttu-id="2f11c-222">**Controllo della simmetria del percorso**</span><span class="sxs-lookup"><span data-stu-id="2f11c-222">**Path symmetry control**</span></span> <br/> |<span data-ttu-id="2f11c-223">**Metodo**: NAT di origine per tutte le connessioni</span><span class="sxs-lookup"><span data-stu-id="2f11c-223">**Method**: Source NAT for all connections</span></span>  <br/> |

### <a name="your-network-topology-design-with-regional-connectivity"></a><span data-ttu-id="2f11c-224">Progettazione della topologia di rete con connettività regionale</span><span class="sxs-lookup"><span data-stu-id="2f11c-224">Your network topology design with regional connectivity</span></span>
<span data-ttu-id="2f11c-225"><a name="topology"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-225"><a name="topology"> </a></span></span>

<span data-ttu-id="2f11c-226">Dopo aver compreso i servizi e i flussi di traffico di rete associati, è possibile creare un diagramma di rete che incorpora questi nuovi requisiti di connettività e illustra le modifiche che verranno apportate per usare ExpressRoute per Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-226">Once you understand the services and their associated network traffic flows, you can create a network diagram that incorporates these new connectivity requirements and illustrates the changes you'll make to use ExpressRoute for Office 365.</span></span> <span data-ttu-id="2f11c-227">Il diagramma deve includere:</span><span class="sxs-lookup"><span data-stu-id="2f11c-227">Your diagram should include:</span></span>
  
1. <span data-ttu-id="2f11c-228">Tutte le posizioni utente da Office 365 e altri servizi da cui sarà possibile accedere.</span><span class="sxs-lookup"><span data-stu-id="2f11c-228">All user locations where Office 365 and other services will be accessed from.</span></span>

2. <span data-ttu-id="2f11c-229">Tutti i punti di uscita di Internet ed ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-229">All internet and ExpressRoute egress points.</span></span>

3. <span data-ttu-id="2f11c-230">Tutti i dispositivi in uscita e in ingresso che gestiscono la connettività all'interno e all'esterno della rete, inclusi router, firewall, server proxy dell'applicazione e rilevamento/prevenzione delle intrusioni.</span><span class="sxs-lookup"><span data-stu-id="2f11c-230">All outbound and inbound devices that manage connectivity in and out of the network, including routers, firewalls, application proxy servers, and intrusion detection/prevention.</span></span>

4. <span data-ttu-id="2f11c-231">Destinazioni interne per tutto il traffico in ingresso, ad esempio i server ADFS interni che accettano connessioni dai server proxy dell'applicazione Web ADFS.</span><span class="sxs-lookup"><span data-stu-id="2f11c-231">Internal destinations for all inbound traffic, such as internal ADFS servers that accept connections from the ADFS web application proxy servers.</span></span>

5. <span data-ttu-id="2f11c-232">Catalogo di tutte le subnet IP che verranno annunciate</span><span class="sxs-lookup"><span data-stu-id="2f11c-232">Catalog of all IP subnets that will be advertised</span></span>

6. <span data-ttu-id="2f11c-233">Identificare ogni posizione da cui gli utenti Office 365 da ed elencare le posizioni meet-me che verranno usate per ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-233">Identify each location where people will access Office 365 from and list the meet-me locations that will be used for ExpressRoute.</span></span>

7. <span data-ttu-id="2f11c-234">I percorsi e le parti della topologia di rete interna, in cui i prefissi IP Microsoft appresi da ExpressRoute verranno accettati, filtrati e propagati.</span><span class="sxs-lookup"><span data-stu-id="2f11c-234">Locations and portions of your internal network topology, where Microsoft IP prefixes learned from ExpressRoute will be accepted, filtered and propagated to.</span></span>

8. <span data-ttu-id="2f11c-235">La topologia di rete deve illustrare la posizione geografica di ogni segmento di rete e il modo in cui si connette alla rete Microsoft tramite ExpressRoute e/o Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-235">The network topology should illustrate the geographic location of each network segment and how it connects to the Microsoft network over ExpressRoute and/or the Internet.</span></span>

<span data-ttu-id="2f11c-236">Il diagramma seguente mostra ogni posizione in cui gli utenti Office 365 gli annunci di routing in ingresso e in uscita Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-236">The diagram below shows each location where people will be using Office 365 from along with the inbound and outbound routing advertisements to Office 365.</span></span>
  
![ExpressRoute regional geographic meet-me](../media/d866b36b-49bf-416b-af1b-d054e24989d2.png)
  
<span data-ttu-id="2f11c-238">Per il traffico in uscita, gli utenti accedono Office 365 in uno dei tre modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="2f11c-238">For outbound traffic, the people access Office 365 in one of three ways:</span></span>
  
1. <span data-ttu-id="2f11c-239">Attraverso una sede di meet-me in Nord America per le persone in California.</span><span class="sxs-lookup"><span data-stu-id="2f11c-239">Through a meet-me location in North America for the people in California.</span></span>

2. <span data-ttu-id="2f11c-240">Attraverso un luogo di incontro a Hong Kong per le persone a Hong Kong.</span><span class="sxs-lookup"><span data-stu-id="2f11c-240">Through a meet-me location in Hong Kong for the people in Hong Kong.</span></span>

3. <span data-ttu-id="2f11c-241">Attraverso Internet in Bangladesh, dove ci sono meno persone e nessun circuito ExpressRoute di cui è stato eseguito il provisioning.</span><span class="sxs-lookup"><span data-stu-id="2f11c-241">Through the internet in Bangladesh where there are fewer people and no ExpressRoute circuit provisioned.</span></span>

![Connessioni in uscita per il diagramma regionale](../media/8319943d-08f0-4781-9ef3-d23de2ad4671.png)
  
<span data-ttu-id="2f11c-243">Analogamente, il traffico di rete in ingresso Office 365 in uno dei tre modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="2f11c-243">Similarly, the inbound network traffic from Office 365 returns in one of three ways:</span></span>
  
1. <span data-ttu-id="2f11c-244">Attraverso una sede di meet-me in Nord America per le persone in California.</span><span class="sxs-lookup"><span data-stu-id="2f11c-244">Through a meet-me location in North America for the people in California.</span></span>

2. <span data-ttu-id="2f11c-245">Attraverso un luogo di incontro a Hong Kong per le persone a Hong Kong.</span><span class="sxs-lookup"><span data-stu-id="2f11c-245">Through a meet-me location in Hong Kong for the people in Hong Kong.</span></span>

3. <span data-ttu-id="2f11c-246">Attraverso Internet in Bangladesh, dove ci sono meno persone e nessun circuito ExpressRoute di cui è stato eseguito il provisioning.</span><span class="sxs-lookup"><span data-stu-id="2f11c-246">Through the internet in Bangladesh where there are fewer people and no ExpressRoute circuit provisioned.</span></span>

![Connessioni in ingresso per il diagramma regionale](../media/d6d6160d-bf28-4de3-a787-186c7432b306.png)
  
### <a name="determine-the-appropriate-meet-me-location"></a><span data-ttu-id="2f11c-248">Determinare la posizione di meet-me appropriata</span><span class="sxs-lookup"><span data-stu-id="2f11c-248">Determine the appropriate meet-me location</span></span>

<span data-ttu-id="2f11c-249">La selezione delle posizioni meet-me, ovvero la posizione fisica da cui il circuito ExpressRoute connette la rete alla rete Microsoft, è influenzata dalle posizioni da cui gli utenti accederanno Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-249">The selection of meet-me locations, which are the physical location where your ExpressRoute circuit connects your network to the Microsoft network, is influenced by the locations where people will access Office 365 from.</span></span> <span data-ttu-id="2f11c-250">Come offerta SaaS, Office 365 non opera nel modello regionale IaaS o PaaS nello stesso modo di Azure.</span><span class="sxs-lookup"><span data-stu-id="2f11c-250">As a SaaS offering, Office 365 does not operate under the IaaS or PaaS regional model in the same way Azure does.</span></span> <span data-ttu-id="2f11c-251">Invece, Office 365 è un set distribuito di servizi di collaborazione, in cui gli utenti potrebbero dover connettersi agli endpoint tra più data center e aree geografiche, che potrebbero non essere necessariamente nella stessa posizione o area geografica in cui è ospitato il tenant dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-251">Instead, Office 365 is a distributed set of collaboration services, where users may need to connect to endpoints across multiple datacenters and regions, which may not necessarily be in the same location or region where the user's tenant is hosted.</span></span>
  
<span data-ttu-id="2f11c-252">Ciò significa che la considerazione più importante da prendere quando si selezionano le posizioni meet-me per ExpressRoute per Office 365 è da dove si connetteranno gli utenti dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-252">This means the most important consideration you need to make when selecting meet-me locations for ExpressRoute for Office 365 is where the people in your organization will be connecting from.</span></span> <span data-ttu-id="2f11c-253">La raccomandazione generale per una connettività Office 365 ottimale è implementare il routing, in modo che le richieste degli utenti ai servizi Office 365 vengano inviate nella rete Microsoft attraverso il percorso di rete più breve, anche questo viene spesso definito routing "hot-patata".</span><span class="sxs-lookup"><span data-stu-id="2f11c-253">The general recommendation for optimal Office 365 connectivity is implement routing, so that user requests to Office 365 services are handed off into the Microsoft network over the shortest network path, this is also often being referred to as 'hot potato' routing.</span></span> <span data-ttu-id="2f11c-254">Ad esempio, se la maggior parte degli utenti di Office 365 si trovano in una o due posizioni, la selezione delle posizioni meet-me che si trovano nella vicinanza più vicina alla posizione di tali utenti creerà la progettazione ottimale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-254">For example, if most of the Office 365 users are in one or two locations, selecting meet-me locations that are in the closest proximity to the location of those users will create the optimal design.</span></span> <span data-ttu-id="2f11c-255">Se la tua azienda ha una popolazione di utenti di grandi dimensioni in molte aree geografiche diverse, puoi prendere in considerazione la possibilità di avere più circuiti ExpressRoute e posizioni meet-me.</span><span class="sxs-lookup"><span data-stu-id="2f11c-255">If your company has large user populations in many different regions, you may want to consider having multiple ExpressRoute circuits and meet-me locations.</span></span> <span data-ttu-id="2f11c-256">Per alcune delle posizioni degli utenti, il percorso più breve/ottimale nella rete Microsoft e in Office 365 potrebbe non essere attraverso la rete WAN interna e i punti di incontro ExpressRoute, ma tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-256">For some of your user locations, the shortest/most optimal path into Microsoft network and Office 365, may not be through your internal WAN and ExpressRoute meet-me points, but via the Internet.</span></span>
  
<span data-ttu-id="2f11c-257">Spesso, ci sono più località di meet-me che possono essere selezionate all'interno di un'area con relativa prossimità agli utenti.</span><span class="sxs-lookup"><span data-stu-id="2f11c-257">Often times, there are multiple meet-me locations that could be selected within a region with relative proximity to your users.</span></span> <span data-ttu-id="2f11c-258">Compila la tabella seguente per guidare le tue decisioni.</span><span class="sxs-lookup"><span data-stu-id="2f11c-258">Fill out the following table to guide your decisions.</span></span>

<span data-ttu-id="2f11c-259">**Sedi expressroute meet-me pianificate in California e New York**</span><span class="sxs-lookup"><span data-stu-id="2f11c-259">**Planned ExpressRoute meet-me locations in California and New York**</span></span>

|<span data-ttu-id="2f11c-260">Posizione</span><span class="sxs-lookup"><span data-stu-id="2f11c-260">Location</span></span>  <br/> |<span data-ttu-id="2f11c-261">Numero di persone</span><span class="sxs-lookup"><span data-stu-id="2f11c-261">Number of people</span></span>  <br/> |<span data-ttu-id="2f11c-262">Latenza prevista per la rete Microsoft in uscita da Internet</span><span class="sxs-lookup"><span data-stu-id="2f11c-262">Expected latency to Microsoft network over Internet egress</span></span>  <br/> |<span data-ttu-id="2f11c-263">Latenza prevista per la rete Microsoft su ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2f11c-263">Expected latency to Microsoft network over ExpressRoute</span></span>  <br/> |
|----------|-----------|----------|-----------|
|<span data-ttu-id="2f11c-264">Roma</span><span class="sxs-lookup"><span data-stu-id="2f11c-264">Los Angeles</span></span>  <br/> |<span data-ttu-id="2f11c-265">10.000</span><span class="sxs-lookup"><span data-stu-id="2f11c-265">10,000</span></span>  <br/> |<span data-ttu-id="2f11c-266">~15 ms</span><span class="sxs-lookup"><span data-stu-id="2f11c-266">~15ms</span></span>  <br/> |<span data-ttu-id="2f11c-267">~10ms (tramite Silicon Valley)</span><span class="sxs-lookup"><span data-stu-id="2f11c-267">~10ms (via Silicon Valley)</span></span>  <br/> |
|<span data-ttu-id="2f11c-268">Washington DC</span><span class="sxs-lookup"><span data-stu-id="2f11c-268">Washington DC</span></span>  <br/> |<span data-ttu-id="2f11c-269">15.000</span><span class="sxs-lookup"><span data-stu-id="2f11c-269">15,000</span></span>  <br/> |<span data-ttu-id="2f11c-270">~20ms</span><span class="sxs-lookup"><span data-stu-id="2f11c-270">~20ms</span></span>  <br/> |<span data-ttu-id="2f11c-271">~10ms (tramite New York)</span><span class="sxs-lookup"><span data-stu-id="2f11c-271">~10ms (via New York)</span></span>  <br/> |
|<span data-ttu-id="2f11c-272">Dallas</span><span class="sxs-lookup"><span data-stu-id="2f11c-272">Dallas</span></span>  <br/> |<span data-ttu-id="2f11c-273">5.000</span><span class="sxs-lookup"><span data-stu-id="2f11c-273">5,000</span></span>  <br/> |<span data-ttu-id="2f11c-274">~15 ms</span><span class="sxs-lookup"><span data-stu-id="2f11c-274">~15ms</span></span>  <br/> |<span data-ttu-id="2f11c-275">~40ms (tramite New York)</span><span class="sxs-lookup"><span data-stu-id="2f11c-275">~40ms (via New York)</span></span>  <br/> |

<span data-ttu-id="2f11c-276">Dopo aver sviluppato l'architettura di rete globale che mostra l'area di Office 365, le posizioni del provider di servizi di rete ExpressRoute e la quantità di persone in base alla posizione, possono essere usate per identificare se è possibile eseguire ottimizzazioni.</span><span class="sxs-lookup"><span data-stu-id="2f11c-276">Once the global network architecture showing the Office 365 region, ExpressRoute network service provider meet-me locations, and the quantity of people by location has been developed, it can be used to identify if any optimizations can be made.</span></span> <span data-ttu-id="2f11c-277">Può anche mostrare connessioni di rete di hairpin globali in cui il traffico viene instradato a una posizione distante per ottenere la posizione di meet-me.</span><span class="sxs-lookup"><span data-stu-id="2f11c-277">It may also show global hairpin network connections where traffic routes to a distant location in order to get the meet-me location.</span></span> <span data-ttu-id="2f11c-278">Se viene individuato un hairpin nella rete globale, è necessario correggere il sistema prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="2f11c-278">If a hairpin on the global network is discovered it should be remediated before continuing.</span></span> <span data-ttu-id="2f11c-279">Trovare un'altra posizione di meet-me o usare punti di uscita di breakout Internet selettivi per evitare l'hairpin.</span><span class="sxs-lookup"><span data-stu-id="2f11c-279">Either find another meet-me location, or use selective Internet breakout egress points to avoid the hairpin.</span></span>
  
<span data-ttu-id="2f11c-280">Il primo diagramma mostra un esempio di cliente con due posizioni fisiche in Nord America.</span><span class="sxs-lookup"><span data-stu-id="2f11c-280">The first diagram, shows an example of a customer with two physical locations in North America.</span></span> <span data-ttu-id="2f11c-281">È possibile visualizzare le informazioni sulle posizioni degli uffici, Office 365 tenant e diverse scelte per le posizioni meet-me di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-281">You can see the information about office locations, Office 365 tenant locations, and several choices for ExpressRoute meet-me locations.</span></span> <span data-ttu-id="2f11c-282">In questo esempio, il cliente ha selezionato la posizione meet-me in base a due principi, nell'ordine seguente:</span><span class="sxs-lookup"><span data-stu-id="2f11c-282">In this example, the customer has selected the meet-me location based on two principles, in order:</span></span>
  
1. <span data-ttu-id="2f11c-283">Prossimità più vicina alle persone dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-283">Closest proximity to the people in their organization.</span></span>

2. <span data-ttu-id="2f11c-284">Più vicino a un datacenter Microsoft in cui Office 365 è ospitato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-284">Closest in proximity to a Microsoft datacenter where Office 365 is hosted.</span></span>

![ExpressRoute US geographic meet-me](../media/5ec38274-b317-4ec1-91c8-90c2a7fd32ca.png)
  
<span data-ttu-id="2f11c-286">Espandendo leggermente ulteriormente questo concetto, il secondo diagramma mostra un esempio di cliente multi-nazionale di fronte a informazioni e decisioni simili.</span><span class="sxs-lookup"><span data-stu-id="2f11c-286">Expanding this concept slightly further, the second diagram shows an example multi-national customer faced with similar information and decision making.</span></span> <span data-ttu-id="2f11c-287">Questo cliente ha un piccolo ufficio in Bangladesh con solo un piccolo team di dieci persone che si è concentrato sulla crescita della propria impronta nella regione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-287">This customer has a small office in Bangladesh with only a small team of ten people focused on growing their footprint in the region.</span></span> <span data-ttu-id="2f11c-288">C'è una posizione meet-me a Chennai e un datacenter Microsoft con Office 365 ospitato a Chennai in modo che una posizione di meet-me avrebbe senso; tuttavia, per dieci persone, il costo del circuito aggiuntivo è gravoso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-288">There is a meet-me location in Chennai and a Microsoft datacenter with Office 365 hosted in Chennai so a meet-me location would make sense; however, for ten people, the expense of the additional circuit is burdensome.</span></span> <span data-ttu-id="2f11c-289">Quando si osserva la rete, è necessario determinare se la latenza implicata nell'invio del traffico di rete attraverso la rete è più efficace che spendere il capitale per acquisire un altro circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-289">As you look at your network, you'll need to determine if the latency involved in sending your network traffic across your network is more effective than spending the capital to acquire another ExpressRoute circuit.</span></span>
  
<span data-ttu-id="2f11c-290">In alternativa, le dieci persone in Bangladesh possono ottenere prestazioni migliori con il traffico di rete inviato tramite Internet alla rete Microsoft rispetto al routing sulla rete interna, come illustrato nei diagrammi introduttivi e riprodotti di seguito.</span><span class="sxs-lookup"><span data-stu-id="2f11c-290">Alternatively, the ten people in Bangladesh may experience better performance with their network traffic sent over the internet to the Microsoft network than they would routing on their internal network as we showed in the introductory diagrams and reproduced below.</span></span>
  
![Connessioni in uscita per il diagramma regionale](../media/8319943d-08f0-4781-9ef3-d23de2ad4671.png)
  
## <a name="create-your-expressroute-for-office-365-implementation-plan"></a><span data-ttu-id="2f11c-292">Creare il piano di implementazione expressroute Office 365 distribuzione</span><span class="sxs-lookup"><span data-stu-id="2f11c-292">Create your ExpressRoute for Office 365 implementation plan</span></span>
<span data-ttu-id="2f11c-293"><a name="implementation"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-293"><a name="implementation"> </a></span></span>

<span data-ttu-id="2f11c-294">Il piano di implementazione deve comprendere sia i dettagli tecnici della configurazione di ExpressRoute che i dettagli della configurazione di tutta l'altra infrastruttura della rete, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="2f11c-294">Your implementation plan should encompass both the technical details of configuring ExpressRoute as well as the details of configuring all the other infrastructure on your network, such as the following.</span></span>
  
- <span data-ttu-id="2f11c-295">Pianificare i servizi suddivisi tra ExpressRoute e Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-295">Plan which services split between ExpressRoute and Internet.</span></span>

- <span data-ttu-id="2f11c-296">Pianificare larghezza di banda, sicurezza, disponibilità elevata e failover.</span><span class="sxs-lookup"><span data-stu-id="2f11c-296">Plan for bandwidth, security, high availability and failover.</span></span>

- <span data-ttu-id="2f11c-297">Progettare il routing in ingresso e in uscita, incluse le ottimizzazioni corrette dei percorsi di routing per posizioni diverse</span><span class="sxs-lookup"><span data-stu-id="2f11c-297">Design inbound and outbound routing, including proper routing path optimizations for different locations</span></span>

- <span data-ttu-id="2f11c-298">Decidere fino a dove verranno annunciate le route ExpressRoute nella rete e qual è il meccanismo per i client per selezionare il percorso Internet o ExpressRoute; ad esempio, routing diretto o proxy dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-298">Decide how far ExpressRoute routes will be advertised into your network and what is the mechanism for clients to select Internet or ExpressRoute path; for example, direct routing or application proxy.</span></span>

- <span data-ttu-id="2f11c-299">Pianificare le modifiche ai record DNS, incluse [le voci di Sender Policy Framework.](../security/office-365-security/set-up-spf-in-office-365-to-help-prevent-spoofing.md)</span><span class="sxs-lookup"><span data-stu-id="2f11c-299">Plan DNS record changes, including [Sender Policy Framework](../security/office-365-security/set-up-spf-in-office-365-to-help-prevent-spoofing.md) entries.</span></span>

- <span data-ttu-id="2f11c-300">Pianificare la strategia NAT tra cui NAT di origine in uscita e in ingresso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-300">Plan NAT strategy including outbound and inbound source NAT.</span></span>

### <a name="plan-your-routing-with-both-internet-and-expressroute-network-paths"></a><span data-ttu-id="2f11c-301">Pianificare il routing con percorsi di rete Sia Internet che ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2f11c-301">Plan your routing with both internet and ExpressRoute network paths</span></span>
<span data-ttu-id="2f11c-302"><a name="paths"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-302"><a name="paths"> </a></span></span>

- <span data-ttu-id="2f11c-303">Per la distribuzione iniziale, tutti i servizi in ingresso, ad esempio la posta elettronica in ingresso o la connettività ibrida, sono consigliati per l'utilizzo di Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-303">For your initial deployment, all inbound services, such as inbound email or hybrid connectivity, are recommended to use the internet.</span></span>

- <span data-ttu-id="2f11c-304">Pianificare il routing DELLAN client degli utenti finali, ad esempio la configurazione di un [file PAC/WPAD,](./managing-office-365-endpoints.md)una route predefinita, server proxy e annunci di route BGP.</span><span class="sxs-lookup"><span data-stu-id="2f11c-304">Plan end user client LAN routing, such as [configuring a PAC/WPAD file](./managing-office-365-endpoints.md), default route, proxy servers, and BGP route advertisements.</span></span>

- <span data-ttu-id="2f11c-305">Pianificare il routing perimetrale, inclusi server proxy, firewall e proxy cloud.</span><span class="sxs-lookup"><span data-stu-id="2f11c-305">Plan perimeter routing, including proxy servers, firewalls, and cloud proxies.</span></span>

### <a name="plan-your-bandwidth-security-high-availability-and-failover"></a><span data-ttu-id="2f11c-306">Pianificare la larghezza di banda, la sicurezza, la disponibilità elevata e il failover</span><span class="sxs-lookup"><span data-stu-id="2f11c-306">Plan your bandwidth, security, high availability and failover</span></span>
<span data-ttu-id="2f11c-307"><a name="availability"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-307"><a name="availability"> </a></span></span>

<span data-ttu-id="2f11c-308">Creare un piano per la larghezza di banda necessaria per ogni carico di lavoro Office 365 principale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-308">Create a plan for bandwidth required for each major Office 365 workload.</span></span> <span data-ttu-id="2f11c-309">Stimare separatamente Exchange Online, SharePoint Online e Skype for Business di larghezza di banda online.</span><span class="sxs-lookup"><span data-stu-id="2f11c-309">Separately estimate Exchange Online, SharePoint Online, and Skype for Business Online bandwidth requirements.</span></span> <span data-ttu-id="2f11c-310">Puoi usare i calcolatori di stima forniti per Exchange Online e Skype for Business come punto di partenza; Tuttavia, è necessario un test pilota con un campione rappresentativo dei profili utente e delle posizioni per comprendere appieno le esigenze di larghezza di banda dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-310">You can use the estimation calculators we've provided for Exchange Online and Skype for Business as a starting place; however, a pilot test with a representative sample of the user profiles and locations is required to fully understand the bandwidth needs of your organization.</span></span>
  
<span data-ttu-id="2f11c-311">Aggiungi come viene gestita la sicurezza in ogni posizione di uscita di Internet e ExpressRoute al piano, ricorda tutte le connessioni ExpressRoute a Office 365 usa il peering pubblico e deve comunque essere protetta in conformità ai criteri di sicurezza aziendali per la connessione a reti esterne.</span><span class="sxs-lookup"><span data-stu-id="2f11c-311">Add how security is handled at each internet and ExpressRoute egress location to your plan, remember all ExpressRoute connections to Office 365 use public peering and must still be secured in accordance with your company security policies of connecting to external networks.</span></span>
  
<span data-ttu-id="2f11c-312">Aggiungere dettagli al piano sulle persone interessate dal tipo di interruzione e su come tali persone saranno in grado di eseguire il proprio lavoro a piena capacità nel modo più semplice.</span><span class="sxs-lookup"><span data-stu-id="2f11c-312">Add details to your plan about which people will be affected by what type of outage and how those people will be able to perform their work at full capacity in the simplest manner.</span></span>
  
#### <a name="plan-bandwidth-requirements-including-skype-for-business-requirements-on-jitter-latency-congestion-and-headroom"></a><span data-ttu-id="2f11c-313">Pianificare i requisiti di larghezza di Skype for Business instabilità, latenza, congestione e headroom</span><span class="sxs-lookup"><span data-stu-id="2f11c-313">Plan bandwidth requirements including Skype for Business requirements on Jitter, Latency, Congestion, and Headroom</span></span>
  
<span data-ttu-id="2f11c-314">Skype for Business Online ha anche specifici requisiti di rete aggiuntivi, che sono dettagliati nell'articolo Qualità multimediale e prestazioni della connettività di [rete in Skype for Business Online](https://support.office.com/article/Media-Quality-and-Network-Connectivity-Performance-in-Skype-for-Business-Online-5fe3e01b-34cf-44e0-b897-b0b2a83f0917).</span><span class="sxs-lookup"><span data-stu-id="2f11c-314">Skype for Business Online also has specific additional network requirements which are detailed in the article [Media Quality and Network Connectivity Performance in Skype for Business Online](https://support.office.com/article/Media-Quality-and-Network-Connectivity-Performance-in-Skype-for-Business-Online-5fe3e01b-34cf-44e0-b897-b0b2a83f0917).</span></span>
  
<span data-ttu-id="2f11c-315">Leggere la sezione **Pianificazione della larghezza di banda per Azure ExpressRoute** in Pianificazione della rete con [ExpressRoute per Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span><span class="sxs-lookup"><span data-stu-id="2f11c-315">Read the section **Bandwidth planning for Azure ExpressRoute** in [Network planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span></span>
  
<span data-ttu-id="2f11c-316">Quando esegui una valutazione della larghezza di banda con gli utenti pilota, puoi usare la nostra guida; [Office 365 ottimizzazione delle prestazioni utilizzando le previsioni e la cronologia delle prestazioni.](https://support.office.com/article/Office-365-performance-tuning-using-baselines-and-performance-history-1492cb94-bd62-43e6-b8d0-2a61ed88ebae)</span><span class="sxs-lookup"><span data-stu-id="2f11c-316">When performing a bandwidth assessment with your pilot users, you can use our guide; [Office 365 performance tuning using baselines and performance history](https://support.office.com/article/Office-365-performance-tuning-using-baselines-and-performance-history-1492cb94-bd62-43e6-b8d0-2a61ed88ebae).</span></span>
  
#### <a name="plan-for-high-availability-requirements"></a><span data-ttu-id="2f11c-317">Pianificare i requisiti di disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="2f11c-317">Plan for high availability requirements</span></span>
  
<span data-ttu-id="2f11c-318">Creare un piano per la disponibilità elevata in base alle proprie esigenze e incorporarlo nel diagramma della topologia di rete aggiornato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-318">Create a plan for high availability to meet your needs and incorporate this into your updated network topology diagram.</span></span> <span data-ttu-id="2f11c-319">Leggere la sezione **Disponibilità elevata e failover con Azure ExpressRoute** in Pianificazione della rete con [ExpressRoute per Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span><span class="sxs-lookup"><span data-stu-id="2f11c-319">Read the section **High availability and failover with Azure ExpressRoute** in [Network planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span></span>
  
#### <a name="plan-for-network-security-requirements"></a><span data-ttu-id="2f11c-320">Pianificare i requisiti di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="2f11c-320">Plan for network security requirements</span></span>
  
<span data-ttu-id="2f11c-321">Creare un piano per soddisfare i requisiti di sicurezza di rete e incorporarlo nel diagramma della topologia di rete aggiornato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-321">Create a plan to meet your network security requirements and incorporate this into your updated network topology diagram.</span></span> <span data-ttu-id="2f11c-322">Leggere la sezione Applicazione dei controlli di sicurezza ad **Azure ExpressRoute** per scenari Office 365 in Pianificazione della rete con [ExpressRoute per Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span><span class="sxs-lookup"><span data-stu-id="2f11c-322">Read the section **Applying security controls to Azure ExpressRoute for Office 365 scenarios** in [Network planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span></span>
  
### <a name="design-outbound-service-connectivity"></a><span data-ttu-id="2f11c-323">Progettare la connettività del servizio in uscita</span><span class="sxs-lookup"><span data-stu-id="2f11c-323">Design outbound service connectivity</span></span>
<span data-ttu-id="2f11c-324"><a name="outbound"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-324"><a name="outbound"> </a></span></span>

<span data-ttu-id="2f11c-325">ExpressRoute per Office 365 *ha requisiti* di rete in uscita che potrebbero non essere familiari.</span><span class="sxs-lookup"><span data-stu-id="2f11c-325">ExpressRoute for Office 365 has  *outbound*  network requirements that may be unfamiliar.</span></span> <span data-ttu-id="2f11c-326">In particolare, gli indirizzi IP che rappresentano gli utenti e le reti da Office 365 e agiscono come endpoint di origine per le connessioni di rete in uscita a Microsoft devono soddisfare requisiti specifici descritti di seguito.</span><span class="sxs-lookup"><span data-stu-id="2f11c-326">Specifically, the IP addresses that represent your users and networks to Office 365 and act as the source endpoints for outbound network connections to Microsoft must follow specific requirements outlined below.</span></span>
  
1. <span data-ttu-id="2f11c-327">Gli endpoint devono essere indirizzi IP pubblici, registrati nell'azienda o per l'operatore che fornisce la connettività ExpressRoute all'utente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-327">The endpoints must be public IP addresses, that are registered to your company or to carrier providing ExpressRoute connectivity to you.</span></span>

2. <span data-ttu-id="2f11c-328">Gli endpoint devono essere annunciati a Microsoft e convalidati/accettati da ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-328">The endpoints must be advertised to Microsoft and validated/accepted by ExpressRoute.</span></span>

3. <span data-ttu-id="2f11c-329">Gli endpoint non devono essere annunciati a Internet con la stessa o più metrica di routing preferita.</span><span class="sxs-lookup"><span data-stu-id="2f11c-329">The endpoints must not be advertised to the Internet with the same or more preferred routing metric.</span></span>

4. <span data-ttu-id="2f11c-330">Gli endpoint non devono essere usati per la connettività servizi Microsoft che non sono configurati su ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-330">The endpoints must not be used for connectivity to Microsoft services that are not configured over ExpressRoute.</span></span>

<span data-ttu-id="2f11c-331">Se la progettazione della rete non soddisfa questi requisiti, esiste un rischio elevato per gli utenti che si verifichino errori di connettività a Office 365 e ad altri servizi Microsoft a causa dell'instradamento nero o del routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-331">If your network design doesn't meet these requirements, there is a high risk your users will experience connectivity failures to Office 365 and other Microsoft services due to route black holing or asymmetric routing.</span></span> <span data-ttu-id="2f11c-332">Ciò si verifica quando le richieste di servizi Microsoft vengono instradati tramite ExpressRoute, ma le risposte vengono instradati attraverso Internet o viceversa e le risposte vengono eliminate da dispositivi di rete con stato, ad esempio firewall.</span><span class="sxs-lookup"><span data-stu-id="2f11c-332">This occurs when requests to Microsoft services are routed over ExpressRoute, but responses are routed back across the internet, or vice versa, and the responses are dropped by stateful network devices such as firewalls.</span></span>
  
<span data-ttu-id="2f11c-333">Il metodo più comune che puoi usare per soddisfare i requisiti precedenti è usare NAT di origine, implementato come parte della rete o fornito dall'operatore ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-333">The most common method you can use to meet the above requirements is to use source NAT, either implemented as a part of your network or provided by your ExpressRoute carrier.</span></span> <span data-ttu-id="2f11c-334">Source NAT consente di astrarre i dettagli e l'indirizzamento IP privato della rete Internet da ExpressRoute e; Insieme agli annunci di route IP adeguati, fornisce un meccanismo semplice per garantire la simmetria del percorso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-334">Source NAT allows you to abstract the details and private IP addressing of your internet network from ExpressRoute and; coupled with proper IP route advertisements, provide an easy mechanism to ensure path symmetry.</span></span> <span data-ttu-id="2f11c-335">Se si usano dispositivi di rete con stato specifici per le posizioni di peering ExpressRoute, è necessario implementare pool NAT separati per ogni peering ExpressRoute per garantire la simmetria del percorso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-335">If you're using stateful network devices that are specific to ExpressRoute peering locations, you must implement separate NAT pools for each ExpressRoute peering to ensure path symmetry.</span></span>
  
<span data-ttu-id="2f11c-336">Per ulteriori informazioni, [vedere Requisiti NAT expressRoute.](/azure/expressroute/expressroute-nat)</span><span class="sxs-lookup"><span data-stu-id="2f11c-336">Read more about the [ExpressRoute NAT requirements](/azure/expressroute/expressroute-nat).</span></span>
  
<span data-ttu-id="2f11c-337">Aggiungere le modifiche per la connettività in uscita al diagramma della topologia di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-337">Add the changes for the outbound connectivity to the network topology diagram.</span></span>
  
### <a name="design-inbound-service-connectivity"></a><span data-ttu-id="2f11c-338">Progettare la connettività dei servizi in ingresso</span><span class="sxs-lookup"><span data-stu-id="2f11c-338">Design inbound service connectivity</span></span>
<span data-ttu-id="2f11c-339"><a name="inbound"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-339"><a name="inbound"> </a></span></span>

<span data-ttu-id="2f11c-340">La maggior parte delle distribuzioni di enterprise Office 365 presuppongono una qualche forma di connettività in ingresso da Office 365 ai servizi locali, ad esempio per gli scenari ibridi di Exchange, SharePoint e Skype for Business, le migrazioni delle cassette postali e l'autenticazione tramite l'infrastruttura ADFS.</span><span class="sxs-lookup"><span data-stu-id="2f11c-340">The majority of enterprise Office 365 deployments assume some form of inbound connectivity from Office 365 to on-premises services, such as for Exchange, SharePoint, and Skype for Business hybrid scenarios, mailbox migrations, and authentication using ADFS infrastructure.</span></span> <span data-ttu-id="2f11c-341">Quando ExpressRoute abilita un percorso di routing aggiuntivo tra la rete locale e Microsoft per la connettività in uscita, queste connessioni in ingresso potrebbero essere inavvertitamente influenzate dal routing asimmetrico, anche se si prevede che tali flussi continuino a utilizzare Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-341">When ExpressRoute you enable an additional routing path between your on-premises network and Microsoft for outbound connectivity, these inbound connections may inadvertently be impacted by asymmetric routing, even if you intend to have those flows continue to use the Internet.</span></span> <span data-ttu-id="2f11c-342">Alcune precauzioni descritte di seguito sono consigliate per garantire che non vi sia alcun impatto sui flussi in ingresso basati su Internet Office 365 ai sistemi locali.</span><span class="sxs-lookup"><span data-stu-id="2f11c-342">A few precautions described below are recommended to ensure there is no impact to Internet based inbound flows from Office 365 to on-premises systems.</span></span>
  
<span data-ttu-id="2f11c-343">Per ridurre al minimo i rischi del routing asimmetrico per i flussi di traffico di rete in ingresso, tutte le connessioni in ingresso devono usare NAT di origine prima di essere instradate in segmenti della rete con visibilità di routing in ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-343">To minimize the risks of asymmetric routing for inbound network traffic flows, all of the inbound connections should use source NAT before they're routed into segments of your network which have routing visibility into ExpressRoute.</span></span> <span data-ttu-id="2f11c-344">Se le connessioni in ingresso sono consentite su un segmento di rete con visibilità di routing in ExpressRoute senza NAT di origine, le richieste provenienti da Office 365 verranno inviate da Internet, ma la risposta che torna a Office 365 preferirà il percorso di rete ExpressRoute alla rete Microsoft, causando il routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-344">If the incoming connections are allowed onto a network segment with routing visibility into ExpressRoute without source NAT, requests originating from Office 365 will enter from the internet, but the response going back to Office 365 will prefer the ExpressRoute network path back to the Microsoft network, causing asymmetric routing.</span></span>
  
<span data-ttu-id="2f11c-345">È possibile prendere in considerazione uno dei modelli di implementazione seguenti per soddisfare questo requisito:</span><span class="sxs-lookup"><span data-stu-id="2f11c-345">You may consider one of the following implementation patterns to satisfy this requirement:</span></span>
  
1. <span data-ttu-id="2f11c-346">Eseguire NAT di origine prima che le richieste siano instradati nella rete interna utilizzando apparecchiature di rete come firewall o servizi di bilanciamento del carico nel percorso da Internet ai sistemi locali.</span><span class="sxs-lookup"><span data-stu-id="2f11c-346">Perform source NAT before requests are routed into your internal network using networking equipment such as firewalls or load balancers on the path from the Internet to your on-premises systems.</span></span>

2. <span data-ttu-id="2f11c-347">Assicurarsi che le route ExpressRoute non vengano propagate ai segmenti di rete in cui risiedono i servizi in ingresso, ad esempio i server front-end o i sistemi proxy inversi, che gestisce le connessioni Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-347">Ensure that ExpressRoute routes are not propagated to the network segments where inbound services, such as front end servers or reverse proxy systems, handling Internet connections reside.</span></span>

<span data-ttu-id="2f11c-348">Tenere esplicitamente conto di questi scenari nella rete e mantenere tutto il traffico di rete in ingresso su Internet consente di ridurre al minimo i rischi operativi e di distribuzione del routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-348">Explicitly accounting for these scenarios in your network and keeping all inbound network traffic flows over the Internet helps to minimize deployment and operational risk of asymmetric routing.</span></span>
  
<span data-ttu-id="2f11c-349">In alcuni casi è possibile scegliere di indirizzare alcuni flussi in ingresso sulle connessioni ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-349">There may be cases where you may choose to direct some inbound flows over ExpressRoute connections.</span></span> <span data-ttu-id="2f11c-350">Per questi scenari, tenere conto delle considerazioni aggiuntive seguenti.</span><span class="sxs-lookup"><span data-stu-id="2f11c-350">For these scenarios, take the following additional considerations into account.</span></span>
  
1. <span data-ttu-id="2f11c-351">Office 365 possono essere utilizzati solo endpoint locali che usano IP pubblici.</span><span class="sxs-lookup"><span data-stu-id="2f11c-351">Office 365 can only target on-premises endpoints that use public IPs.</span></span> <span data-ttu-id="2f11c-352">Ciò significa che anche se l'endpoint in ingresso locale è esposto solo a Office 365 tramite ExpressRoute, deve comunque avere un INDIRIZZO IP pubblico associato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-352">This means that even if the on-premises inbound endpoint is only exposed to Office 365 over ExpressRoute, it still needs to have public IP associated with it.</span></span>

2. <span data-ttu-id="2f11c-353">Tutta la risoluzione dei nomi DNS Office 365 dei servizi per risolvere gli endpoint locali avviene utilizzando DNS pubblico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-353">All DNS name resolution that Office 365 services perform to resolve on-premises endpoints happen using public DNS.</span></span> <span data-ttu-id="2f11c-354">Ciò significa che è necessario registrare il nome di dominio completo degli endpoint del servizio in ingresso nei mapping IP su Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-354">This means that you must register inbound service endpoints' FQDN to IP mappings on the Internet.</span></span>

3. <span data-ttu-id="2f11c-355">Per ricevere connessioni di rete in ingresso tramite ExpressRoute, le subnet IP pubbliche per questi endpoint devono essere annunciate a Microsoft tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-355">In order to receive inbound network connections over ExpressRoute, the public IP subnets for these endpoints must to be advertised to Microsoft over ExpressRoute.</span></span>

4. <span data-ttu-id="2f11c-356">Valutare attentamente questi flussi di traffico di rete in ingresso per assicurarsi che a essi siano applicati controlli di sicurezza e di rete adeguati in conformità con i criteri di sicurezza e di rete dell'azienda.</span><span class="sxs-lookup"><span data-stu-id="2f11c-356">Carefully evaluate these inbound network traffic flows to ensure that proper security and network controls are applied to them in accordance with your company security and network policies.</span></span>

5. <span data-ttu-id="2f11c-357">Una volta che gli endpoint in ingresso locali vengono annunciati a Microsoft tramite ExpressRoute, ExpressRoute diventerà effettivamente il percorso di routing preferito per tali endpoint per tutti i servizi Microsoft, incluso Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-357">Once your on-premises inbound endpoints are advertised to Microsoft over ExpressRoute, ExpressRoute will effectively become the preferred routing path to those endpoints for all Microsoft services, including Office 365.</span></span> <span data-ttu-id="2f11c-358">Ciò significa che tali subnet endpoint devono essere utilizzate solo per le comunicazioni con Office 365 e nessun altro servizio nella rete Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2f11c-358">This means that those endpoint subnets must only be used for communications with Office 365 services and no other services on the Microsoft network.</span></span> <span data-ttu-id="2f11c-359">In caso contrario, la progettazione causerà il routing asimmetrico in cui le connessioni in ingresso da altri servizi Microsoft preferiscono eseguire il routing in ingresso su ExpressRoute, mentre il percorso di ritorno utilizzerà Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-359">Otherwise, your design will cause asymmetric routing where inbound connections from other Microsoft services prefer to route inbound over ExpressRoute, while the return path will use the Internet.</span></span>

6. <span data-ttu-id="2f11c-360">Nel caso in cui un circuito ExpressRoute o una posizione meet-me non sia disponibile, è necessario verificare che gli endpoint in ingresso locali siano ancora disponibili per accettare le richieste su un percorso di rete separato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-360">In the event an ExpressRoute circuit or meet-me location is down, you'll need to ensure the on-premises inbound endpoints are still available to accept requests over a separate network path.</span></span> <span data-ttu-id="2f11c-361">Ciò può indicare subnet pubblicitarie per tali endpoint tramite più circuiti ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-361">This may mean advertising subnets for those endpoints through multiple ExpressRoute circuits.</span></span>

7. <span data-ttu-id="2f11c-362">È consigliabile applicare NAT di origine per tutti i flussi di traffico di rete in ingresso che entrano nella rete tramite ExpressRoute, soprattutto quando questi flussi attraversano dispositivi di rete con stato, ad esempio firewall.</span><span class="sxs-lookup"><span data-stu-id="2f11c-362">We recommend applying source NAT for all inbound network traffic flows entering your network through ExpressRoute, especially when these flows cross stateful network devices such as firewalls.</span></span>

8. <span data-ttu-id="2f11c-363">Alcuni servizi locali, ad esempio il proxy ADFS o l'individuazione automatica Exchange, possono ricevere richieste in ingresso sia dai servizi Office 365 che dagli utenti da Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-363">Some on-premises services, such as ADFS proxy or Exchange autodiscover, may receive inbound requests from both Office 365 services and users from the Internet.</span></span> <span data-ttu-id="2f11c-364">Per queste richieste Office 365 lo stesso FQDN delle richieste utente su Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-364">For these requests Office 365 will target the same FQDN as user requests over the Internet.</span></span> <span data-ttu-id="2f11c-365">Consentire le connessioni utente in ingresso da Internet a tali endpoint locali, forzando le connessioni Office 365 a usare ExpressRoute, rappresenta una notevole complessità di routing.</span><span class="sxs-lookup"><span data-stu-id="2f11c-365">Allowing inbound user connections from the internet to those on-premises endpoints, while forcing Office 365 connections to use ExpressRoute, represents significant routing complexity.</span></span> <span data-ttu-id="2f11c-366">Per la maggior parte dei clienti l'implementazione di scenari così complessi su ExpressRoute non è consigliata a causa di considerazioni operative.</span><span class="sxs-lookup"><span data-stu-id="2f11c-366">For the vast majority of customers implementing such complex scenarios over ExpressRoute is not recommended due to operational considerations.</span></span> <span data-ttu-id="2f11c-367">Questo sovraccarico aggiuntivo include la gestione dei rischi del routing asimmetrico e richiederà di gestire con attenzione gli annunci e i criteri di routing su più dimensioni.</span><span class="sxs-lookup"><span data-stu-id="2f11c-367">This additional overhead includes, managing risks of asymmetric routing and will require you to carefully manage routing advertisements and policies across multiple dimensions.</span></span>

### <a name="update-your-network-topology-plan-to-show-how-you-would-avoid-asymmetric-routes"></a><span data-ttu-id="2f11c-368">Aggiornare il piano della topologia di rete per mostrare come evitare le route asimmetriche</span><span class="sxs-lookup"><span data-stu-id="2f11c-368">Update your network topology plan to show how you would avoid asymmetric routes</span></span>
<span data-ttu-id="2f11c-369"><a name="asymmetric"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-369"><a name="asymmetric"> </a></span></span>

<span data-ttu-id="2f11c-370">Si desidera evitare il routing asimmetrico per garantire che gli utenti dell'organizzazione possano utilizzare Office 365 senza problemi e altri servizi importanti su Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-370">You want to avoid asymmetric routing to ensure people in your organization can seamlessly use Office 365 as well as other important services on the internet.</span></span> <span data-ttu-id="2f11c-371">Esistono due configurazioni comuni che causano il routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-371">There are two common configurations customers have that cause asymmetric routing.</span></span> <span data-ttu-id="2f11c-372">È il momento giusto per esaminare la configurazione di rete che si prevede di usare e verificare se potrebbe esistere uno di questi scenari di routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="2f11c-372">Now's a good time to review the network configuration you're planning to use and check if one of these asymmetric routing scenarios could exist.</span></span>
  
<span data-ttu-id="2f11c-373">Per iniziare, verranno esaminate alcune situazioni diverse associate al diagramma di rete seguente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-373">To begin, we'll examine a few different situations associated with the following network diagram.</span></span> <span data-ttu-id="2f11c-374">In questo diagramma, tutti i server che ricevono richieste in ingresso, ad esempio ADFS o i server ibridi locali, sono nel data center del New Jersey e sono annunciati su Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-374">In this diagram, all servers that receive inbound requests, such as ADFS or on-premises hybrid servers are in the New Jersey data center and are advertised to the internet.</span></span>
  
1. <span data-ttu-id="2f11c-375">Mentre la rete perimetrale è sicura, non è disponibile alcun NAT di origine per le richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-375">While the perimeter network is secure, there is no Source NAT available for incoming requests.</span></span>

2. <span data-ttu-id="2f11c-376">I server nel data center del New Jersey sono in grado di visualizzare sia le route Internet che expressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-376">The servers in the New Jersey data center are able to see both internet and ExpressRoute routes.</span></span>

![Panoramica della connettività ExpressRoute](../media/8f074af6-ef38-44e8-bc5a-8b4d981fbb20.png)
  
<span data-ttu-id="2f11c-378">Abbiamo anche suggerimenti su come correggerli.</span><span class="sxs-lookup"><span data-stu-id="2f11c-378">We also have suggestions on how to fix them.</span></span>
  
#### <a name="problem-1-cloud-to-on-premises-connection-over-the-internet"></a><span data-ttu-id="2f11c-379">Problema 1: connessione da cloud a locale tramite Internet</span><span class="sxs-lookup"><span data-stu-id="2f11c-379">Problem 1: Cloud to on-premises connection over the Internet</span></span>
  
<span data-ttu-id="2f11c-380">Il diagramma seguente illustra il percorso di rete asimmetrico intrapreso quando la configurazione di rete non fornisce NAT per le richieste in ingresso dal cloud Microsoft su Internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-380">The following diagram illustrates the asymmetric network path taken when your network configuration doesn't provide NAT for inbound requests from the Microsoft cloud over the internet.</span></span>
  
1. <span data-ttu-id="2f11c-381">La richiesta in ingresso Office 365 recupera l'indirizzo IP dell'endpoint locale dal DNS pubblico e invia la richiesta alla rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-381">The inbound request from Office 365 retrieves the IP address of the on-premises endpoint from public DNS and sends the request to your perimeter network.</span></span>

2. <span data-ttu-id="2f11c-382">In questa configurazione difettosa non è configurato o disponibile alcun NAT di origine nella rete perimetrale in cui viene inviato il traffico, con conseguente utilizzo dell'indirizzo IP di origine effettivo come destinazione di ritorno.</span><span class="sxs-lookup"><span data-stu-id="2f11c-382">In this faulty configuration, there is no Source NAT configured or available at the perimeter network where the traffic is sent resulting in the actual source IP address being used as the return destination.</span></span>

  - <span data-ttu-id="2f11c-383">Il server della rete instrada il traffico di ritorno Office 365 attraverso qualsiasi connessione di rete ExpressRoute disponibile.</span><span class="sxs-lookup"><span data-stu-id="2f11c-383">The server on your network routes the return traffic to Office 365 through any available ExpressRoute network connection.</span></span>

  - <span data-ttu-id="2f11c-384">Il risultato è un percorso asimmetrico per il flusso Office 365, con conseguente connessione interrotta.</span><span class="sxs-lookup"><span data-stu-id="2f11c-384">The result is an Asymmetric path for that flow to Office 365, resulting in a broken connection.</span></span>

![ExpressRoute Asymetric routing problem 1](../media/9c210c2a-e0ea-4180-8ede-1bf41746ce7a.png)
  
##### <a name="solution-1a-source-nat"></a><span data-ttu-id="2f11c-386">Soluzione 1a: NAT di origine</span><span class="sxs-lookup"><span data-stu-id="2f11c-386">Solution 1a: Source NAT</span></span>
  
<span data-ttu-id="2f11c-387">La semplice aggiunta di un NAT di origine alla richiesta in ingresso risolve questa rete non configurata correttamente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-387">Simply adding a source NAT to the inbound request resolves this misconfigured network.</span></span> <span data-ttu-id="2f11c-388">In questo diagramma:</span><span class="sxs-lookup"><span data-stu-id="2f11c-388">In this diagram:</span></span>
  
1. <span data-ttu-id="2f11c-389">La richiesta in arrivo continua a entrare attraverso la rete perimetrale del data center del New Jersey.</span><span class="sxs-lookup"><span data-stu-id="2f11c-389">The incoming request continues to enter through the New Jersey data center's perimeter network.</span></span> <span data-ttu-id="2f11c-390">Questa volta Nat di origine è disponibile.</span><span class="sxs-lookup"><span data-stu-id="2f11c-390">This time Source NAT is available.</span></span>

2. <span data-ttu-id="2f11c-391">La risposta dal server instrada di nuovo verso l'IP associato al NAT di origine anziché all'indirizzo IP originale, determinando la restituzione della risposta lungo lo stesso percorso di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-391">The response from the server routes back toward the IP associated with the Source NAT instead of the original IP address, resulting in the response returning along the same network path.</span></span>

![Soluzione di routing Asymetric ExpressRoute 1](../media/0e87a155-f8de-48ed-92ac-27367b727a82.png)
  
##### <a name="solution-1b-route-scoping"></a><span data-ttu-id="2f11c-393">Soluzione 1b: ambito route</span><span class="sxs-lookup"><span data-stu-id="2f11c-393">Solution 1b: Route Scoping</span></span>
  
<span data-ttu-id="2f11c-394">In alternativa, è possibile scegliere di non consentire l'annuncio dei prefissi BGP ExpressRoute, rimuovendo il percorso di rete alternativo per tali computer.</span><span class="sxs-lookup"><span data-stu-id="2f11c-394">Alternatively, you can choose to not allow the ExpressRoute BGP prefixes to be advertised, removing the alternate network path for those computers.</span></span> <span data-ttu-id="2f11c-395">In questo diagramma:</span><span class="sxs-lookup"><span data-stu-id="2f11c-395">In this diagram:</span></span>
  
1. <span data-ttu-id="2f11c-396">La richiesta in arrivo continua a entrare attraverso la rete perimetrale del data center del New Jersey.</span><span class="sxs-lookup"><span data-stu-id="2f11c-396">The incoming request continues to enter through the New Jersey data center's perimeter network.</span></span> <span data-ttu-id="2f11c-397">Questa volta i prefissi annunciati da Microsoft tramite il circuito ExpressRoute non sono disponibili per il data center del New Jersey.</span><span class="sxs-lookup"><span data-stu-id="2f11c-397">This time the prefixes advertised from Microsoft over the ExpressRoute circuit are not available to the New Jersey data center.</span></span>

2. <span data-ttu-id="2f11c-398">La risposta dal server instrada di nuovo verso l'IP associato all'indirizzo IP originale sull'unica route disponibile, determinando la restituzione della risposta lungo lo stesso percorso di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-398">The response from the server routes back toward the IP associated with the original IP address over the only route available, resulting in the response returning along the same network path.</span></span>

![Soluzione di routing Asymetric ExpressRoute 2](../media/9cb4b2bf-7aa6-487a-bc02-e02af8a979f6.png)
  
#### <a name="problem-2-cloud-to-on-premises-connection-over-expressroute"></a><span data-ttu-id="2f11c-400">Problema 2: connessione da cloud a locale tramite ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2f11c-400">Problem 2: Cloud to on-premises connection over ExpressRoute</span></span>
  
<span data-ttu-id="2f11c-401">Il diagramma seguente illustra il percorso di rete asimmetrico intrapreso quando la configurazione di rete non fornisce NAT per le richieste in ingresso dal cloud Microsoft tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-401">The following diagram illustrates the asymmetric network path taken when your network configuration doesn't provide NAT for inbound requests from the Microsoft cloud over ExpressRoute.</span></span>
  
1. <span data-ttu-id="2f11c-402">La richiesta in ingresso da Office 365 recupera l'indirizzo IP da DNS e invia la richiesta alla rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-402">The inbound request from Office 365 retrieves the IP address from DNS and sends the request to your perimeter network.</span></span>

2. <span data-ttu-id="2f11c-403">In questa configurazione difettosa non è configurato o disponibile alcun NAT di origine nella rete perimetrale in cui viene inviato il traffico, con conseguente utilizzo dell'indirizzo IP di origine effettivo come destinazione di ritorno.</span><span class="sxs-lookup"><span data-stu-id="2f11c-403">In this faulty configuration, there is no Source NAT configured or available at the perimeter network where the traffic is sent resulting in the actual source IP address being used as the return destination.</span></span>

  - <span data-ttu-id="2f11c-404">Il computer della rete instrada il traffico di ritorno Office 365 attraverso qualsiasi connessione di rete ExpressRoute disponibile.</span><span class="sxs-lookup"><span data-stu-id="2f11c-404">The computer on your network routes the return traffic to Office 365 through any available ExpressRoute network connection.</span></span>

  - <span data-ttu-id="2f11c-405">Il risultato è una connessione asimmetrica Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-405">The result is an Asymmetric connection to Office 365.</span></span>

![ExpressRoute Asymetric routing problem 2](../media/f6fd155b-bbb7-472a-846e-039a99f09913.png)
  
##### <a name="solution-2-source-nat"></a><span data-ttu-id="2f11c-407">Soluzione 2: NAT di origine</span><span class="sxs-lookup"><span data-stu-id="2f11c-407">Solution 2: Source NAT</span></span>
  
<span data-ttu-id="2f11c-408">La semplice aggiunta di un NAT di origine alla richiesta in ingresso risolve questa rete non configurata correttamente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-408">Simply adding a source NAT to the inbound request resolves this misconfigured network.</span></span> <span data-ttu-id="2f11c-409">In questo diagramma:</span><span class="sxs-lookup"><span data-stu-id="2f11c-409">In this diagram:</span></span>
  
1. <span data-ttu-id="2f11c-410">La richiesta in arrivo continua a entrare attraverso la rete perimetrale del data center di New York.</span><span class="sxs-lookup"><span data-stu-id="2f11c-410">The incoming request continues to enter through the New York data center's perimeter network.</span></span> <span data-ttu-id="2f11c-411">Questa volta Nat di origine è disponibile.</span><span class="sxs-lookup"><span data-stu-id="2f11c-411">This time Source NAT is available.</span></span>

2. <span data-ttu-id="2f11c-412">La risposta dal server instrada di nuovo verso l'IP associato al NAT di origine anziché all'indirizzo IP originale, determinando la restituzione della risposta lungo lo stesso percorso di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-412">The response from the server routes back toward the IP associated with the Source NAT instead of the original IP address, resulting in the response returning along the same network path.</span></span>

![Soluzione di routing Asymetric ExpressRoute 3](../media/a5d2b90d-a3ec-4047-afbf-6e6e99f376a7.png)
  
### <a name="paper-verify-that-the-network-design-has-path-symmetry"></a><span data-ttu-id="2f11c-414">Verificare che la progettazione della rete abbia la simmetria del percorso</span><span class="sxs-lookup"><span data-stu-id="2f11c-414">Paper verify that the network design has path symmetry</span></span>

<span data-ttu-id="2f11c-415">A questo punto, è necessario verificare sulla carta che il piano di implementazione offre la simmetria della route per i diversi scenari in cui verrà utilizzato Office 365.</span><span class="sxs-lookup"><span data-stu-id="2f11c-415">At this point, you need to verify on paper that your implementation plan offers route symmetry for the different scenarios in which you'll be using Office 365.</span></span> <span data-ttu-id="2f11c-416">Identificherai la route di rete specifica che dovrebbe essere intrapresa quando una persona usa funzionalità diverse del servizio.</span><span class="sxs-lookup"><span data-stu-id="2f11c-416">You'll identify the specific network route that is expected to be taken when a person uses different features of the service.</span></span> <span data-ttu-id="2f11c-417">Dalla rete locale e dal routing WAN, ai dispositivi perimetrali, al percorso di connettività; ExpressRoute o Internet e alla connessione all'endpoint online.</span><span class="sxs-lookup"><span data-stu-id="2f11c-417">From the on-premises network and WAN routing, to the perimeter devices, to the connectivity path; ExpressRoute or the internet, and on to the connection to the online endpoint.</span></span>
  
<span data-ttu-id="2f11c-418">È necessario eseguire questa operazione per tutti i servizi Office 365 di rete precedentemente identificati come servizi che verranno adottati dall'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-418">You'll need to do this for all of the Office 365 network services that were previously identified as services that your organization will adopt.</span></span>
  
<span data-ttu-id="2f11c-419">Aiuta a fare questo documento a piedi attraverso i percorsi con una seconda persona.</span><span class="sxs-lookup"><span data-stu-id="2f11c-419">It helps to do this paper walk through of routes with a second person.</span></span> <span data-ttu-id="2f11c-420">Spiegare loro da dove si prevede che ogni hop di rete otterrà la route successiva e assicurarsi di avere familiarità con i percorsi di routing.</span><span class="sxs-lookup"><span data-stu-id="2f11c-420">Explain to them where each network hop is expected to get its next route from and ensure that you're familiar with the routing paths.</span></span> <span data-ttu-id="2f11c-421">Tenere presente che ExpressRoute fornirà sempre una route con ambito maggiore agli indirizzi IP del server Microsoft, con un costo di route inferiore rispetto a una route predefinita internet.</span><span class="sxs-lookup"><span data-stu-id="2f11c-421">Remember that ExpressRoute will always provide a more scoped route to Microsoft server IP addresses giving it lower route cost than an Internet default route.</span></span>
  
### <a name="design-client-connectivity-configuration"></a><span data-ttu-id="2f11c-422">Progettare la configurazione della connettività client</span><span class="sxs-lookup"><span data-stu-id="2f11c-422">Design Client Connectivity Configuration</span></span>
<span data-ttu-id="2f11c-423"><a name="asymmetric"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-423"><a name="asymmetric"> </a></span></span>

![Uso di file PAC con ExpressRoute](../media/7cfa6482-dbae-416a-ae6f-a45e5f4de23b.png)
  
<span data-ttu-id="2f11c-425">Se si utilizza un server proxy per il traffico associato a Internet, è necessario modificare i file PAC o di configurazione client per assicurarsi che i computer client della rete siano configurati correttamente per inviare il traffico ExpressRoute desiderato Office 365 senza transitare il server proxy e che il traffico rimanente, incluso un traffico Office 365, venga inviato al proxy pertinente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-425">If you're using a proxy server for internet bound traffic then you need to adjust any PAC or client configuration files to ensure client computers on your network are correctly configured to send the ExpressRoute traffic you desire to Office 365 without transiting your proxy server, and the remaining traffic, including some Office 365 traffic, is sent to the relevant proxy.</span></span> <span data-ttu-id="2f11c-426">Leggi la nostra guida [sulla gestione Office 365 endpoint,](./managing-office-365-endpoints.md) ad esempio i file PAC.</span><span class="sxs-lookup"><span data-stu-id="2f11c-426">Read our guide on [managing Office 365 endpoints](./managing-office-365-endpoints.md) for example PAC files.</span></span>
  
> [!NOTE]
> <span data-ttu-id="2f11c-427">Gli endpoint cambiano frequentemente, con la frequenza settimanale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-427">The endpoints change frequently, as often as weekly.</span></span> <span data-ttu-id="2f11c-428">È consigliabile apportare modifiche solo in base ai servizi e alle funzionalità adottati dall'organizzazione per ridurre il numero di modifiche da apportare per rimanere al corrente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-428">You should only make changes based on the services and features your organization has adopted to reduce the number of changes you'll need to make to stay current.</span></span> <span data-ttu-id="2f11c-429">Prestare particolare attenzione alla data di validità nel feed RSS **in** cui vengono annunciate le modifiche e viene mantenuto un record di tutte le modifiche precedenti, gli indirizzi IP annunciati potrebbero non essere annunciati o rimossi dall'annuncio pubblicitario fino a quando non viene raggiunta la data di validità.</span><span class="sxs-lookup"><span data-stu-id="2f11c-429">Pay close attention to the **Effective Date** in the RSS feed where the changes are announced and a record is kept of all past changes, IP addresses that are announced may not be advertised, or removed from advertisement, until the effective date is reached.</span></span>
  
## <a name="build-your-deployment-and-testing-procedures"></a><span data-ttu-id="2f11c-430">Creare le procedure di distribuzione e test</span><span class="sxs-lookup"><span data-stu-id="2f11c-430">Build your deployment and testing procedures</span></span>
<span data-ttu-id="2f11c-431"><a name="testing"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-431"><a name="testing"> </a></span></span>

<span data-ttu-id="2f11c-432">Il piano di implementazione deve includere sia la pianificazione di test che di rollback.</span><span class="sxs-lookup"><span data-stu-id="2f11c-432">Your implementation plan should include both testing and rollback planning.</span></span> <span data-ttu-id="2f11c-433">Se l'implementazione non funziona come previsto, il piano deve essere progettato per influire sul minor numero di persone prima che i problemi siano individuati.</span><span class="sxs-lookup"><span data-stu-id="2f11c-433">If your implementation isn't functioning as expected, the plan should be designed to affect the least number of people before problems are discovered.</span></span> <span data-ttu-id="2f11c-434">Di seguito sono riportati alcuni principi di alto livello che il piano deve prendere in considerazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-434">The following are some high level principles your plan should consider.</span></span>
  
1. <span data-ttu-id="2f11c-435">Impostare in fasi il segmento di rete e l'onboarding del servizio utente per ridurre al minimo l'interruzione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-435">Stage the network segment and user service onboarding to minimize disruption.</span></span>

2. <span data-ttu-id="2f11c-436">Pianificare i test delle route con traceroute e la connessione TCP da un host connesso a Internet separato.</span><span class="sxs-lookup"><span data-stu-id="2f11c-436">Plan for testing routes with traceroute and TCP connect from a separate internet connected host.</span></span>

3. <span data-ttu-id="2f11c-437">Preferibilmente, il test dei servizi in ingresso e in uscita deve essere eseguito in una rete di test isolata con un tenant di test Office 365 tenant.</span><span class="sxs-lookup"><span data-stu-id="2f11c-437">Preferably, testing of inbound and outbound services should be done on an isolated test network with a test Office 365 tenant.</span></span>

      - <span data-ttu-id="2f11c-438">In alternativa, i test possono essere eseguiti in una rete di produzione se il cliente non Office 365 o è in fase pilota.</span><span class="sxs-lookup"><span data-stu-id="2f11c-438">Alternatively, testing can be performed on a production network if the customer is not yet using Office 365 or is in pilot.</span></span>

      - <span data-ttu-id="2f11c-439">In alternativa, i test possono essere eseguiti durante un'interruzione di produzione che viene messa da parte solo per il test e il monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="2f11c-439">Alternatively, testing can be performed during a production outage that is set aside for test and monitoring only.</span></span>

      - <span data-ttu-id="2f11c-440">In alternativa, è possibile eseguire test controllando le route per ogni servizio in ogni nodo di router di livello 3.</span><span class="sxs-lookup"><span data-stu-id="2f11c-440">Alternatively, testing can be done by checking routes for each service on each layer 3 router node.</span></span> <span data-ttu-id="2f11c-441">Questo fall back deve essere utilizzato solo se non sono possibili altri test poiché la mancanza di test fisici introduce rischi.</span><span class="sxs-lookup"><span data-stu-id="2f11c-441">This fall back should only be used if no other testing is possible since a lack of physical testing introduces risk.</span></span>

### <a name="build-your-deployment-procedures"></a><span data-ttu-id="2f11c-442">Creare le procedure di distribuzione</span><span class="sxs-lookup"><span data-stu-id="2f11c-442">Build your deployment procedures</span></span>

<span data-ttu-id="2f11c-443">Le procedure di distribuzione devono essere distribuite a piccoli gruppi di persone in fasi per consentire il testing prima di distribuirlo a gruppi di persone più grandi.</span><span class="sxs-lookup"><span data-stu-id="2f11c-443">Your deployment procedures should roll out to small groups of people in stages to allow for testing before deploying to larger groups of people.</span></span> <span data-ttu-id="2f11c-444">Di seguito sono riportati diversi modi per eseguire in fasi la distribuzione di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-444">The following are several ways to stage the deployment of ExpressRoute.</span></span>
  
1. <span data-ttu-id="2f11c-445">Configurare ExpressRoute con il peering Microsoft e inoltrare gli annunci di route a un singolo host solo a scopo di test a fasi.</span><span class="sxs-lookup"><span data-stu-id="2f11c-445">Set up ExpressRoute with Microsoft peering and have the route advertisements forwarded to a single host only for staged testing purposes.</span></span>

2. <span data-ttu-id="2f11c-446">Annunciare le route alla rete ExpressRoute a un singolo segmento di rete in un primo momento ed espandere gli annunci di route in base al segmento di rete o all'area geografica.</span><span class="sxs-lookup"><span data-stu-id="2f11c-446">Advertise routes to the ExpressRoute network to a single network segment at first and expand route advertisements by network segment or region.</span></span>

3. <span data-ttu-id="2f11c-447">Se si distribuisce Office 365 per la prima volta, usare la distribuzione di rete ExpressRoute come progetto pilota per un numero limitato di persone.</span><span class="sxs-lookup"><span data-stu-id="2f11c-447">If deploying Office 365 for the first time, use the ExpressRoute network deployment as a pilot for a small number of people.</span></span>

4. <span data-ttu-id="2f11c-448">Se si usano server proxy, è possibile configurare in alternativa un file PAC di test per indirizzare un numero limitato di persone a ExpressRoute con test e feedback prima di aggiungerlo.</span><span class="sxs-lookup"><span data-stu-id="2f11c-448">If using proxy servers, you can alternatively configure a test PAC file to direct a small number of people to ExpressRoute with testing and feedback before adding more.</span></span>

<span data-ttu-id="2f11c-449">Il piano di implementazione deve elencare tutte le procedure di distribuzione da eseguire o i comandi da utilizzare per distribuire la configurazione di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-449">Your implementation plan should list each of the deployment procedures that must be taken or commands that need to be used to deploy the networking configuration.</span></span> <span data-ttu-id="2f11c-450">Quando arriva il tempo di interruzione della rete, tutte le modifiche apportate devono essere del piano di distribuzione scritto scritto in anticipo e esaminato peer.</span><span class="sxs-lookup"><span data-stu-id="2f11c-450">When the network outage time arrives all of the changes being made should be from the written deployment plan which was written in advance and peer reviewed.</span></span> <span data-ttu-id="2f11c-451">Vedi le nostre indicazioni sulla configurazione tecnica di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-451">See our guidance on the technical configuration of ExpressRoute.</span></span>
  
- <span data-ttu-id="2f11c-452">Aggiornamento dei record TXT SPF se sono stati modificati gli indirizzi IP per i server locali che continueranno a inviare posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2f11c-452">Updating your SPF TXT records if you've changed IP addresses for any on-premises servers that will continue to send email.</span></span>

- <span data-ttu-id="2f11c-453">Aggiornamento di eventuali voci DNS per i server locali se sono stati modificati indirizzi IP per supportare una nuova configurazione NAT.</span><span class="sxs-lookup"><span data-stu-id="2f11c-453">Updating any DNS entries for on-premises servers if you've changed IP addresses to accommodate a new NAT configuration.</span></span>

- <span data-ttu-id="2f11c-454">Assicurati di aver sottoscritto il feed RSS per le notifiche Office 365 endpoint per mantenere eventuali configurazioni di routing o proxy.</span><span class="sxs-lookup"><span data-stu-id="2f11c-454">Ensure you've subscribed to the RSS feed for Office 365 endpoint notifications to maintain any routing or proxy configurations.</span></span>

<span data-ttu-id="2f11c-455">Al termine della distribuzione di ExpressRoute, è necessario eseguire le procedure del piano di test.</span><span class="sxs-lookup"><span data-stu-id="2f11c-455">After your ExpressRoute deployment is complete the procedures in the test plan should be executed.</span></span> <span data-ttu-id="2f11c-456">I risultati di ogni procedura devono essere registrati.</span><span class="sxs-lookup"><span data-stu-id="2f11c-456">Results for each procedure should be logged.</span></span> <span data-ttu-id="2f11c-457">È necessario includere le procedure per il rollback nell'ambiente di produzione originale nel caso in cui i risultati del piano di test indichino che l'implementazione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="2f11c-457">You must include procedures for rolling back to the original production environment in the event the test plan results indicate the implementation was not successful.</span></span>
  
### <a name="build-your-test-procedures"></a><span data-ttu-id="2f11c-458">Creare le procedure di test</span><span class="sxs-lookup"><span data-stu-id="2f11c-458">Build your test procedures</span></span>

<span data-ttu-id="2f11c-459">Le procedure di test devono includere i test per ogni servizio di rete in ingresso e in uscita per Office 365 che usano ExpressRoute e quelli che non lo saranno.</span><span class="sxs-lookup"><span data-stu-id="2f11c-459">Your testing procedures should include tests for each outbound and inbound network service for Office 365 both that will be using ExpressRoute and ones that will not.</span></span> <span data-ttu-id="2f11c-460">Le procedure devono includere test da ogni percorso di rete univoco, inclusi gli utenti che non sono locali nella rete LAN aziendale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-460">The procedures should include testing from each unique network location including users who are not on-premises in the corporate LAN.</span></span>
  
<span data-ttu-id="2f11c-461">Di seguito sono riportati alcuni esempi di attività di test.</span><span class="sxs-lookup"><span data-stu-id="2f11c-461">Some examples of test activities include the following.</span></span>
  
1. <span data-ttu-id="2f11c-462">Eseguire il ping dal router locale al router dell'operatore di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-462">Ping from your on-premises router to your network operator router.</span></span>

2. <span data-ttu-id="2f11c-463">Convalidare che oltre 500 Office 365 indirizzi IP e CRM Online siano ricevuti dal router locale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-463">Validate the 500+ Office 365 and CRM Online IP address advertisements are received by your on-premises router.</span></span>

3. <span data-ttu-id="2f11c-464">Verificare che il NAT in ingresso e in uscita sia in funzione tra ExpressRoute e la rete interna.</span><span class="sxs-lookup"><span data-stu-id="2f11c-464">Validate your inbound and outbound NAT is operating between ExpressRoute and the internal network.</span></span>

4. <span data-ttu-id="2f11c-465">Verificare che le route verso NAT vengano annunciate dal router.</span><span class="sxs-lookup"><span data-stu-id="2f11c-465">Validate that routes to your NAT are being advertised from your router.</span></span>

5. <span data-ttu-id="2f11c-466">Verificare che ExpressRoute abbia accettato i prefissi annunciati.</span><span class="sxs-lookup"><span data-stu-id="2f11c-466">Validate that ExpressRoute has accepted your advertised prefixes.</span></span>

      - <span data-ttu-id="2f11c-467">Utilizzare il cmdlet seguente per verificare gli annunci di peering:</span><span class="sxs-lookup"><span data-stu-id="2f11c-467">Use the following cmdlet to verify peering advertisements:</span></span>

      ```PowerShell
      Get-AzureRmExpressRouteCircuitRouteTable -DevicePath Primary -ExpressRouteCircuitName TestER -ResourceGroupName RG -PeeringType MicrosoftPeering
      ```

6. <span data-ttu-id="2f11c-468">Verificare che l'intervallo IP NAT pubblico non venga annunciato a Microsoft tramite qualsiasi altro circuito di rete ExpressRoute o Internet pubblico, a meno che non si tratta di un sottoinsieme specifico di un intervallo più grande come nell'esempio precedente.</span><span class="sxs-lookup"><span data-stu-id="2f11c-468">Validate your public NAT IP range is not advertised to Microsoft through any other ExpressRoute or public Internet network circuit unless it is a specific subset of a larger range as in the previous example.</span></span>

7. <span data-ttu-id="2f11c-469">I circuiti ExpressRoute sono associati e verificano che entrambe le sessioni BGP siano in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-469">ExpressRoute circuits are paired, validate that both BGP sessions are running.</span></span>

8. <span data-ttu-id="2f11c-470">Configurare un singolo host all'interno del NAT e usare ping, tracert e tcpping per testare la connettività tra il nuovo circuito e l'host outlook.office365.com.</span><span class="sxs-lookup"><span data-stu-id="2f11c-470">Set up a single host on the inside of your NAT and use ping, tracert, and tcpping to test connectivity across the new circuit to the host outlook.office365.com.</span></span> <span data-ttu-id="2f11c-471">In alternativa, è possibile utilizzare uno strumento come Wireshark o Microsoft Network Monitor 3.4 su una porta con mirroring a MSEE per verificare di essere in grado di connettersi all'indirizzo IP associato a outlook.office365.com.</span><span class="sxs-lookup"><span data-stu-id="2f11c-471">Alternatively, you could use a tool such as Wireshark or Microsoft Network Monitor 3.4 on a mirrored port to the MSEE to validate you're able to connect to the IP address associated with outlook.office365.com.</span></span>

9. <span data-ttu-id="2f11c-472">Testare la funzionalità a livello di applicazione Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="2f11c-472">Test application level functionality for Exchange Online.</span></span>

  - <span data-ttu-id="2f11c-473">Test Outlook è in grado di connettersi a Exchange Online e inviare/ricevere posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2f11c-473">Test Outlook is able to connect to Exchange Online and send/receive email.</span></span>

  - <span data-ttu-id="2f11c-474">Test Outlook è in grado di usare la modalità online.</span><span class="sxs-lookup"><span data-stu-id="2f11c-474">Test Outlook is able to use online-mode.</span></span>

  - <span data-ttu-id="2f11c-475">Testare la connettività dello smartphone e la funzionalità di invio/ricezione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-475">Test smartphone connectivity and send/receive capability.</span></span>

10. <span data-ttu-id="2f11c-476">Testare la funzionalità a livello di applicazione per SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="2f11c-476">Test application level functionality for SharePoint Online</span></span>

  - <span data-ttu-id="2f11c-477">Testare OneDrive for Business client di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f11c-477">Test OneDrive for Business sync client.</span></span>

  - <span data-ttu-id="2f11c-478">Testare SharePoint Web Access online.</span><span class="sxs-lookup"><span data-stu-id="2f11c-478">Test SharePoint Online web access.</span></span>

11. <span data-ttu-id="2f11c-479">Testare la funzionalità a livello di applicazione Skype for Business scenari di chiamata:</span><span class="sxs-lookup"><span data-stu-id="2f11c-479">Test application level functionality for Skype for Business calling scenarios:</span></span>

  - <span data-ttu-id="2f11c-480">Partecipare alla conferenza telefonica come utente autenticato [invito avviato dall'utente finale].</span><span class="sxs-lookup"><span data-stu-id="2f11c-480">Join to conference call as authenticated user [invite initiated by end user].</span></span>

  - <span data-ttu-id="2f11c-481">Invitare l'utente alla conferenza telefonica [invito inviato da MCU].</span><span class="sxs-lookup"><span data-stu-id="2f11c-481">Invite user to conference call [invite sent from MCU].</span></span>

  - <span data-ttu-id="2f11c-482">Partecipare alla conferenza come utente anonimo utilizzando l Skype for Business app web.</span><span class="sxs-lookup"><span data-stu-id="2f11c-482">Join conference as anonymous user using the Skype for Business web application.</span></span>

  - <span data-ttu-id="2f11c-483">Partecipa alla chiamata dalla connessione pc cablata, dal telefono IP e dal dispositivo mobile.</span><span class="sxs-lookup"><span data-stu-id="2f11c-483">Join call from your wired PC connection, IP phone, and mobile device.</span></span>

  - <span data-ttu-id="2f11c-484">Call to federated user o Call to PSTN Validation: call is completed, call quality is acceptable, connection time is acceptable.</span><span class="sxs-lookup"><span data-stu-id="2f11c-484">Call to federated user o Call to PSTN Validation: call is completed, call quality is acceptable, connection time is acceptable.</span></span>

  - <span data-ttu-id="2f11c-485">Verificare che lo stato di presenza dei contatti sia aggiornato sia per i membri del tenant che per gli utenti federati.</span><span class="sxs-lookup"><span data-stu-id="2f11c-485">Verify presence status for contacts is updated for both members of the tenant and federated users.</span></span>

### <a name="common-problems"></a><span data-ttu-id="2f11c-486">Problemi comuni</span><span class="sxs-lookup"><span data-stu-id="2f11c-486">Common problems</span></span>

<span data-ttu-id="2f11c-487">Il routing asimmetrico è il problema di implementazione più comune.</span><span class="sxs-lookup"><span data-stu-id="2f11c-487">Asymmetric routing is the most common implementation problem.</span></span> <span data-ttu-id="2f11c-488">Ecco alcune fonti comuni da cercare:</span><span class="sxs-lookup"><span data-stu-id="2f11c-488">Here are some common sources to look for:</span></span>
  
- <span data-ttu-id="2f11c-489">Utilizzo di una topologia di routing di rete aperta o flat senza NAT di origine sul posto.</span><span class="sxs-lookup"><span data-stu-id="2f11c-489">Using an open or flat network routing topology without source NAT in place.</span></span>

- <span data-ttu-id="2f11c-490">Non si usa SNAT per instradare i servizi in ingresso tramite le connessioni Internet ed ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-490">Not using SNAT to route to inbound services through both the internet and ExpressRoute connections.</span></span>

- <span data-ttu-id="2f11c-491">Non testare i servizi in ingresso in ExpressRoute in una rete di test prima della distribuzione su larga base.</span><span class="sxs-lookup"><span data-stu-id="2f11c-491">Not testing inbound services on ExpressRoute on a test network prior to deploying broadly.</span></span>

## <a name="deploying-expressroute-connectivity-through-your-network"></a><span data-ttu-id="2f11c-492">Distribuzione della connettività ExpressRoute tramite la rete</span><span class="sxs-lookup"><span data-stu-id="2f11c-492">Deploying ExpressRoute connectivity through your network</span></span>
<span data-ttu-id="2f11c-493"><a name="testing"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-493"><a name="testing"> </a></span></span>

<span data-ttu-id="2f11c-494">Implementare gradualmente la distribuzione in un segmento della rete alla volta, stendendo progressivamente la connettività a diverse parti della rete con un piano di rollback per ogni nuovo segmento di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-494">Stage your deployment to one segment of the network at a time, progressively rolling out the connectivity to different parts of the network with a plan to roll back for each new network segment.</span></span> <span data-ttu-id="2f11c-495">Se la distribuzione è allineata a una distribuzione Office 365, distribuire prima Office 365 utenti pilota ed estendersi da lì.</span><span class="sxs-lookup"><span data-stu-id="2f11c-495">If your deployment is aligned with an Office 365 deployment, deploy to your Office 365 pilot users first and extend from there.</span></span>
  
<span data-ttu-id="2f11c-496">Prima per il test e quindi per la produzione:</span><span class="sxs-lookup"><span data-stu-id="2f11c-496">First for your test and then for production:</span></span>
  
- <span data-ttu-id="2f11c-497">Eseguire i passaggi di distribuzione per abilitare ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-497">Run the deployment steps to enable ExpressRoute.</span></span>

- <span data-ttu-id="2f11c-498">Testare la visualizzazione delle route di rete come previsto.</span><span class="sxs-lookup"><span data-stu-id="2f11c-498">Test your seeing the network routes are as expected.</span></span>

- <span data-ttu-id="2f11c-499">Eseguire test su ogni servizio in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="2f11c-499">Perform testing on each inbound and outbound service.</span></span>

- <span data-ttu-id="2f11c-500">Eseguire il rollback in caso di problemi.</span><span class="sxs-lookup"><span data-stu-id="2f11c-500">Rollback if you discover any issues.</span></span>

### <a name="set-up-a-test-connection-to-expressroute-with-a-test-network-segment"></a><span data-ttu-id="2f11c-501">Configurare una connessione di test a ExpressRoute con un segmento di rete di test</span><span class="sxs-lookup"><span data-stu-id="2f11c-501">Set up a test connection to ExpressRoute with a test network segment</span></span>

<span data-ttu-id="2f11c-502">Ora che hai completato il piano su carta, è il momento di testare su piccola scala.</span><span class="sxs-lookup"><span data-stu-id="2f11c-502">Now that you have the completed plan on paper it is time to test at a small scale.</span></span> <span data-ttu-id="2f11c-503">In questo test verrà stabilita una singola connessione ExpressRoute con Peering Microsoft a una subnet di prova nella rete locale.</span><span class="sxs-lookup"><span data-stu-id="2f11c-503">In this test you will establish a single ExpressRoute connection with Microsoft Peering to a test subnet on your on-premises network.</span></span> <span data-ttu-id="2f11c-504">È possibile configurare un [tenant di Office 365](https://go.microsoft.com/fwlink/p/?LinkID=403802) di valutazione con connettività da e verso la subnet di test e includere tutti i servizi in uscita e in ingresso che verranno utilizzato in produzione nella subnet di test.</span><span class="sxs-lookup"><span data-stu-id="2f11c-504">You can configure a [trial Office 365 tenant](https://go.microsoft.com/fwlink/p/?LinkID=403802) with connectivity to and from the test subnet and include all outbound and inbound services that you will be using in production in the test subnet.</span></span> <span data-ttu-id="2f11c-505">Configurare DNS per il segmento di rete di prova e stabilire tutti i servizi in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="2f11c-505">Set up DNS for the test network segment and establish all inbound and outbound services.</span></span> <span data-ttu-id="2f11c-506">Eseguire il piano di test e assicurarsi di avere familiarità con il routing per ogni servizio e la propagazione della route.</span><span class="sxs-lookup"><span data-stu-id="2f11c-506">Execute your test plan and ensure that you are familiar with the routing for each service and the route propagation.</span></span>
  
### <a name="execute-the-deployment-and-test-plans"></a><span data-ttu-id="2f11c-507">Eseguire i piani di distribuzione e test</span><span class="sxs-lookup"><span data-stu-id="2f11c-507">Execute the deployment and test plans</span></span>

<span data-ttu-id="2f11c-508">Dopo aver completato gli elementi descritti in precedenza, controllare le aree completate e verificare che tu e il team li abbia esaminati prima di eseguire i piani di distribuzione e test.</span><span class="sxs-lookup"><span data-stu-id="2f11c-508">As you complete the items described above, check off the areas you've completed and ensure you and your team have reviewed them before executing your deployment and testing plans.</span></span>
  
- <span data-ttu-id="2f11c-509">Elenco dei servizi in uscita e in ingresso coinvolti nella modifica della rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-509">List of outbound and inbound services that are involved in the network change.</span></span>

- <span data-ttu-id="2f11c-510">Diagramma dell'architettura di rete globale che mostra sia l'uscita Internet che le posizioni di meet-me ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2f11c-510">Global network architecture diagram showing both internet egress and ExpressRoute meet-me locations.</span></span>

- <span data-ttu-id="2f11c-511">Diagramma di routing di rete che mostra i diversi percorsi di rete utilizzati per ogni servizio distribuito.</span><span class="sxs-lookup"><span data-stu-id="2f11c-511">Network routing diagram demonstrating the different network paths used for each service deployed.</span></span>

- <span data-ttu-id="2f11c-512">Un piano di distribuzione con la procedura per implementare le modifiche e il rollback, se necessario.</span><span class="sxs-lookup"><span data-stu-id="2f11c-512">A deployment plan with steps to implement the changes and rollback if needed.</span></span>

- <span data-ttu-id="2f11c-513">Un piano di test per testare ogni Office 365 e il servizio di rete.</span><span class="sxs-lookup"><span data-stu-id="2f11c-513">A test plan for testing each Office 365 and network service.</span></span>

- <span data-ttu-id="2f11c-514">Convalida cartacea completata delle route di produzione per i servizi in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="2f11c-514">Completed paper validation of production routes for inbound and outbound services.</span></span>

- <span data-ttu-id="2f11c-515">Test completato in un segmento di rete di test, incluso il test della disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2f11c-515">A completed test across a test network segment including availability testing.</span></span>

<span data-ttu-id="2f11c-516">Scegliere una finestra di interruzione sufficientemente lunga da poter essere eseguita attraverso l'intero piano di distribuzione e il piano di test, ha un certo tempo disponibile per la risoluzione dei problemi e il tempo per il rollback, se necessario.</span><span class="sxs-lookup"><span data-stu-id="2f11c-516">Choose an outage window that is long enough to run through the entire deployment plan and the test plan, has some time available for troubleshooting and time for rolling back if required.</span></span>
  
> [!CAUTION]
> <span data-ttu-id="2f11c-517">A causa della natura complessa del routing sia su Internet che su ExpressRoute, è consigliabile aggiungere ulteriore tempo del buffer a questa finestra per gestire la risoluzione dei problemi relativi al routing complesso.</span><span class="sxs-lookup"><span data-stu-id="2f11c-517">Due to the complex nature of routing over both the internet and ExpressRoute, it is recommended that additional buffer time is added to this window to handle troubleshooting complex routing.</span></span>
  
### <a name="configure-qos-for-skype-for-business-online"></a><span data-ttu-id="2f11c-518">Configurare QoS per Skype for Business Online</span><span class="sxs-lookup"><span data-stu-id="2f11c-518">Configure QoS for Skype for Business Online</span></span>

<span data-ttu-id="2f11c-519">QoS è necessario per ottenere vantaggi vocali e riunioni per Skype for Business Online.</span><span class="sxs-lookup"><span data-stu-id="2f11c-519">QoS is necessary to obtain voice and meeting benefits for Skype for Business Online.</span></span> <span data-ttu-id="2f11c-520">È possibile configurare QoS dopo aver garantito che la connessione di rete ExpressRoute non blocca alcun altro accesso Office 365 servizio.</span><span class="sxs-lookup"><span data-stu-id="2f11c-520">You can configure QoS after you have ensured that the ExpressRoute network connection does not block any of your other Office 365 service access.</span></span> <span data-ttu-id="2f11c-521">La configurazione per QoS è descritta [nell'articolo ExpressRoute e QoS in Skype for Business Online.](https://support.office.com/article/ExpressRoute-and-QoS-in-Skype-for-Business-Online-20c654da-30ee-4e4f-a764-8b7d8844431d)</span><span class="sxs-lookup"><span data-stu-id="2f11c-521">Configuration for QoS is described in the article [ExpressRoute and QoS in Skype for Business Online](https://support.office.com/article/ExpressRoute-and-QoS-in-Skype-for-Business-Online-20c654da-30ee-4e4f-a764-8b7d8844431d) .</span></span>
  
## <a name="troubleshooting-your-implementation"></a><span data-ttu-id="2f11c-522">Risoluzione dei problemi relativi all'implementazione</span><span class="sxs-lookup"><span data-stu-id="2f11c-522">Troubleshooting your implementation</span></span>
<span data-ttu-id="2f11c-523"><a name="troubleshooting"> </a></span><span class="sxs-lookup"><span data-stu-id="2f11c-523"><a name="troubleshooting"> </a></span></span>

<span data-ttu-id="2f11c-524">Il primo punto da esaminare è la procedura illustrata in questa guida all'implementazione, mancata nel piano di implementazione?</span><span class="sxs-lookup"><span data-stu-id="2f11c-524">The first place to look is at the steps in this implementation guide, were any missed in your implementation plan?</span></span> <span data-ttu-id="2f11c-525">Tornare indietro ed eseguire ulteriori test di rete di piccole dimensioni, se possibile, per replicare l'errore ed eseguirne il debug.</span><span class="sxs-lookup"><span data-stu-id="2f11c-525">Go back and run further small network testing if possible to replicate the error and debug it there.</span></span>
  
<span data-ttu-id="2f11c-526">Identificare i servizi in ingresso o in uscita non riusciti durante il test.</span><span class="sxs-lookup"><span data-stu-id="2f11c-526">Identify which inbound or outbound services failed during testing.</span></span> <span data-ttu-id="2f11c-527">Ottenere in modo specifico gli indirizzi IP e le subnet per ognuno dei servizi che hanno avuto esito negativo.</span><span class="sxs-lookup"><span data-stu-id="2f11c-527">Get specifically the IP addresses and subnets for each of the services which failed.</span></span> <span data-ttu-id="2f11c-528">Andare avanti e illustrare il diagramma della topologia di rete su carta e convalidare il routing.</span><span class="sxs-lookup"><span data-stu-id="2f11c-528">Go ahead and walk the network topology diagram on paper and validate the routing.</span></span> <span data-ttu-id="2f11c-529">Verificare in modo specifico la posizione in cui viene annunciato il routing ExpressRoute, testare il routing durante l'interruzione, se possibile, con le tracce.</span><span class="sxs-lookup"><span data-stu-id="2f11c-529">Validate specifically where the ExpressRoute routing is advertised to, Test that routing during the outage if possible with traces.</span></span>
  
<span data-ttu-id="2f11c-530">Eseguire PSPing con una traccia di rete per ogni endpoint del cliente e valutare gli indirizzi IP di origine e di destinazione per verificare che siano come previsto.</span><span class="sxs-lookup"><span data-stu-id="2f11c-530">Run PSPing with a network trace to each customer endpoint and evaluate source and destination IP addresses to validate that they are as expected.</span></span> <span data-ttu-id="2f11c-531">Eseguire telnet in qualsiasi host di posta esposto sulla porta 25 e verificare che SNAT nasconde l'indirizzo IP di origine originale, se previsto.</span><span class="sxs-lookup"><span data-stu-id="2f11c-531">Run telnet to any mail host that you expose on port 25 and verify that SNAT is hiding the original source IP address if this is expected.</span></span>
  
<span data-ttu-id="2f11c-532">Tenere presente che durante la distribuzione di Office 365 con una connessione ExpressRoute è necessario verificare che sia la configurazione di rete per ExpressRoute sia progettata in modo ottimale e che siano stati ottimizzati anche gli altri componenti della rete, ad esempio i computer client.</span><span class="sxs-lookup"><span data-stu-id="2f11c-532">Keep in mind that while deploying Office 365 with an ExpressRoute connection you'll need to ensure both the network configuration for ExpressRoute is optimally designed and you've also optimized the other components on your network such as client computers.</span></span> <span data-ttu-id="2f11c-533">Oltre a utilizzare questa guida alla pianificazione per risolvere i problemi relativi ai passaggi che potrebbero non essere stati evasi, è stato scritto anche un piano di risoluzione dei problemi di [prestazioni per Office 365](https://support.office.com/article/Performance-troubleshooting-plan-for-Office-365-e241e5d9-b1d8-4f1d-a5c8-4106b7325f8c) .</span><span class="sxs-lookup"><span data-stu-id="2f11c-533">In addition to using this planning guide to troubleshoot the steps you may have missed, we also have written a [Performance troubleshooting plan for Office 365](https://support.office.com/article/Performance-troubleshooting-plan-for-Office-365-e241e5d9-b1d8-4f1d-a5c8-4106b7325f8c) .</span></span>
  
<span data-ttu-id="2f11c-534">Ecco un collegamento breve per tornare alla pagina: [https://aka.ms/implementexpressroute365]()</span><span class="sxs-lookup"><span data-stu-id="2f11c-534">Here's a short link you can use to come back: [https://aka.ms/implementexpressroute365]()</span></span>
  
## <a name="related-topics"></a><span data-ttu-id="2f11c-535">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="2f11c-535">Related Topics</span></span>

[<span data-ttu-id="2f11c-536">Valutazione della connettività di rete di Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-536">Assessing Office 365 network connectivity</span></span>](assessing-network-connectivity.md)
  
[<span data-ttu-id="2f11c-537">Azure ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-537">Azure ExpressRoute for Office 365</span></span>](azure-expressroute.md)
  
[<span data-ttu-id="2f11c-538">Gestione di ExpressRoute per la connettività di Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-538">Managing ExpressRoute for Office 365 connectivity</span></span>](managing-expressroute-for-connectivity.md)
  
[<span data-ttu-id="2f11c-539">Routing con ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-539">Routing with ExpressRoute for Office 365</span></span>](routing-with-expressroute.md)
  
[<span data-ttu-id="2f11c-540">Pianificazione della rete con ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-540">Network planning with ExpressRoute for Office 365</span></span>](network-planning-with-expressroute.md)
  
[<span data-ttu-id="2f11c-541">Uso di community BGP in ExpressRoute per Office 365 scenari</span><span class="sxs-lookup"><span data-stu-id="2f11c-541">Using BGP communities in ExpressRoute for Office 365 scenarios</span></span>](bgp-communities-in-expressroute.md)
  
[<span data-ttu-id="2f11c-542">Qualità multimediale e prestazioni della connettività di rete in Skype for Business Online</span><span class="sxs-lookup"><span data-stu-id="2f11c-542">Media Quality and Network Connectivity Performance in Skype for Business Online</span></span>](https://support.office.com/article/5fe3e01b-34cf-44e0-b897-b0b2a83f0917)
  
[<span data-ttu-id="2f11c-543">Ottimizzazione della rete per Skype for Business Online</span><span class="sxs-lookup"><span data-stu-id="2f11c-543">Optimizing your network for Skype for Business Online</span></span>](https://support.office.com/article/b363bdca-b00d-4150-96c3-ec7eab5a8a43)
  
[<span data-ttu-id="2f11c-544">ExpressRoute e QoS in Skype for Business Online</span><span class="sxs-lookup"><span data-stu-id="2f11c-544">ExpressRoute and QoS in Skype for Business Online</span></span>](https://support.office.com/article/20c654da-30ee-4e4f-a764-8b7d8844431d)
  
[<span data-ttu-id="2f11c-545">Flusso di chiamata con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2f11c-545">Call flow using ExpressRoute</span></span>](https://support.office.com/article/413acb29-ad83-4393-9402-51d88e7561ab)
  
[<span data-ttu-id="2f11c-546">Ottimizzazione delle prestazioni di Office 365 mediante l'uso della cronologia delle prestazioni e delle previsioni</span><span class="sxs-lookup"><span data-stu-id="2f11c-546">Office 365 performance tuning using baselines and performance history</span></span>](performance-tuning-using-baselines-and-history.md)
  
[<span data-ttu-id="2f11c-547">Piano di risoluzione dei problemi di prestazioni per Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-547">Performance troubleshooting plan for Office 365</span></span>](performance-troubleshooting-plan.md)
  
[<span data-ttu-id="2f11c-548">Intervalli di indirizzi IP e URL di Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-548">Office 365 URLs and IP address ranges</span></span>](https://support.office.com/article/8548a211-3fe7-47cb-abb1-355ea5aa88a2)
  
[<span data-ttu-id="2f11c-549">Ottimizzazione delle prestazioni e della rete di Office 365</span><span class="sxs-lookup"><span data-stu-id="2f11c-549">Office 365 network and performance tuning</span></span>](network-planning-and-performance.md)
