---
title: Rilevare e correggere le concessioni di consenso illecito
f1.keywords:
- NOCSH
ms.author: tracyp
author: MSFTTracyp
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- M365-security-compliance
localization_priority: Normal
search.appverid:
- MET150
description: Scopri come riconoscere e correggere l'attacco di concessione del consenso illecito in Microsoft 365.
ms.custom: seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: c0041c473f196dace893122c5c0543a06c1e6ff8
ms.sourcegitcommit: c70067b4ef9c6f8f04aca68c35bb5141857c4e4b
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/19/2021
ms.locfileid: "53029862"
---
# <a name="detect-and-remediate-illicit-consent-grants"></a><span data-ttu-id="b8d8c-103">Rilevare e correggere le concessioni di consenso illecito</span><span class="sxs-lookup"><span data-stu-id="b8d8c-103">Detect and Remediate Illicit Consent Grants</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

<span data-ttu-id="b8d8c-104">**Si applica a**</span><span class="sxs-lookup"><span data-stu-id="b8d8c-104">**Applies to**</span></span>
- [<span data-ttu-id="b8d8c-105">Microsoft Defender per Office 365 piano 1 e piano 2</span><span class="sxs-lookup"><span data-stu-id="b8d8c-105">Microsoft Defender for Office 365 plan 1 and plan 2</span></span>](defender-for-office-365.md)
- [<span data-ttu-id="b8d8c-106">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="b8d8c-106">Microsoft 365 Defender</span></span>](../defender/microsoft-365-defender.md)

<span data-ttu-id="b8d8c-107">**Riepilogo**  Scopri come riconoscere e correggere l'attacco di concessione del consenso illecito in Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-107">**Summary**  Learn how to recognize and remediate the illicit consent grants attack in Microsoft 365.</span></span>

## <a name="what-is-the-illicit-consent-grant-attack-in-microsoft-365"></a><span data-ttu-id="b8d8c-108">Qual è l'attacco di concessione del consenso illecito in Microsoft 365?</span><span class="sxs-lookup"><span data-stu-id="b8d8c-108">What is the illicit consent grant attack in Microsoft 365?</span></span>

<span data-ttu-id="b8d8c-109">In un attacco di concessione del consenso illecito, l'autore dell'attacco crea un'applicazione registrata in Azure che richiede l'accesso a dati quali informazioni di contatto, posta elettronica o documenti.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-109">In an illicit consent grant attack, the attacker creates an Azure-registered application that requests access to data such as contact information, email, or documents.</span></span> <span data-ttu-id="b8d8c-110">L'utente malintenzionato inganna quindi un utente finale a concedere il consenso all'applicazione per accedere ai propri dati tramite un attacco di phishing o iniettando codice illecito in un sito Web attendibile.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-110">The attacker then tricks an end user into granting that application consent to access their data either through a phishing attack, or by injecting illicit code into a trusted website.</span></span> <span data-ttu-id="b8d8c-111">Dopo che l'applicazione illecita ha ottenuto il consenso, ha accesso a livello di account ai dati senza la necessità di un account dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-111">After the illicit application has been granted consent, it has account-level access to data without the need for an organizational account.</span></span> <span data-ttu-id="b8d8c-112">I normali passaggi di correzione, come la reimpostazione delle password per gli account violati o la richiesta di Autenticazione a più fattori (MFA) sugli account, non sono efficaci contro questo tipo di attacco, poiché si tratta di applicazioni di terze parti e sono esterne all'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-112">Normal remediation steps, like resetting passwords for breached accounts or requiring Multi-Factor Authentication (MFA) on accounts, are not effective against this type of attack, since these are third-party applications and are external to the organization.</span></span>

<span data-ttu-id="b8d8c-113">Questi attacchi sfruttano un modello di interazione che presuppone che l'entità che chiama le informazioni sia l'automazione e non un essere umano.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-113">These attacks leverage an interaction model which presumes the entity that is calling the information is automation and not a human.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b8d8c-114">Si sospetta che si stiano verificando problemi con le concessioni di consenso illecite da un'app, in questo momento?</span><span class="sxs-lookup"><span data-stu-id="b8d8c-114">Do you suspect you're experiencing problems with illicit consent-grants from an app, right now?</span></span> <span data-ttu-id="b8d8c-115">Microsoft Cloud App Security (MCAS) include strumenti per rilevare, analizzare e correggere le app OAuth.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-115">Microsoft Cloud App Security (MCAS) has tools to detect, investigate, and remediate your OAuth apps.</span></span> <span data-ttu-id="b8d8c-116">In questo articolo di MCAS è presente un'esercitazione che illustra come analizzare [le app OAuth rischiose.](/cloud-app-security/investigate-risky-oauth)</span><span class="sxs-lookup"><span data-stu-id="b8d8c-116">This MCAS article has a tutorial that outlines how to go about [investigating risky OAuth apps](/cloud-app-security/investigate-risky-oauth).</span></span> <span data-ttu-id="b8d8c-117">Puoi anche impostare i [criteri delle app OAuth](/cloud-app-security/app-permission-policy) per analizzare le autorizzazioni richieste dall'app, quali utenti autorizzano queste app e approvare o vietare ampiamente queste richieste di autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-117">You can also set [OAuth app policies](/cloud-app-security/app-permission-policy) to investigate app-requested permissions, which users are authorizing these apps, and widely approve or ban these permissions requests.</span></span>

## <a name="what-does-an-illicit-consent-grant-attack-look-like-in-microsoft-365"></a><span data-ttu-id="b8d8c-118">Qual è l'aspetto di un attacco di concessione del consenso illecito in Microsoft 365?</span><span class="sxs-lookup"><span data-stu-id="b8d8c-118">What does an illicit consent grant attack look like in Microsoft 365?</span></span>

<span data-ttu-id="b8d8c-119">È necessario eseguire una ricerca **nel log di** controllo per trovare i segni, denominati anche Indicatori di compromissione (IOC) di questo attacco.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-119">You need to search the **audit log** to find signs, also called Indicators of Compromise (IOC) of this attack.</span></span> <span data-ttu-id="b8d8c-120">Per le organizzazioni con molte applicazioni registrate in Azure e una base di utenti di grandi dimensioni, la procedura consigliata consiste nel rivedere le concessioni di consenso delle organizzazioni su base settimanale.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-120">For organizations with many Azure-registered applications and a large user base, the best practice is to review your organizations consent grants on a weekly basis.</span></span>

### <a name="steps-for-finding-signs-of-this-attack"></a><span data-ttu-id="b8d8c-121">Passaggi per trovare i segni di questo attacco</span><span class="sxs-lookup"><span data-stu-id="b8d8c-121">Steps for finding signs of this attack</span></span>

1. <span data-ttu-id="b8d8c-122">Aprire il **portale Microsoft 365 Defender** e quindi <https://security.microsoft.com> selezionare **Controlla**.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-122">Open the **Microsoft 365 Defender** portal at <https://security.microsoft.com> and then select **Audit**.</span></span>

2. <span data-ttu-id="b8d8c-123">Nella pagina **Controllo** visualizzata verificare che la scheda **Ricerca** sia selezionata e quindi configurare le impostazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="b8d8c-123">On the **Audit** page that opens, verify that the **Search** tab is selected, and then configure the following settings:</span></span>
   - <span data-ttu-id="b8d8c-124">**Intervallo di data e ora**</span><span class="sxs-lookup"><span data-stu-id="b8d8c-124">**Date and time range**</span></span>
   - <span data-ttu-id="b8d8c-125">**Attività:** verificare che **l'opzione Mostra risultati per tutte le attività** sia selezionata.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-125">**Activities**: Verify that **Show results for all activities** is selected.</span></span>

   <span data-ttu-id="b8d8c-126">Al termine, fare clic su **Cerca**.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-126">When you're finished, click **Search**.</span></span>

3. <span data-ttu-id="b8d8c-127">Fare clic **sulla colonna** Attività per ordinare i risultati e cercare **Consenso all'applicazione.**</span><span class="sxs-lookup"><span data-stu-id="b8d8c-127">Click the **Activity** column to sort the results and look for **Consent to application**.</span></span>

4. <span data-ttu-id="b8d8c-128">Selezionare una voce dall'elenco per visualizzare i dettagli dell'attività.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-128">Select an entry from the list to see the details of the activity.</span></span> <span data-ttu-id="b8d8c-129">Verificare se IsAdminContent è impostato su True.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-129">Check to see if IsAdminContent is set to True.</span></span>

> [!NOTE]
>
> <span data-ttu-id="b8d8c-130">La visualizzazione della voce del registro di controllo corrispondente nei risultati della ricerca dopo un evento può richiedere da 30 minuti a 24 ore.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-130">It can take from 30 minutes up to 24 hours for the corresponding audit log entry to be displayed in the search results after an event occurs.</span></span>
>
> <span data-ttu-id="b8d8c-131">Il periodo di conservazione e ricerca di un record di controllo nel log di controllo dipende dalla sottoscrizione di Microsoft 365 e in particolare dal tipo di licenza assegnata a un utente specifico.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-131">The length of time that an audit record is retained and searchable in the audit log depends on your Microsoft 365 subscription, and specifically the type of the license that is assigned to a specific user.</span></span> <span data-ttu-id="b8d8c-132">Per ulteriori informazioni, vedere [Log di controllo](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span><span class="sxs-lookup"><span data-stu-id="b8d8c-132">For more information, see [Audit log](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span></span>
>
> <span data-ttu-id="b8d8c-133">Se questo valore è true, indica che un utente con accesso amministratore globale potrebbe aver concesso l'accesso generale ai dati.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-133">If this value is true, it indicates that someone with Global Administrator access may have granted broad access to data.</span></span> <span data-ttu-id="b8d8c-134">In caso di imprevisto, eseguire le operazioni necessarie per [confermare un attacco.](#how-to-confirm-an-attack)</span><span class="sxs-lookup"><span data-stu-id="b8d8c-134">If this is unexpected, take steps to [confirm an attack](#how-to-confirm-an-attack).</span></span>

## <a name="how-to-confirm-an-attack"></a><span data-ttu-id="b8d8c-135">Come confermare un attacco</span><span class="sxs-lookup"><span data-stu-id="b8d8c-135">How to confirm an attack</span></span>

<span data-ttu-id="b8d8c-136">Se sono presenti una o più istanze delle operazioni di I/O elencate in precedenza, è necessario eseguire ulteriori indagini per verificare che l'attacco si sia verificato in modo positivo.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-136">If you have one or more instances of the IOCs listed above, you need to do further investigation to positively confirm that the attack occurred.</span></span> <span data-ttu-id="b8d8c-137">È possibile utilizzare uno di questi tre metodi per confermare l'attacco:</span><span class="sxs-lookup"><span data-stu-id="b8d8c-137">You can use any of these three methods to confirm the attack:</span></span>

- <span data-ttu-id="b8d8c-138">Creare l'inventario delle applicazioni e delle relative autorizzazioni Azure Active Directory portale.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-138">Inventory applications and their permissions using the Azure Active Directory portal.</span></span> <span data-ttu-id="b8d8c-139">Questo metodo è accurato, ma è possibile controllare un solo utente alla volta che può richiedere molto tempo se si dispone di molti utenti da controllare.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-139">This method is thorough, but you can only check one user at a time which can be very time consuming if you have many users to check.</span></span>
- <span data-ttu-id="b8d8c-140">Eseguire l'inventario delle applicazioni e delle relative autorizzazioni tramite PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-140">Inventory applications and their permissions using PowerShell.</span></span> <span data-ttu-id="b8d8c-141">Questo è il metodo più rapido e accurato, con il minor sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-141">This is the fastest and most thorough method, with the least amount of overhead.</span></span>
- <span data-ttu-id="b8d8c-142">Fare in modo che gli utenti controllino singolarmente le proprie app e le proprie autorizzazioni e ne segnalano i risultati agli amministratori per la correzione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-142">Have your users individually check their apps and permissions and report the results back to the administrators for remediation.</span></span>

## <a name="inventory-apps-with-access-in-your-organization"></a><span data-ttu-id="b8d8c-143">Inventario delle app con accesso nell'organizzazione</span><span class="sxs-lookup"><span data-stu-id="b8d8c-143">Inventory apps with access in your organization</span></span>

<span data-ttu-id="b8d8c-144">È possibile eseguire questa operazione per gli utenti con Azure Active Directory Portal o PowerShell oppure fare in modo che gli utenti enumerino singolarmente l'accesso alle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-144">You can do this for your users with either the Azure Active Directory Portal, or PowerShell or have your users individually enumerate their application access.</span></span>

### <a name="steps-for-using-the-azure-active-directory-portal"></a><span data-ttu-id="b8d8c-145">Passaggi per l'utilizzo del Azure Active Directory portal</span><span class="sxs-lookup"><span data-stu-id="b8d8c-145">Steps for using the Azure Active Directory Portal</span></span>

<span data-ttu-id="b8d8c-146">È possibile cercare le applicazioni a cui ogni singolo utente ha concesso le autorizzazioni utilizzando il portale Azure Active Directory all'indirizzo <https://portal.azure.com> .</span><span class="sxs-lookup"><span data-stu-id="b8d8c-146">You can look up the applications to which any individual user has granted permissions by using the Azure Active Directory Portal at <https://portal.azure.com>.</span></span>

1. <span data-ttu-id="b8d8c-147">Accedere al portale di Azure con diritti amministrativi.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-147">Sign in to the Azure portal with administrative rights.</span></span>
2. <span data-ttu-id="b8d8c-148">Selezionare il Azure Active Directory pannello.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-148">Select the Azure Active Directory blade.</span></span>
3. <span data-ttu-id="b8d8c-149">Selezionare **Utenti**.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-149">Select **Users**.</span></span>
4. <span data-ttu-id="b8d8c-150">Selezionare l'utente che si desidera rivedere.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-150">Select the user that you want to review.</span></span>
5. <span data-ttu-id="b8d8c-151">Selezionare **Applicazioni**.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-151">Select **Applications**.</span></span>

<span data-ttu-id="b8d8c-152">In questo modo verranno mostrate le app assegnate all'utente e le autorizzazioni di cui dispongono le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-152">This will show you the apps that are assigned to the user and what permissions the applications have.</span></span>

### <a name="steps-for-having-your-users-enumerate-their-application-access"></a><span data-ttu-id="b8d8c-153">Passaggi per fare in modo che gli utenti enumerano l'accesso alle applicazioni</span><span class="sxs-lookup"><span data-stu-id="b8d8c-153">Steps for having your users enumerate their application access</span></span>

<span data-ttu-id="b8d8c-154">Fare in modo che gli utenti <https://myapps.microsoft.com> vi accedono e rivedranno l'accesso alle proprie applicazioni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-154">Have your users go to <https://myapps.microsoft.com> and review their own application access there.</span></span> <span data-ttu-id="b8d8c-155">Dovrebbero essere in grado di visualizzare tutte le app con accesso, visualizzare i dettagli su di esse (incluso l'ambito di accesso) ed essere in grado di revocare i privilegi alle app sospette o illecite.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-155">They should be able to see all the apps with access, view details about them (including the scope of access), and be able to revoke privileges to suspicious or illicit apps.</span></span>

### <a name="steps-for-doing-this-with-powershell"></a><span data-ttu-id="b8d8c-156">Passaggi per eseguire questa operazione con PowerShell</span><span class="sxs-lookup"><span data-stu-id="b8d8c-156">Steps for doing this with PowerShell</span></span>

<span data-ttu-id="b8d8c-157">Il modo più semplice per verificare l'attacco di concessione del consenso illecito è eseguire [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), che eseguirà il dump di tutte le autorizzazioni OAuth e le app OAuth per tutti gli utenti della tenancy in un unico file .csv.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-157">The simplest way to verify the Illicit Consent Grant attack is to run [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), which will dump all the OAuth consent grants and OAuth apps for all users in your tenancy into one .csv file.</span></span>

#### <a name="pre-requisites"></a><span data-ttu-id="b8d8c-158">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="b8d8c-158">Pre-requisites</span></span>

- <span data-ttu-id="b8d8c-159">Libreria di Azure AD PowerShell installata.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-159">The Azure AD PowerShell library installed.</span></span>
- <span data-ttu-id="b8d8c-160">Diritti di amministratore globale per il tenant su cui verrà eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-160">Global administrator rights on the tenant that the script will be run against.</span></span>
- <span data-ttu-id="b8d8c-161">Amministratore locale nel computer da cui verranno eseguiti gli script.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-161">Local Administrator on the computer from which will run the scripts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b8d8c-162">È ***consigliabile richiedere*** l'autenticazione a più fattori nell'account amministrativo.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-162">We ***highly recommend*** that you require multi-factor authentication on your administrative account.</span></span> <span data-ttu-id="b8d8c-163">Questo script supporta l'autenticazione AMF.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-163">This script supports MFA authentication.</span></span>

1. <span data-ttu-id="b8d8c-164">Accedere al computer da cui verrà eseguito lo script con diritti di amministratore locale.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-164">Sign in to the computer that you will run the script from with local administrator rights.</span></span>

2. <span data-ttu-id="b8d8c-165">Scaricare o copiare [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) script da GitHub in una cartella da cui verrà eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-165">Download or copy the [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) script from GitHub to a folder from which you will run the script.</span></span> <span data-ttu-id="b8d8c-166">Questa sarà la stessa cartella in cui verrà scritto il file "permissions.csv" di output.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-166">This will be the same folder to which the output "permissions.csv" file will be written.</span></span>

3. <span data-ttu-id="b8d8c-167">Aprire una sessione di PowerShell come amministratore e aprire la cartella in cui è stato salvato lo script.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-167">Open a PowerShell session as an administrator and open to the folder where you saved the script to.</span></span>

4. <span data-ttu-id="b8d8c-168">Connessione alla directory utilizzando il cmdlet [Connessione-AzureAD.](/powershell/module/azuread/connect-azuread)</span><span class="sxs-lookup"><span data-stu-id="b8d8c-168">Connect to your directory using the [Connect-AzureAD](/powershell/module/azuread/connect-azuread) cmdlet.</span></span>

5. <span data-ttu-id="b8d8c-169">Eseguire questo comando di PowerShell:</span><span class="sxs-lookup"><span data-stu-id="b8d8c-169">Run this PowerShell command:</span></span>

   ```powershell
   .\Get-AzureADPSPermissions.ps1 | Export-csv -Path "Permissions.csv" -NoTypeInformation
   ```

<span data-ttu-id="b8d8c-170">Lo script produce un file denominato Permissions.csv.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-170">The script produces one file named Permissions.csv.</span></span> <span data-ttu-id="b8d8c-171">Seguire questa procedura per cercare le autorizzazioni per le applicazioni illecite:</span><span class="sxs-lookup"><span data-stu-id="b8d8c-171">Follow these steps to look for illicit application permission grants:</span></span>

1. <span data-ttu-id="b8d8c-172">Nella colonna ConsentType (colonna G) cercare il valore "AllPrinciples".</span><span class="sxs-lookup"><span data-stu-id="b8d8c-172">In the ConsentType column (column G) search for the value "AllPrinciples".</span></span> <span data-ttu-id="b8d8c-173">L'autorizzazione AllPrincipals consente all'applicazione client di accedere al contenuto di tutti gli utenti nella tenancy.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-173">The AllPrincipals permission allows the client application to access everyone's content in the tenancy.</span></span> <span data-ttu-id="b8d8c-174">Le Microsoft 365 native necessitano di questa autorizzazione per funzionare correttamente.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-174">Native Microsoft 365 applications need this permission to work correctly.</span></span> <span data-ttu-id="b8d8c-175">Ogni applicazione non Microsoft con questa autorizzazione deve essere esaminata con attenzione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-175">Every non-Microsoft application with this permission should be reviewed carefully.</span></span>

2. <span data-ttu-id="b8d8c-176">Nella colonna Autorizzazione (colonna F) esaminare le autorizzazioni di cui dispone ogni applicazione delegata per il contenuto.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-176">In the Permission column (column F) review the permissions that each delegated application has to content.</span></span> <span data-ttu-id="b8d8c-177">Cercare l'autorizzazione "Lettura" e "Scrittura" o "\*. Tutte le autorizzazioni e esamina queste con attenzione perché potrebbero non essere appropriate.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-177">Look for "Read" and "Write" permission or "\*.All" permission, and review these carefully because they may not be appropriate.</span></span>

3. <span data-ttu-id="b8d8c-178">Esaminare gli utenti specifici a cui sono stati concessi i consensi.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-178">Review the specific users that have consents granted.</span></span> <span data-ttu-id="b8d8c-179">Se gli utenti di alto profilo o ad alto impatto hanno il consenso inappropriato concesso, è consigliabile analizzare ulteriormente.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-179">If high profile or high impact users have inappropriate consents granted, you should investigate further.</span></span>

4. <span data-ttu-id="b8d8c-180">Nella colonna ClientDisplayName (colonna C) cercare le app che sembrano sospette.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-180">In the ClientDisplayName column (column C) look for apps that seem suspicious.</span></span> <span data-ttu-id="b8d8c-181">Le app con nomi con errori di ortografia, nomi super blando o nomi con suoni di hacker devono essere esaminate con attenzione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-181">Apps with misspelled names, super bland names, or hacker-sounding names should be reviewed carefully.</span></span>

## <a name="determine-the-scope-of-the-attack"></a><span data-ttu-id="b8d8c-182">Determinare l'ambito dell'attacco</span><span class="sxs-lookup"><span data-stu-id="b8d8c-182">Determine the scope of the attack</span></span>

<span data-ttu-id="b8d8c-183">Dopo aver completato l'inventario dell'accesso alle applicazioni, esaminare il **log di controllo per** determinare l'ambito completo della violazione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-183">After you have finished inventorying application access, review the **audit log** to determine the full scope of the breach.</span></span> <span data-ttu-id="b8d8c-184">Cercare gli utenti interessati, i tempi di accesso dell'applicazione illecita all'organizzazione e le autorizzazioni di cui disponeva l'app.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-184">Search on the affected users, the time frames that the illicit application had access to your organization, and the permissions the app had.</span></span> <span data-ttu-id="b8d8c-185">È possibile eseguire ricerche **nel log di** controllo nella [Microsoft 365 Defender](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span><span class="sxs-lookup"><span data-stu-id="b8d8c-185">You can search the **audit log** in the [Microsoft 365 Defender](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b8d8c-186">[Per ottenere](../../compliance/enable-mailbox-auditing.md) [](../../compliance/turn-audit-log-search-on-or-off.md) queste informazioni, è necessario che il controllo delle cassette postali e il controllo attività per amministratori e utenti siano stati abilitati prima dell'attacco.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-186">[Mailbox auditing](../../compliance/enable-mailbox-auditing.md) and [Activity auditing for admins and users](../../compliance/turn-audit-log-search-on-or-off.md) must have been enabled prior to the attack for you to get this information.</span></span>

## <a name="how-to-stop-and-remediate-an-illicit-consent-grant-attack"></a><span data-ttu-id="b8d8c-187">Come arrestare e correggere un attacco di concessione del consenso illecito</span><span class="sxs-lookup"><span data-stu-id="b8d8c-187">How to stop and remediate an illicit consent grant attack</span></span>

<span data-ttu-id="b8d8c-188">Dopo aver identificato un'applicazione con autorizzazioni illecite, è possibile rimuovere tale accesso in diversi modi.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-188">After you have identified an application with illicit permissions, you have several ways to remove that access.</span></span>

- <span data-ttu-id="b8d8c-189">È possibile revocare l'autorizzazione dell'applicazione nel Azure Active Directory portal:</span><span class="sxs-lookup"><span data-stu-id="b8d8c-189">You can revoke the application's permission in the Azure Active Directory Portal by:</span></span>
  1. <span data-ttu-id="b8d8c-190">Passare all'utente interessato nel **pannello Azure Active Directory utente.**</span><span class="sxs-lookup"><span data-stu-id="b8d8c-190">Navigate to the affected user in the **Azure Active Directory User** blade.</span></span>
  2. <span data-ttu-id="b8d8c-191">Selezionare **Applicazioni**.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-191">Select **Applications**.</span></span>
  3. <span data-ttu-id="b8d8c-192">Selezionare l'applicazione illecita.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-192">Select the illicit application.</span></span>
  4. <span data-ttu-id="b8d8c-193">Fare **clic su** Rimuovi nel drill-down.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-193">Click **Remove** in the drill down.</span></span>

- <span data-ttu-id="b8d8c-194">È possibile revocare la concessione del consenso OAuth con PowerShell seguendo la procedura descritta in [Remove-AzureADOAuth2PermissionGrant.](/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant)</span><span class="sxs-lookup"><span data-stu-id="b8d8c-194">You can revoke the OAuth consent grant with PowerShell by following the steps in [Remove-AzureADOAuth2PermissionGrant](/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant).</span></span>

- <span data-ttu-id="b8d8c-195">È possibile revocare l'assegnazione del ruolo app di servizio con PowerShell seguendo la procedura descritta in [Remove-AzureADServiceAppRoleAssignment](/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span><span class="sxs-lookup"><span data-stu-id="b8d8c-195">You can revoke the Service App Role Assignment with PowerShell by following the steps in [Remove-AzureADServiceAppRoleAssignment](/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span></span>

- <span data-ttu-id="b8d8c-196">Puoi anche disabilitare del tutto l'accesso per l'account interessato, che a sua volta disabiliterà l'accesso dell'app ai dati in tale account.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-196">You can also disable sign-in for the affected account altogether, which will in turn disable app access to data in that account.</span></span> <span data-ttu-id="b8d8c-197">Questo non è l'ideale per la produttività dell'utente finale, naturalmente, ma se si sta lavorando per limitare rapidamente l'impatto, può essere una correzione a breve termine praticabile.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-197">This isn't ideal for the end user's productivity, of course, but if you are working to limit impact quickly, it can be a viable short-term remediation.</span></span>

- <span data-ttu-id="b8d8c-198">È possibile disattivare le applicazioni integrate per la tenancy.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-198">You can turn integrated applications off for your tenancy.</span></span> <span data-ttu-id="b8d8c-199">Si tratta di un passaggio drastico che disabilita la possibilità per gli utenti finali di concedere il consenso a livello di tenant.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-199">This is a drastic step that disables the ability for end users to grant consent on a tenant-wide basis.</span></span> <span data-ttu-id="b8d8c-200">In questo modo si impedisce agli utenti di concedere inavvertitamente l'accesso a un'applicazione dannosa.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-200">This prevents your users from inadvertently granting access to a malicious application.</span></span> <span data-ttu-id="b8d8c-201">Questo non è consigliabile in quanto intasa gravemente la capacità degli utenti di essere produttivi con applicazioni di terze parti.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-201">This isn't strongly recommended as it severely impairs your users' ability to be productive with third party applications.</span></span> <span data-ttu-id="b8d8c-202">A tale scopo, seguire la procedura descritta in Attivazione o disattivazione [delle app integrate.](../../admin/misc/user-consent.md)</span><span class="sxs-lookup"><span data-stu-id="b8d8c-202">You can do this by following the steps in [Turning Integrated Apps on or off](../../admin/misc/user-consent.md).</span></span>

## <a name="secure-microsoft-365-like-a-cybersecurity-pro"></a><span data-ttu-id="b8d8c-203">Proteggere Microsoft 365 come un professionista della sicurezza informatica</span><span class="sxs-lookup"><span data-stu-id="b8d8c-203">Secure Microsoft 365 like a cybersecurity pro</span></span>

<span data-ttu-id="b8d8c-204">L'abbonamento a Microsoft 365 include un potente set di funzionalità di protezione che consente di proteggere i propri dati e quelli degli altri utenti.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-204">Your Microsoft 365 subscription comes with a powerful set of security capabilities that you can use to protect your data and your users.</span></span> <span data-ttu-id="b8d8c-205">Usare la [Roadmap della sicurezza di Microsoft 365: principali priorità per i primi 30 giorni, 90 giorni e oltre](security-roadmap.md) per implementare le procedure consigliate da Microsoft per proteggere il tenant di Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-205">Use the [Microsoft 365 security roadmap - Top priorities for the first 30 days, 90 days, and beyond](security-roadmap.md) to implement Microsoft recommended best practices for securing your Microsoft 365 tenant.</span></span>

- <span data-ttu-id="b8d8c-206">Attività da eseguire i primi 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-206">Tasks to accomplish in the first 30 days.</span></span> <span data-ttu-id="b8d8c-207">Queste hanno effetto immediato e sono a basso impatto per gli utenti.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-207">These have immediate affect and are low-impact to your users.</span></span>
- <span data-ttu-id="b8d8c-208">Attività da completare in 90 giorni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-208">Tasks to accomplish in 90 days.</span></span> <span data-ttu-id="b8d8c-209">Queste attività richiedono una quantità di tempo leggermente superiore per la pianificazione e l'implementazione, ma aumentano notevolmente il livello di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-209">These take a bit more time to plan and implement but greatly improve your security posture.</span></span>
- <span data-ttu-id="b8d8c-210">Dopo 90 giorni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-210">Beyond 90 days.</span></span> <span data-ttu-id="b8d8c-211">Questi miglioramenti si instaurano nei primi 90 giorni di lavoro effettuato.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-211">These enhancements build in your first 90 days work.</span></span>

## <a name="see-also"></a><span data-ttu-id="b8d8c-212">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="b8d8c-212">See also</span></span>

- <span data-ttu-id="b8d8c-213">[L'applicazione imprevista](/azure/active-directory/application-access-unexpected-application) nell'elenco delle applicazioni consente agli amministratori di eseguire varie azioni dopo aver verificato che sono presenti applicazioni impreviste con accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-213">[Unexpected application in my applications list](/azure/active-directory/application-access-unexpected-application) walks administrators through various actions they may want to take after realizing there are unexpected applications with access to data.</span></span>
- <span data-ttu-id="b8d8c-214">[L'integrazione delle applicazioni con Azure Active Directory](/azure/active-directory/active-directory-apps-permissions-consent) è una panoramica generale del consenso e delle autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-214">[Integrating applications with Azure Active Directory](/azure/active-directory/active-directory-apps-permissions-consent) is a high-level overview of consent and permissions.</span></span>
- <span data-ttu-id="b8d8c-215">[I problemi di sviluppo dell'applicazione](/azure/active-directory/active-directory-application-dev-development-content-map) forniscono collegamenti a vari articoli relativi al consenso.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-215">[Problems developing my application](/azure/active-directory/active-directory-application-dev-development-content-map) provides links to various consent related articles.</span></span>
- <span data-ttu-id="b8d8c-216">Gli oggetti applicazione e entità servizio [in Azure Active Directory (Azure AD)](/azure/active-directory/develop/active-directory-application-objects) forniscono una panoramica degli oggetti Application e Service Principal di base del modello di applicazione.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-216">[Application and service principal objects in Azure Active Directory (Azure AD)](/azure/active-directory/develop/active-directory-application-objects) provides an overview of the Application and Service principal objects that are core to the application model.</span></span>
- <span data-ttu-id="b8d8c-217">[Gestire l'accesso alle app](/azure/active-directory/active-directory-managing-access-to-apps) è una panoramica delle funzionalità necessarie agli amministratori per gestire l'accesso degli utenti alle app.</span><span class="sxs-lookup"><span data-stu-id="b8d8c-217">[Manage access to apps](/azure/active-directory/active-directory-managing-access-to-apps) is an overview of the capabilities that administrators have to manage user access to apps.</span></span>
